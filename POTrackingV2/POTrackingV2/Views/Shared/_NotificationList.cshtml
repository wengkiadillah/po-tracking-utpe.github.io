
@if (Request.IsAuthenticated)
{
    ViewBag.Role = Model;
    @*<input id="roleNotification" name="roleNotification" type="hidden" class="form-control form-control-lg filter-search with-icon" placeholder="Search No. PO" value="@ViewBag.Role" />*@
    <input id="role" name="role" type="text" class="form-control form-control-lg filter-search with-icon" placeholder="Search No. PO" value="@ViewBag.Role" />
    <script src="~/Scripts/moment.min.js"></script>

    <script type="text/javascript">
        Date.prototype.newDateFormatMMDD = function () {
            const months = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];
            var dd = this.getDate();

            var mm = this.getMonth();
            var yyyy = this.getFullYear();
            if (dd < 10) {
                dd = '0' + dd;
            }

            //if (mm < 10) {
            //    mm = '0' + mm;
            //}
            //return dd + "/" +mm + "/" + yyyy;
            return months[mm] + " " + dd;
        }

        function parseURLParams(url) {
            var queryStart = url.indexOf("?") + 1,
                queryEnd = url.indexOf("#") + 1 || url.length + 1,
                query = url.slice(queryStart, queryEnd - 1),
                pairs = query.replace(/\+/g, " ").split("&"),
                parms = {}, i, n, v, nv;

            if (query === url || query === "") return;

            for (i = 0; i < pairs.length; i++) {
                nv = pairs[i].split("=", 2);
                n = decodeURIComponent(nv[0]);
                v = decodeURIComponent(nv[1]);

                if (!parms.hasOwnProperty(n)) parms[n] = [];
                parms[n].push(nv.length === 2 ? v : null);
            }
            return parms;
        }
        function deleteNotification(id, buttonID) {
            if (id != "" && id != null) {
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("/DeleteNotification", "Home")",
                    data: { 'notificationID': id},
                    contentType: "application/x-www-form-urlencoded; charset=utf-8",
                    //dataType: "json",
                    success: function (response) {
                        var notificationCount = $(".user-info-notification__count").text();
                        if (notificationCount != "" && buttonID==1) {
                            $(".user-info-notification__count").text(notificationCount-1);
                        }
                        $(".notification-list-item[id=" + id + "]").remove();
                        console.log(response.responseText);
                    },
                    error: function (xhr, status, error) {
                        alert(xhr.status + " : " + error);
                    }
                });
            }
        }

        $(document).ready(function () {
            var role = $("#role").val();
            //var role = $("#roleNotification").val();
            //if (role == 1) {
            //   $("#role").val("admin")
            //} else if (role == 2) {
            //    $("#role").val("procurement")
            //} else if (role == 3) {
            //    $("#role").val("vendor")
            //}
            var url = window.location;
            var objectURL = parseURLParams(window.location.toString());
            //if (typeof (objectURL['activeStage']) === "undefined" || typeof (objectURL['activeStage']) === "NaN") {
            if (objectURL && objectURL['activeStage']) {
                var activeStage = objectURL['activeStage'];
                if (activeStage == "2a") {
                    activeStage = 3;
                } else if ((path.toLowerCase().indexOf("local") > -1 || path.toLowerCase().indexOf("import") > -1) && activeStage > 2) {
                    activeStage = parseInt(activeStage) + 1;
                }
                paginationShow(activeStage);
            }

            $.ajax({
                type: "GET",
                url: "@Url.Action("/GetNotificationByRole", "Home")",
                //data: { 'role': role },
                contentType: "application/x-www-form-urlencoded; charset=utf-8",
                success: function (response) {
                    if (response.responseCode == "200") {
                        //console.log(response.notifications);
                        var jsonObj = $.parseJSON(response.notifications);
                        var message = "";
                        countNotification = Object.keys(jsonObj).length;
                        if (countNotification > 0) {
                            $(".user-info-notification__count").text(countNotification);
                            $(".user-info-notification__count").show();
                        } else {
                            $(".user-info-notification__count").hide();
                        }

                        for (var k in jsonObj) {
                            var PDIID = jsonObj[k]['PDIID'];
                            var ID = jsonObj[k]['ID'];
                            var statusID = jsonObj[k]['statusID'];
                            var className = "fas fa-check-circle approved";
                            var deletebutton = "";
                            if (statusID == 1) {
                                className = "fas fa-exclamation-circle important";
                                //onclick="Data('year', this)"
                                deletebutton = "<a class='notification-info' href='#' onclick ='javascript:deleteNotification(" + ID + ",1" + ")'><i class='fas fa-trash delete-icon'></i></a>";
                            } else if (statusID == 2) {
                                className = "fas fa-times-circle rejected";
                            }

                            var POTypeCategory = "";
                            if (jsonObj[k]['POImport'] == true) {
                                POTypeCategory = "Import";
                            } else if (jsonObj[k]['POLocal'] == true) {
                                POTypeCategory = "Local";
                            } else if (jsonObj[k]['POSubcont'] == true) {
                                POTypeCategory = "Subcont";
                            }
                            var PONumber = jsonObj[k]['PONumber'].toLowerCase();
                            var POQty = jsonObj[k]['POQty'];
                            var POConfirmedQty = jsonObj[k]['POConfirmedQty'];
                            var material = jsonObj[k]['material'];
                            var targetRole = jsonObj[k]['role'].toLowerCase();
                            var assignFromUserInternal = jsonObj[k]['assignedFromInternal'];
                            var assignedFrom = "Vendor";
                            if (assignFromUserInternal == true) {
                                if (POTypeCategory == "Subcont") {
                                    assignedFrom = "SubcontDev";
                                } else {
                                    assignedFrom = "Procurement";
                                }
                            }
                            var GRDate = jsonObj[k]['GRDate'];
                            var GRQty = jsonObj[k]['GRQty'];
                            var created = jsonObj[k]['created'];
                            var stage = jsonObj[k]['stage'];
                            var confirmedItem = jsonObj[k]['POConfirmedItem'];
                            var countEtaHistory = jsonObj[k]['CountEtaHistory'];
                            var confirmFirstETA = jsonObj[k]['ConfirmFirstETA'];
                            var proformaInvoice = jsonObj[k]['ProformaInvoice'];
                            var askProformaInvoice = jsonObj[k]['AskProformaInvoice'];
                            var confirmedPaymentReceive = jsonObj[k]['ConfirmedPaymentReceive'];
                            var secondETAHistory = jsonObj[k]['SecondETAHistory'];
                            var countProgressPhotos = jsonObj[k]['CountProgressPhotos'];
                            var shipmentATD = jsonObj[k]['ShipmentATD'];
                            var shipmentBookingDate = jsonObj[k]['ShipmentBookingDate'];
                            var shipmentCopyBLDate = jsonObj[k]['ShipmentCopyBLDate'];
                            var shipmentATA = jsonObj[k]['ShipmentATA'];
                            var invoiceDocument = jsonObj[k]['InvoiceDocument'];
                            var isHead = jsonObj[k]['IsHead'];
                            var poCreatedBy = jsonObj[k]['POCreatedBy'];
                            var confirmedDate = jsonObj[k]['ConfirmedDate'];
                            var releaseDate = jsonObj[k]['ReleaseDate'];
                            var firstETAHistory = jsonObj[k]['FirstETAHistory'];
                            var twentyFiveDate = jsonObj[k]['TwentyFiveDate'];

                            ////////////25% ETA
                            var resultTwentyFivePercent = "";
                            if (releaseDate != null && confirmedDate != null) {

                                var confirm = moment(confirmedDate.split('T')[0], 'YYYY-MM-DD');
                                var release = moment(releaseDate.split('T')[0], 'YYYY-MM-DD');
                                var div4 = confirm.diff(release, 'days') / 4;
                                resultTwentyFivePercent = release.add(div4, 'days').format('dddd, DD MMMM YYYY');
                            }

                            ////////////75% ETA
                            var resultSeventyFivePercent = "";
                            if (releaseDate != null && firstETAHistory != null) {

                                var firsEta = moment(firstETAHistory.split('T')[0], 'YYYY-MM-DD');
                                var released = moment(releaseDate.split('T')[0], 'YYYY-MM-DD');
                                var divSeventyFive = (firsEta.diff(released, 'days')* 3) / 4;
                                resultSeventyFivePercent = released.add(divSeventyFive, 'days').format('dddd, DD MMMM YYYY');
                            }

                            created = new Date(created);
                            //var url = "~/" + POTypeCategory + "?searchData=" + PONumber + "&filterBy=poNumber&role=" + targetRole.toLowerCase() + "&activeStage=" + stage;


                            var url = siteUrl + "/" + POTypeCategory + "/Index?searchPONumber=" + PONumber + "&activeStage=" + stage;
                            if (statusID == 1) {
                                url = siteUrl + "/" + POTypeCategory + "/Index?searchPONumber=" + PONumber + "&activeStage=" + stage + "'onclick ='javascript:deleteNotification(" + ID + ",2" + ")";
                            }
                            message = "";
                            /*------------------------------------------------------------------IMPORT----------------------------------------------------------*/
                            if (POTypeCategory == "Import") {
                                if (GRDate != null) {
                                    message += " has confirmed " + GRDate + " for item " + material + " from <a href='" + url + "' class='third-text'>PO" + PONumber + "</a> for Qty: " + GRQty + " (10/10)";
                                } else if (stage == "1") {
                                    if (statusID == "4") {
                                        message += " Please update Data " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at SAP";
                                        assignedFrom = "";
                                    } else if (confirmedItem == true) {
                                        if (targetRole = "vendor") {
                                        message += " has approved item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage "+stage+", please proceed to update ETA on " + twentyFiveDate;
                                        }
                                        else {
                                        message += " has approved item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage "+stage+" without delay";
                                        }
                                    } else if (confirmedItem == false) {
                                        message += "Item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " + stage +" has been canceled";
                                        assignedFrom = "";
                                    } else if (POConfirmedQty != null) {
                                        message += " has approved item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty+ " at stage "+stage;
                                    }
                                } else if (stage == "2") {
                                    if (confirmFirstETA == true) {
                                        if (targetRole = "vendor") {
                                            message += " has accepted ETA for item " + material + " from <a href= '" + url + "' class='third- text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " + stage;
                                        }
                                        else {
                                            message += " has accepted ETA for item " + material + " from <a href= '" + url + "' class='third- text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " +stage+" without delay, please proceed to define Proforma Invoice";
                                        }
                                    } else if (confirmFirstETA == false) {
                                        message += " has declined ETA for item " + material + " from <a href= '" + url + "' class='third- text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " +stage;
                                    } else if (countEtaHistory > 0) {
                                        message += " has updated ETA for item " + material + " from <a href= '" + url + "' class='third- text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " +stage+", please proceed to Confirm ETA";
                                    }
                                } else if (stage == "2a") {
                                    if (proformaInvoice != null) {
                                        message += " has uploaded proforma Invoice for item " + material + " from <a href= '" + url + "' class='third- text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " +stage+", please proceed to confirm receive payment";
                                    } else if (proformaInvoice == null) {
                                        if (askProformaInvoice == true) {
                                            message += " has asked proforma Invoice for item " + material + " from <a href= '" + url + "' class='third- text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " +stage+", please proceed to Upload";
                                        }
                                        else if (askProformaInvoice == false) {
                                            message += " has skipped proforma Invoice for item " + material + " from <a href= '" + url + "' class='third- text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " +stage;
                                        }
                                    }
                                } else if (stage == "3") {
                                    if (confirmedPaymentReceive != null) {
                                        message += " has updated Confirmed Payment received for item " + material + " from <a href= '" + url + "' class='third- text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " +stage+", please proceed to ETA Confirmation";
                                    } else if (confirmedPaymentReceive == null) {
                                        message += " has skipped Confirmed Payment received for item " + material + " from <a href= '" + url + "' class='third- text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " +stage+", please proceed to ETA Confirmation";
                                    }
                                } else if (stage == "4") {
                                    if (countProgressPhotos > 0) {
                                        message += " has uploaded Progress photos for item " + material + " from <a href= '" + url + "' class='third- text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " +stage;
                                    } else if (secondETAHistory != null) {
                                        message += " has updated the ETA for item " + material + " from <a href= '" + url + "' class='third- text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " +stage;
                                    }
                                } else if (stage == "5") {
                                    if (shipmentATD != null) {
                                        message += " has updated shipment Actual Time Delivery date at " + shipmentATD + " for item " + material + " from <a href= '" + url + "' class='third- text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " +stage;
                                    } else if (shipmentBookingDate != null) {
                                        message += " has updated shipment booking date at " + shipmentBookingDate + " for item " + material + " from <a href= '" + url + "' class='third- text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " +stage;
                                    }
                                } else if (stage == "6") {
                                    if (shipmentCopyBLDate != null) {
                                        message += " has updated shipment form and documents for item " + material + " from <a href= '" + url + "' class='third- text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " +stage+", please continue to fill the shipment ATA";
                                    }
                                } else if (stage == "7") {
                                    if (shipmentATA != null) {
                                        message += " has updated shipment ATA at " + shipmentATA + " for item " + material + " from <a href= '" + url + "' class='third- text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " +stage;
                                    }
                                } else if (stage == "9") {
                                    if (invoiceDocument != null) {
                                        message += " has uploaded Invoice for item " + material + " from <a href= '" + url + "' class='third- text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " +stage;
                                    }
                                    else {
                                        message += " has removed Invoice for item " + material + " from <a href= '" + url + "' class='third- text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " +stage;
                                    }
                                }

                                if (isHead == true) {
                                    message += " PO Created by " + poCreatedBy
                                }
                                /*-------------------------------------------------------------END IMPORT-----------------------------------------------------------*/
                            }
                            else if (POTypeCategory == "Local") {
                                if (GRDate != null) {
                                    message += " has confirmed " + GRDate + " for item " + material + " from <a href='" + url + "' class='third-text'>PO" + PONumber + "</a> for Qty: " + GRQty + " (10/10) at stage " + stage;
                                } else if (stage == "1") {
                                    if (statusID == "4") {
                                        message += " Please update Data " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at SAP";
                                        assignedFrom = "";
                                    } else if (confirmedItem == true) {
                                        if (targetRole = "vendor") {
                                            if (releaseDate != null) {

                                                message += " has approved item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " + stage + ", please update ETA on " + resultTwentyFivePercent;
                                            }
                                            else {
                                                message += " has approved item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " + stage + ", please update ETA ";
                                            }
                                        }
                                        else {
                                            if (releaseDate != null) {
                                                message += " has approved item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " + stage + " without delay and update ETA on " + resultTwentyFivePercent;
                                            }
                                            else {
                                                message += " has approved item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " + stage + " without delay ";
                                            }
                                        }
                                    } else if (confirmedItem == false) {
                                        message += " has declined item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > for Quantity: " + POQty + " at stage " + stage;
                                    } else if (POConfirmedQty != null) {
                                        message += " has requested item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " + stage;
                                    }
                                } else if (stage == "2") {
                                    if (confirmFirstETA == true) {
                                        if (targetRole = "vendor") {
                                            message += " has accepted ETA for item " + material + " from <a href= '" + url + "' class='third- text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " + stage;
                                        }
                                        else {
                                            message += " has accepted ETA for item " + material + " from <a href= '" + url + "' class='third- text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " + stage + " without delay, please proceed to define Proforma Invoice";
                                        }
                                    } else if (confirmFirstETA == false) {
                                        message += " has declined ETA for item " + material + " from <a href= '" + url + "' class='third- text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " + stage;
                                    } else if (countEtaHistory > 0) {
                                        message += " has updated ETA for item " + material + " from <a href= '" + url + "' class='third- text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " + stage + ", please proceed to Confirm ETA";
                                    }
                                } else if (stage == "2a") {
                                    if (proformaInvoice != null) {
                                        message += " has uploaded proforma Invoice for item " + material + " from <a href= '" + url + "' class='third- text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " + stage + ", please proceed to confirm receive payment";
                                    } else if (proformaInvoice == null) {
                                        if (askProformaInvoice == true) {
                                            message += " has asked proforma Invoice for item " + material + " from <a href= '" + url + "' class='third- text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " + stage + ", please proceed to Upload";
                                        }
                                        else if (askProformaInvoice == false) {
                                            message += " has skipped proforma Invoice for item " + material + " from <a href= '" + url + "' class='third- text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " + stage;
                                        }
                                    }
                                } else if (stage == "3") {
                                    if (releaseDate != null) {
                                        if (confirmedPaymentReceive != null) {
                                            message += " has updated Confirmed Payment received for item " + material + " from <a href= '" + url + "' class='third- text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " + stage + ", please proceed to ETA Confirmation on " + resultSeventyFivePercent;
                                        } else if (confirmedPaymentReceive == null) {
                                            message += " has skipped Confirmed Payment received for item " + material + " from <a href= '" + url + "' class='third- text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " + stage + ", please proceed to ETA Confirmation on " + resultSeventyFivePercent;
                                        }
                                    } else {
                                        if (confirmedPaymentReceive != null) {
                                            message += " has updated Confirmed Payment received for item " + material + " from <a href= '" + url + "' class='third- text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " + stage + ", please proceed to ETA Confirmation ";
                                        } else if (confirmedPaymentReceive == null) {
                                            message += " has skipped Confirmed Payment received for item " + material + " from <a href= '" + url + "' class='third- text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " + stage + ", please proceed to ETA Confirmation ";
                                        }
                                    }
                                } else if (stage == "4") {
                                    if (countProgressPhotos > 0) {
                                        message += " has uploaded Progress photos and asked to update GR for item " + material + " from <a href= '" + url + "' class='third- text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " + stage;
                                    } else if (secondETAHistory != null) {
                                        message += " has updated the ETA for item and asked to update GR for item " + material + " from <a href= '" + url + "' class='third- text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " + stage;
                                    }
                                }
                                //else if (stage == "5") {
                                //    if (statusID == 3) {
                                //        if (POConfirmedQty != null) {
                                //            message += " asked to update invoice method for item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > for Qty: " + POConfirmedQty + " at stage " + stage;
                                //        } else {
                                //            message += " asked to update invoice method for item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > at stage " + stage;
                                //        }
                                //    } else if (POConfirmedQty != null) {
                                //        message += " has updated invoice method item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > for Qty: " + POConfirmedQty + " at stage " + stage;
                                //    } else {
                                //        message += " has updated invoice method for item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > at stage " + stage;
                                //    }
                                //}
                                else if (stage == "6") {
                                    if (invoiceDocument != null) {
                                        message += " has uploaded Invoice for item " + material + " from <a href= '" + url + "' class='third- text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " + stage;
                                    }
                                    else {
                                        message += " has removed Invoice for item " + material + " from <a href= '" + url + "' class='third- text'> PO " + PONumber + "</a > for Quantity: " + POConfirmedQty + " at stage " + stage;
                                    }
                                } else {
                                    message += " has approved item " + material + " from <a href= '" + url + "' class='third- text'> PO " + PONumber + "</a > for Qty: " + POConfirmedQty + " at stage " + stage;
                                }

                                if (isHead == true) {
                                    message += " PO Created by " + poCreatedBy
                                }
                                /*---------------------------------------------------------------END LOCAL------------------------------------------------------------*/
                            } else if (POTypeCategory == "Subcont") {
                                /*-------------------------------------------------------------BEGIN SUBCONT----------------------------------------------------------*/
                                if (GRDate != null) {
                                    message += " has confirmed " + GRDate + " for item " + material + " from <a href='" + url + "' class='third-text'>PO" + PONumber + "</a> for Qty: " + GRQty + " (10/10) at stage " + stage;
                                } else if (stage == "1") {
                                    //if (confirmedItem == true) {
                                    //    message += " asked to update ETA for item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a >";
                                    //} else
                                    if (confirmedItem == false) {
                                        if (POConfirmedQty != null) {
                                            if (assignFromUserInternal == true && role == "subcontdev") {
                                                assignedFrom = "You"
                                                message += " have canceled item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > for Qty: " + POConfirmedQty + " at stage " + stage;
                                            } else {
                                                message += " has canceled item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > for Qty: " + POConfirmedQty + " at stage " + stage;
                                            }
                                        } else if (POQty != null) {
                                            if (assignFromUserInternal == true && role == "subcontdev") {
                                                assignedFrom = "You"
                                                message += " have canceled item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > for Qty: " + POQty + " at stage " + stage;
                                            } else {
                                                message += " has canceled item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > for Qty: " + POQty + " at stage " + stage;
                                            }
                                        } else {
                                            if (assignFromUserInternal == true && role == "subcontdev") {
                                                assignedFrom = "You"
                                                message += " have canceled item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > at stage " + stage;
                                            } else {
                                                message += " has canceled item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > at stage " + stage;
                                            }
                                        }
                                    } else if (POConfirmedQty != null) {
                                        message += " has approved item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > for Qty: " + POConfirmedQty + " at stage " + stage;
                                    } else {
                                        message += " has approved item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > at stage " + stage;
                                    }
                                } else if (stage == "2") {
                                    if (statusID == 3) {
                                        if (POConfirmedQty != null) {
                                            message += " asked to Define Sequences for item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > for Qty: " + POConfirmedQty + " at stage " + stage;
                                        } else {
                                            message += " asked to Define Sequences for item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > at stage " + stage;
                                        }
                                    } else if (POConfirmedQty != null) {
                                        message += " has updated Define Sequences item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > for Qty: " + POConfirmedQty + " at stage " + stage;
                                    }else {
                                        message += " has updated Define Sequences for item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > at stage " + stage;
                                    }
                                } else if (stage == "3") {
                                    if (statusID == 3) {
                                        if (POConfirmedQty != null) {
                                            message += " asked to update Sequences Progress for item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > for Qty: " + POConfirmedQty + " at stage " + stage;
                                        } else {
                                            message += " asked to update Sequences Progress for item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > at stage " + stage;
                                        }
                                    } else if (POConfirmedQty != null) {
                                        message += " has updated Sequences Progress item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > for Qty: " + POConfirmedQty + " at stage " + stage;
                                    } else {
                                        //assignedFrom = "";
                                        message += " has updated Sequences Progress for item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > at stage " + stage;
                                    }
                                } else if (stage == "4") {
                                    if (statusID == 3) {
                                        if (POConfirmedQty != null) {
                                            message += " asked to update GR for item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > for Qty: " + POConfirmedQty + " at stage " + stage;
                                        } else {
                                            message += " asked to update GR for item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > at stage " + stage;
                                        }
                                    }
                                    //else {
                                    //    message += " asked to update GR for item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a >";
                                    //}
                                } else if (stage == "5") {
                                    if (statusID == 3) {
                                        if (POConfirmedQty != null) {
                                            message += " asked to update invoice method for item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > for Qty: " + POConfirmedQty + " at stage " + stage;
                                        } else {
                                            message += " asked to update invoice method for item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > at stage " + stage;
                                        }
                                    } else if (POConfirmedQty != null) {
                                        message += " has updated invoice method item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > for Qty: " + POConfirmedQty + " at stage " + stage;
                                    } else {
                                        message += " has updated invoice method for item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > at stage " + stage;
                                    }
                                } else if (stage == "6") {
                                    if (statusID == 3) {
                                        if (POConfirmedQty != null) {
                                            message += " asked to upload invoice for item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > for Qty: " + POConfirmedQty + " at stage " + stage;
                                        } else {
                                            message += " asked to upload invoice for item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > at stage " + stage;
                                        }
                                    } else if (POConfirmedQty != null) {
                                        message += " has uploaded invoice item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > for Qty: " + POConfirmedQty + " at stage " + stage;
                                    } else {
                                        message += " has uploaded invoice for item " + material + " from <a href= '" + url + "' class='third-text'> PO " + PONumber + "</a > at stage " + stage;
                                    }
                                }

                                /*--------------------------------------------------------------END SUBCONT-----------------------------------------------------------*/
                            }

                            $(".list-unstyled.notification-list").append("<li class='notification-list-item'  id='" + ID + "'>" +
                                "<i class='" + className + "'></i>" +
                                "<div class='notification-message-container'>" +
                                "<p class='mb-1'>" +
                                assignedFrom + message +
                                "</p>" +
                                "<p class='secondary-text mb-0'>" + created.newDateFormatMMDD() + "</p>" +
                                "</div>" +
                                deletebutton +
                                "</li>");
                        }
                    }
                },
                error: function (xhr, status, error) {
                    alert(xhr.status + " : " + error);
                }
            });
        });
    </script>
}
