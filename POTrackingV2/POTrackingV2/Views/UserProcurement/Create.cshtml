@model POTrackingV2.ViewModels.UserProcurementViewModelCreate

@{
    ViewBag.Title = "Create";
}
<!-- Font-icon css-->
<link rel="stylesheet" type="text/css"
      href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<!-- Select Dropdown Style -->
<link href="~/Content/bootstrap-select.min.css" rel="stylesheet">
<!--Multiple Select Dropdown -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.2.13/dist/semantic.min.css" />
<h2>Create new User Procurement Superior</h2>

<div class="form-horizontal">
    <hr />
    <div class="form-group">
        <p class="form-custom-label">Procurement Superior User</p>
        @Html.DropDownList("SuperiorUser_Username", Model.SuperiorUsernames, "Select", htmlAttributes: new { @class = "form-control full-width chosen" })
    </div>
    <div class="form-group">
        <p class="form-custom-label">Select Inferior User</p>
        <select name="InferiorUser_Username" id="InferiorUser_Username" class="form-control chosen-select" multiple tabindex="3"></select>
        <p class="material-preparation-process-validation text-danger"></p>
    </div>
    <div class="form-group">
        <div class="col-md-offset-2 col-md-10">
            <input type="submit" id="buttonCreate" name="buttonCreate" value="Create" class="btn btn-default" />
        </div>
    </div>

    <div class="inline field">
        <select name="actors" multiple="" class="label ui selection fluid dropdown">
            <option value="">All</option>
            <option>PB</option>
            <option>Maintance</option>
            <option>PPC</option>
            <option>Procurement</option>
            <option>Fabrikasi</option>
            <option>Engineering</option>
            <option>Assembly</option>
            <option>Marketing Produk</option>
            <option>Sales</option>
            <option>Warehouse</option>
            <option>Marketing Administratif</option>
            <option>QC</option>
        </select>
    </div>
</div>
<div>
    @Html.ActionLink("Back to List", "Index")
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")

    <script type="text/javascript">
        $(document).ready(function () {
            $(".chosen").chosen();
        });

        $('#SuperiorUser_Username').change(function () {
            $("#InferiorUser_Username").find('option').remove().end();

            $(".search-choice").empty();
            $(".chosen-results").empty();

            var username = $('#SuperiorUser_Username :selected').val();
            var data = {
                username: username
            };

            if (username != null && username != '') {
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("PopulateUser", "UserProcurement")",
                    context: this,
                    data: data,
                    success: function (response) {
                        if (response.selectListusers != null && !jQuery.isEmptyObject(response.selectListusers)) {
                            var count = response.selectListusers.length;
                            $.each(response.selectListusers, function (i, item) {
                                $("#InferiorUser_Username").append($("<option />").val(this.Value).text(this.Text));
                            });
                        }
                    }
                });
            }
        });

        $('#buttonCreate').click(function () {
            var username = $('#SuperiorUser_Username :selected').val();

            var inferiorUsernames = [];
            $("#InferiorUser_Username :selected").each(function (i, selected) {
                inferiorUsernames[i] = $(selected).val();
            });

            var data = {
                username: username,
                inferiorUsernames: inferiorUsernames
            };

            if (data.username !== "" || data.username !== null) {
                if (data.inferiorUsernames.length > 0) {
                    $.ajax({
                        type: "POST",
                        url: "@Url.Action("CreateSuperiorUser", "UserProcurement")",
                        context: this,
                        data: data,
                        success: function (response) {
                            window.location.href = "@Url.Action("Index", "UserProcurement")";
                        },
                        error: function (xhr, status, error) {
                            alert(xhr.status + " : " + error);
                        }
                    });
                }
                else {
                alert("Please Choose Inferior User");
                }
            }
            else {
                alert("Please Choose Superior User");
            }
        });

    </script>

    <script src="~/Scripts/semantic.min.js"></script>
    <script src="~/Scripts/create-multiple.js"></script>
}
