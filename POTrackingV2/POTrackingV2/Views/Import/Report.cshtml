@model IEnumerable<POTrackingV2.Models.PO>

@{
    ViewBag.Title = "Report PO Import";
    int number = 1;
}


<link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css" />
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js" />

<h2>Report</h2>

<table id="tableReport" class="table">
    <tr>
        <th>
            Number
        </th>
        <th>
            PO Number
        </th>
        <th>
            Item Number
        </th>
        <th>
            Material
        </th>
        <th>
            Description
        </th>
        <th>
            Quantity
        </th>
        <th>
            Delivery Date
        </th>
        <th>
            Vendor
        </th>
        <th>
            Estimated Time Arrival
        </th>
    </tr>

    @if (Model.Count() > 0)
    {
        foreach (var po in Model)
        {
            var purchasingDocumentItems = po.PurchasingDocumentItems.Where(x => !String.IsNullOrEmpty(x.Material) && x.ActiveStage != null && x.ActiveStage != "0")
                                                                    .OrderBy(x => x.ItemNumber);

            if (purchasingDocumentItems.Count() < 1)
            {
                continue;
            }

            foreach (var purchasingDocumentItem in purchasingDocumentItems)
            {
                <tr>
                    <td>
                        @number
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => po.Number)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => purchasingDocumentItem.ItemNumber)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => purchasingDocumentItem.Material)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => purchasingDocumentItem.Description)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => purchasingDocumentItem.Quantity)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => purchasingDocumentItem.DeliveryDate)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => po.Vendor.Name)
                    </td>
                    <td>
                        @{
                            string estimatedTimeArrival = "-";

                            if (purchasingDocumentItem.HasShipment)
                            {
                                if (purchasingDocumentItem.FirstShipment.ATADate.HasValue)
                                {
                                    estimatedTimeArrival = purchasingDocumentItem.FirstShipment.ATADate.GetValueOrDefault().AddDays(7).ToString("dd/MM/yyyy");
                                }
                            }
                        }

                        @estimatedTimeArrival
                    </td>
                </tr>

                number++;
            }
        }
    }
    else
    {
        <tr>
            <td>
                No Data
            </td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
    }

</table>

<script type="text/javascript">
    $(document).ready(function () {
        $('#tableReport').DataTable();
    });
</script>