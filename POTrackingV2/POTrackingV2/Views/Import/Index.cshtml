@model PagedList.IPagedList<POTrackingV2.Models.PO>

@using PagedList.Mvc;
@{
    ViewBag.Title = "PO Import";
    var roleID = ViewBag.CurrentRoleID;
    var poSignRow = 1;
}
@section styles {
    <link href="~/Content/datepicker.min.css" rel="stylesheet" />
}
<h1 class="page-title">PO Tracking System <span class="page-subtitle">History</span></h1>
<div class="filter-row mb-2">
    @using (Html.BeginForm("Index", "Import", null, FormMethod.Get, new { @class = "filter-form-container form-inline" }))
    {
        <div class="form-group mr-4">
            <input id="searchPONumber" name="searchPONumber" list="data-list-ponumber" type="text" class="form-control form-control-lg filter-search with-icon" placeholder="Search PO Number" autocomplete="off" value="@ViewBag.CurrentSearchPONumber" />
            <datalist id="data-list-ponumber"></datalist>
        </div>
        <div class="form-group mr-4 ml-0">
            <input id="searchVendorName" name="searchVendorName" list="data-list-vendorname" type="text" class="form-control form-control-lg filter-search with-icon" placeholder="Search Vendor Name" autocomplete="off" value="@ViewBag.CurrentSearchVendorName" />
            <datalist id="data-list-vendorname"></datalist>
        </div>
        <div class="form-group mr-4 ml-0">
            <input id="searchMaterial" name="searchMaterial" list="data-list-material" type="text" class="form-control form-control-lg filter-search with-icon" placeholder="Search Material" autocomplete="off" value="@ViewBag.CurrentSearchMaterial" />
            <datalist id="data-list-material"></datalist>
        </div>
        <div class="form-group mr-0 ml-0">
            <label for="startPODate">PO Date</label>
            <input name="searchStartPODate" type="text" class="form-control form-control-lg form-date with-icon" id="startPODate"
                   placeholder="dd/mm/yyyy" value="@ViewBag.CurrentStartPODate" autocomplete="off" />
            <i class="far fa-calendar-alt form-type-icon"></i>
        </div>
        <div class="form-group">
            <label for="endPODate">to</label>
            <input name="searchEndPODate" type="text" class="form-control form-control-lg form-date with-icon" id="endPODate"
                   placeholder="dd/mm/yyyy" value="@ViewBag.CurrentEndPODate" autocomplete="off" />
            <i class="far fa-calendar-alt form-type-icon"></i>
        </div>
        <input name="roleID" type="hidden" value="@ViewBag.CurrentRoleID" />
        <button type="submit" class="btn btn-info mr-3">Find</button>
        @Html.ActionLink("Clear", "Index", null, new { @class = "btn btn-info mr-3" })
    }
</div>
<div class="filter-row tier-2 mt-0">
    <form class="filter-form-container form-inline" style="visibility:hidden;">
        <div class="form-group mr-4 frmSearch">
            <input class="form-control form-control-lg filter-search with-icon">
            <datalist></datalist>
        </div>
        <select class="form-control form-control-lg">
        </select>
        <div class="form-group mr-0">
            <label >PO Date</label>
            <input class="form-control form-control-lg form-date with-icon">
            <i class="far fa-calendar-alt form-type-icon"></i>
        </div>
        <div class="form-group">
            <label>to</label>
            <input class="form-control form-control-lg form-date with-icon">
            <i class="far fa-calendar-alt form-type-icon"></i>
        </div>
        <button class="btn btn-info mr-3">Find</button>
        <a class="btn btn-info mr-3">Clear</a>
    </form>

    <div class="stage-pagination-container">
        <p class="stage-pagination-label mb-0 mr-3">Jump to Stage:</p>
        <ul class="list-unstyled pagination-list mb-0 custom-scrollbar">
            <li class="pagination-list__item" onclick="paginationShow(1)">1</li>
            <li class="pagination-list__item" onclick="paginationShow(2)">2</li>
            <li class="pagination-list__item" onclick="paginationShow(3)">2a</li>
            <li class="pagination-list__item" onclick="paginationShow(4)">3</li>
            <li class="pagination-list__item" onclick="paginationShow(5)">4</li>
            <li class="pagination-list__item" onclick="paginationShow(6)">5</li>
            <li class="pagination-list__item" onclick="paginationShow(7)">6</li>
            <li class="pagination-list__item" onclick="paginationShow(8)">7</li>
            @*<li class="pagination-list__item" onclick="paginationShow(9)">8</li>*@
            <li class="pagination-list__item" onclick="paginationShow(9)">8</li>
            <li class="pagination-list__item" onclick="paginationShow(10)">9</li>
            @if (roleID == "procurement")
            {
                <li class="pagination-list__item" onclick="paginationShow(11)">10</li>
            }
        </ul>
    </div>
</div>

@*<div>
    <span>MyUser : @ViewBag.MyUser</span>
    <span>Role : @ViewBag.Role</span>
    <span>RoleType : @ViewBag.RoleType</span>
</div>*@


@foreach (var pO in Model)
{
    var purchasingDocumentItems = pO.PurchasingDocumentItems.Where(x => !String.IsNullOrEmpty(x.Material));

    purchasingDocumentItems = purchasingDocumentItems.Except(purchasingDocumentItems.Where(x => x.ParentID != null && x.ParentID != x.ID));
    purchasingDocumentItems = purchasingDocumentItems.Except(purchasingDocumentItems.Where(x => x.IsClosed.ToLower() == "x" || x.IsClosed.ToLower() == "l" || x.IsClosed.ToLower() == "lx"));

    if (!string.IsNullOrEmpty(ViewBag.CurrentSearchMaterial))
    {
        purchasingDocumentItems = purchasingDocumentItems.Where(x => x.Material.Contains(ViewBag.CurrentSearchMaterial) || x.Description.Contains(ViewBag.CurrentSearchMaterial));
    }

    if (roleID == "procurement")
    {
        purchasingDocumentItems = purchasingDocumentItems.Where(x => x.ConfirmedQuantity.HasValue || x.OpenQuantity.HasValue);
    }

    if (purchasingDocumentItems.Count() < 1)
    {
        continue;
    }

    purchasingDocumentItems = purchasingDocumentItems.OrderBy(x => x.ItemNumber);

    <ul class="list-unstyled po-list">
        <li class="po-item-container">
            <div class="po-item-section po-item-sticky">
                <div class="po-item-section-header">
                    <i onclick="poItemCollapse($(this))" class="fas fa-angle-up po-item-section-header__icon arrow"></i>
                    <div class="po-item-section-header-text">
                        <span class="po-item-section-header-text__label">No. PO</span>
                        <span>@pO.Number</span>
                    </div>
                    <div class="po-item-section-header-text">
                        <span class="po-item-section-header-text__label">PO Date</span>
                        <span>@pO.Date.ToString("dd/MM/yyyy")</span>
                    </div>
                    <i class="fas fa-info-circle po-item-section-header__icon info"></i>
                    <div class="pop-up-notification">
                        <table>
                            <tr>
                                <td class="secondary-text">No. PO</td>
                                <td>&nbsp;</td>
                                <td>@pO.Number</td>
                            </tr>
                            <tr>
                                <td class="secondary-text">PO Date</td>
                                <td>&nbsp;</td>
                                <td>@pO.Date.ToString("dd/MM/yyyy")</td>
                            </tr>
                            <tr>
                                <td class="secondary-text">Vendor</td>
                                <td>&nbsp;</td>
                                @if (pO.Vendor != null)
                                {
                                    <td>@pO.Vendor.Name</td>
                                }
                                else
                                {
                                    <td>Vendor not in Database</td>
                                }
                            </tr>
                            <tr>
                                <td class="secondary-text">Vendor Code</td>
                                <td>&nbsp;</td>
                                @if (pO.Vendor != null)
                                {
                                    <td>@pO.Vendor.Code</td>
                                }
                                else
                                {
                                    <td>Vendor not in Database</td>
                                }
                            </tr>
                            <tr>
                                <td class="secondary-text">PO Creator</td>
                                <td>&nbsp;</td>
                                <td>@pO.PurchaseOrderCreator</td>
                            </tr>
                            <tr>
                                <td class="secondary-text">Release PO Date</td>
                                <td>&nbsp;</td>
                                @if (pO.ReleaseDate != null)
                                {
                                    <td>@pO.ReleaseDate.Value.ToString("dd/MM/yyyy")</td>
                                }
                                else
                                {
                                    <td>Not found in Database</td>
                                }
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="po-item-section-body">
                    <div class="po-item-data-header">
                        <span class="po-item-data-header__text item-id">Item ID</span>
                        <span class="po-item-data-header__text material">Material</span>
                        <span class="po-item-data-header__text description">Item Description</span>
                        <span class="po-item-data-header__text po-progress">Progress</span>
                    </div>
                    @{
                        var row = 1;
                    }
                    @foreach (var purchasingDocumentItem in purchasingDocumentItems)
                    {
                        var childPurchasingDocumentItems = pO.PurchasingDocumentItems.Where(x => x.ParentID == purchasingDocumentItem.ID && x.ID != purchasingDocumentItem.ID);
                        var childRow = 1;
                        var maximumStage = 10;
                        var donutProgress = purchasingDocumentItem.DonutProgress;

                        if (roleID == "vendor")
                        {
                            maximumStage = 9;
                            donutProgress = purchasingDocumentItem.DonutProgressVendor;
                        }

                        <div class="po-item-data-content row-@row">
                            <div class="po-item-data-content__outer">
                                <span class="po-item-data-header__column item-id">@purchasingDocumentItem.ItemNumber</span>
                                <span class="po-item-data-header__column material">@purchasingDocumentItem.Material</span>
                                <span class="po-item-data-header__column description">@purchasingDocumentItem.Description</span>
                                @if (purchasingDocumentItem.ConfirmedItem != false)
                                {
                                    <div class="po-item-data-header__column po-progress">
                                        <div class="donut-chart" data-donutty data-radius="12" data-thickness="4" data-padding="0"
                                             data-value="@donutProgress" data-round="false" data-color="#567FEF" data-transition="all 2s cubic-bezier(0.17, 2.39, 0.36, 0.9)"></div>
                                        <div><span class="mark-donut" id="activeStagePo-@poSignRow">@purchasingDocumentItem.ActiveStageView</span><span class="secondary-text">/@maximumStage</span></div>
                                    </div>
                                }
                                else
                                {
                                    donutProgress = 100;

                                    <div class="po-item-data-header__column po-progress">
                                        <div class="donut-chart" data-donutty data-radius="12" data-thickness="4" data-padding="0"
                                             data-value="@donutProgress" data-round="false" data-color="#8b0000" data-transition="all 2s cubic-bezier(0.17, 2.39, 0.36, 0.9)"></div>
                                        <div>Cancel</div>
                                    </div>
                                }
                            </div>
                            <div class="po-item-data-content__child">
                                @if (childPurchasingDocumentItems.Count() > 0)
                                {
                                    foreach (var childPurchasingDocumentItem in childPurchasingDocumentItems)
                                    {
                                        maximumStage = 10;
                                        donutProgress = childPurchasingDocumentItem.DonutProgress;

                                        if (roleID == "vendor")
                                        {
                                            maximumStage = 9;
                                            donutProgress = childPurchasingDocumentItem.DonutProgressVendor;
                                        }

                                        <div class="po-item-data-content row-@row-@childRow" row="@row" child="@childRow">
                                            <span class="po-item-data-header__column item-id" style="visibility:hidden">@purchasingDocumentItem.ItemNumber</span>
                                            <span class="po-item-data-header__column material" style="visibility:hidden">@purchasingDocumentItem.Material</span>
                                            <span class="po-item-data-header__column description" style="visibility:hidden">@purchasingDocumentItem.Description</span>
                                            @if (childPurchasingDocumentItem.ConfirmedItem != false)
                                            {
                                                <div class="po-item-data-header__column po-progress">
                                                    <div class="donut-chart" data-donutty data-radius="12" data-thickness="4" data-padding="0"
                                                         data-value="@donutProgress" data-round="false" data-color="#567FEF" data-transition="all 2s cubic-bezier(0.17, 2.39, 0.36, 0.9)"></div>
                                                    <div><span class="mark-donut" id="activeStagePo-@poSignRow">@childPurchasingDocumentItem.ActiveStageView</span><span class="secondary-text">/@maximumStage</span></div>
                                                </div>
                                            }
                                            else
                                            {
                                                donutProgress = 100;

                                                <div class="po-item-data-header__column po-progress">
                                                    <div class="donut-chart" data-donutty data-radius="12" data-thickness="4" data-padding="0"
                                                         data-value="@donutProgress" data-round="false" data-color="#8b0000" data-transition="all 2s cubic-bezier(0.17, 2.39, 0.36, 0.9)"></div>
                                                    <div>Cancel</div>
                                                </div>
                                            }
                                        </div>
                                        childRow++;
                                    }
                                }
                            </div>
                        </div>
                        row++;
                    }
                </div>
            </div>
            <div class="custom-scrollbar po-item-scrollable po-sign-row-@poSignRow">
                <div class="po-item-section information">
                    <div class="po-item-section-header justify-content-center">
                        <p class="mb-0">Information</p>
                    </div>
                    <div class="po-item-section-body">
                        <div class="po-item-data-header">
                            <span class="po-item-data-header__text quantity">Qty</span>
                            <span class="po-item-data-header__text currency">Curr</span>
                            <span class="po-item-data-header__text price">Price</span>
                            <span class="po-item-data-header__text delivery">Delivery Date</span>
                        </div>
                        @{
                            var rowInformation = 1;
                        }
                        @foreach (var purchasingDocumentItem in purchasingDocumentItems)
                        {
                            <div class="po-item-data-content row-@rowInformation">
                                <div class="po-item-data-content__outer">
                                    <span class="po-item-data-header__column quantity">@purchasingDocumentItem.Quantity</span>
                                    <span class="po-item-data-header__column currency">@purchasingDocumentItem.Currency</span>
                                    <span class="po-item-data-header__column price">@purchasingDocumentItem.NetPriceView</span>
                                    <span class="po-item-data-header__column delivery">@purchasingDocumentItem.DeliveryDate.GetValueOrDefault().ToString("dd/MM/yyyy")</span>
                                </div>
                            </div>
                            rowInformation++;
                        }
                    </div>
                </div>
                <div class="po-item-section stage-1">
                    <div class="po-item-section-header stage-checkbox-header">
                        @{
                            var st1CheckboxAll = "st1-checkbox-all";
                            var st1AcceptAll = "st1-accept-all-po";

                            if (roleID == "procurement")
                            {
                                st1CheckboxAll = "st1-checkbox-all-proc";
                                st1AcceptAll = "st1-accept-all-po-proc";
                            }
                        }
                        <div>
                            <label class="checkbox-custom__label mr-0">
                                <input class="checkbox-custom @st1CheckboxAll" type="checkbox">
                                <span class="checkmark"></span>
                            </label>
                        </div>
                        <div>
                            <p class="mb-0">Stage 1</p>
                        </div>
                        <div>
                            <input class="btn btn-positive confirm-all-po @st1AcceptAll" type="submit" value="Save All" />
                        </div>
                    </div>
                    <div class="po-item-section-body">
                        <div class="po-item-data-header">
                            <span class="po-item-data-header__text confirm-delivery-date">Confirm PO Date</span>
                            <span class="po-item-data-header__text delivery-option">Delivery Method</span>
                            <span class="po-item-data-header__text quantity-form">Quantity</span>
                        </div>
                        @{
                            var rowStage1 = 1;
                        }
                        @foreach (var purchasingDocumentItem in purchasingDocumentItems)
                        {
                            var childPurchasingDocumentItems = pO.PurchasingDocumentItems.Where(x => x.ParentID == purchasingDocumentItem.ID && x.ID != purchasingDocumentItem.ID);
                            var childRowStage1 = 1;
                            var latestConfirmedDate = purchasingDocumentItem.DeliveryDate.GetValueOrDefault().ToString("dd/MM/yyyy");
                            var latestConfirmedQuantity = purchasingDocumentItem.Quantity;

                            if (purchasingDocumentItem.ConfirmedDate.HasValue)
                            {
                                latestConfirmedDate = purchasingDocumentItem.ConfirmedDateView;
                            }

                            if (purchasingDocumentItem.ConfirmedQuantity.HasValue)
                            {
                                latestConfirmedQuantity = purchasingDocumentItem.ConfirmedQuantity.GetValueOrDefault();
                            }

                            var st1ItemID = "st1-pd-item-id";
                            var st1ItemIDInner = "st1-pd-item-id-inner";
                            var st1ItemQuantity = "st1-pd-item-max-qty";
                            var st1ItemDeliveryDate = "st1-pd-item-delivery-date";
                            var st1ItemIsEdit = "st1-pd-item-is-edit";
                            var st1CheckboxItem = "st1-checkbox-item";
                            var st1ConfirmedDate = "st1-confirmed-date";
                            var st1DeliveryMethod = "st1-delivery-method";
                            var st1PartialConfirmQuantity = "st1-partial-confirm-qty";
                            var st1PartialDate = "st1-partial-date";
                            var st1AcceptItem = "st1-accept-item";
                            var st1CancelItem = "st1-cancel-item";
                            var st1AddRow = "st1-add-row";
                            var st1DelRow = "st1-del-row";
                            var st1EditRow = "st1-edit-row";

                            if (roleID == "procurement")
                            {
                                st1ItemID = "st1-pd-item-id-proc";
                                st1ItemIDInner = "st1-pd-item-id-inner-proc";
                                st1ItemQuantity = "st1-pd-item-max-qty-proc";
                                st1ItemDeliveryDate = "st1-pd-item-delivery-date-proc";
                                st1ItemIsEdit = "st1-pd-item-is-edit-proc";
                                st1CheckboxItem = "st1-checkbox-item-proc";
                                st1ConfirmedDate = "st1-confirmed-date-proc";
                                st1DeliveryMethod = "st1-delivery-method-proc";
                                st1PartialConfirmQuantity = "st1-partial-confirm-qty-proc";
                                st1PartialDate = "st1-partial-date-proc";
                                st1AcceptItem = "st1-accept-item-proc";
                                st1CancelItem = "st1-cancel-item-proc";
                                st1AddRow = "st1-add-row-proc";
                                st1DelRow = "st1-del-row-proc";
                                st1EditRow = "st1-edit-row-proc";
                            }

                            var disabledInputCheckbox = "";
                            var disabledInputConfirmedDate = "disabled";
                            var disabledInputDeliveryMethod = "disabled";
                            var disabledInputQuantity = "disabled";
                            var disabledInputDate = "disabled";
                            var disabledButtonConfirm = "disabled";
                            var disabledButtonCancel = "disabled";
                            var selectedButtonConfirm = "";
                            var selectedButtonCancel = "";
                            var hideChildButton = "style=visibility:hidden";
                            var hideButtonEdit = "style=visibility:hidden";
                            var hideCheckbox = "style=visibility:hidden";
                            var isChecked = "";
                            var isPartial = "";

                            if (roleID == "procurement")
                            {
                                hideCheckbox = "";
                                hideChildButton = "";
                                disabledInputCheckbox = "disabled";

                                if (purchasingDocumentItem.ConfirmedDate.HasValue || purchasingDocumentItem.ConfirmedQuantity.HasValue)
                                {
                                    disabledInputCheckbox = "";
                                }

                                if (purchasingDocumentItem.ConfirmedItem == true)
                                {
                                    disabledInputCheckbox = "disabled";
                                    selectedButtonConfirm = "selected";
                                    isChecked = "checked";
                                    hideButtonEdit = "style=visibility:hidden";
                                }
                                else if (purchasingDocumentItem.ConfirmedItem == false)
                                {
                                    disabledInputCheckbox = "disabled";
                                    selectedButtonCancel = "selected-negative";
                                    isChecked = "checked";
                                    hideButtonEdit = "style=visibility:hidden";

                                    if (!purchasingDocumentItem.ConfirmedDate.HasValue || !purchasingDocumentItem.ConfirmedQuantity.HasValue)
                                    {
                                        hideButtonEdit = "style=visibility:hidden";
                                    }
                                }
                            }
                            else
                            {
                                if (purchasingDocumentItem.ConfirmedItem == false)
                                {
                                    disabledInputCheckbox = "disabled";
                                    selectedButtonCancel = "selected-negative";

                                }
                                else if (purchasingDocumentItem.ConfirmedQuantity.HasValue)
                                {
                                    disabledInputCheckbox = "disabled";
                                    isChecked = "checked";
                                    selectedButtonConfirm = "selected";
                                    hideButtonEdit = "";
                                }

                                if (purchasingDocumentItem.ActiveStage != "1" || childPurchasingDocumentItems.Any(x => x.ActiveStage != "1"))
                                {
                                    hideButtonEdit = "style=visibility:hidden";
                                }
                            }

                            if (childPurchasingDocumentItems.Count() > 0)
                            {
                                isPartial = "selected";
                            }

                            <form class="po-form-item-st1">
                                <div class="po-item-data-content row-@rowStage1" row="@rowStage1">
                                    <div class="po-item-data-content__outer">
                                        <div class="po-item-data-header__column confirm-delivery-date">
                                            <div class="form-inline">
                                                <input type="hidden" class="@st1ItemID" value="@purchasingDocumentItem.ID">
                                                <input type="hidden" class="@st1ItemQuantity" value="@purchasingDocumentItem.Quantity">
                                                <input type="hidden" class="@st1ItemDeliveryDate" value="@purchasingDocumentItem.DeliveryDate.GetValueOrDefault().ToString("dd/MM/yyyy")">
                                                <input type="hidden" class="@st1ItemIsEdit" value="false">
                                                <div class="input-group">
                                                    <label class="checkbox-custom__label">
                                                        <input class="checkbox-custom @st1CheckboxItem" @isChecked type="checkbox" @disabledInputCheckbox>
                                                        <span class="checkmark"></span>
                                                    </label>
                                                    <div class="form-group">
                                                        <input type="text" class="form-control form-date with-icon @st1ConfirmedDate" required autofocus pattern="^([0-2][0-9]|(3)[0-1])(\/)(((0)[0-9])|((1)[0-2]))(\/)\d{4}$" maxlength="10" placeholder="dd/mm/yyyy" @disabledInputConfirmedDate value="@latestConfirmedDate">
                                                        <i class="fas fa-calendar-alt form-type-icon"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="po-item-data-header__column delivery-option">
                                            <div class="form-group">
                                                <select class="form-control @st1DeliveryMethod" @disabledInputDeliveryMethod>
                                                    <option value="full">Full</option>
                                                    <option value="partial" @isPartial>Partial</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="po-item-data-header__column quantity-form">
                                            <div class="form-group">
                                                <input type="number" class="form-control @st1PartialConfirmQuantity" autofocus required pattern="[0-9]" min="1" placeholder="Qty available @purchasingDocumentItem.Quantity" value="@latestConfirmedQuantity" @disabledInputQuantity>
                                            </div>
                                        </div>
                                        <div class="po-item-data-header__column">
                                            <div class="form-inline">
                                                <input type="hidden" class="@st1ItemIDInner" value="@purchasingDocumentItem.ID">
                                                <div class="input-group mr-2">
                                                    <input type="text" class="form-control form-date with-icon @st1PartialDate" required autofocus pattern="^([0-2][0-9]|(3)[0-1])(\/)(((0)[0-9])|((1)[0-2]))(\/)\d{4}$" maxlength="10" maxdate="@latestConfirmedDate" placeholder="dd/mm/yyyy" value="@latestConfirmedDate" @disabledInputDate>
                                                    <i class="fas fa-calendar-alt form-type-icon icon-prepend"></i>
                                                    <div class="input-group-prepend">
                                                        <button type="submit" class="btn btn-positive @st1AcceptItem @selectedButtonConfirm" @disabledButtonConfirm>Yes</button>
                                                    </div>
                                                </div>
                                                <button type="button" class="btn btn-negative @st1CancelItem @selectedButtonCancel" @disabledButtonCancel>No</button>
                                            </div>
                                        </div>
                                        <div class="po-item-data-header__column">
                                            <div class="form-inline">
                                                <a href="#" class="btn-icon @st1AddRow" style="visibility:hidden"><i class="fas fa-plus-circle"></i></a>
                                                <a href="#" class="btn-icon @st1DelRow" style="visibility:hidden"><i class="fas fa-minus-circle"></i></a>
                                                <a href="#" class="btn-icon @st1EditRow" @hideButtonEdit><i class="far fa-edit"></i></a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="po-item-data-content__child">
                                        @if (childPurchasingDocumentItems.Count() > 0)
                                        {
                                            foreach (var childPurchasingDocumentItem in childPurchasingDocumentItems)
                                            {
                                                latestConfirmedDate = childPurchasingDocumentItem.DeliveryDate.GetValueOrDefault().ToString("dd/MM/yyyy");
                                                latestConfirmedQuantity = childPurchasingDocumentItem.Quantity;

                                                if (childPurchasingDocumentItem.ConfirmedDate.HasValue)
                                                {
                                                    latestConfirmedDate = childPurchasingDocumentItem.ConfirmedDateView;
                                                }

                                                if (childPurchasingDocumentItem.ConfirmedQuantity.HasValue)
                                                {
                                                    latestConfirmedQuantity = childPurchasingDocumentItem.ConfirmedQuantity.GetValueOrDefault();
                                                }

                                                disabledInputCheckbox = "";
                                                disabledInputConfirmedDate = "disabled";
                                                disabledInputDeliveryMethod = "disabled";
                                                disabledInputQuantity = "disabled";
                                                disabledInputDate = "disabled";
                                                disabledButtonConfirm = "disabled";
                                                disabledButtonCancel = "disabled";
                                                selectedButtonConfirm = "";
                                                selectedButtonCancel = "";
                                                hideButtonEdit = "style=visibility:hidden";
                                                isChecked = "";
                                                isPartial = "";

                                                if (roleID == "procurement")
                                                {
                                                    disabledInputCheckbox = "disabled";

                                                    if (purchasingDocumentItem.ConfirmedDate.HasValue || purchasingDocumentItem.ConfirmedQuantity.HasValue)
                                                    {
                                                        disabledInputCheckbox = "";
                                                    }

                                                    if (childPurchasingDocumentItem.ConfirmedItem == true)
                                                    {
                                                        disabledInputCheckbox = "disabled";
                                                        selectedButtonConfirm = "selected";
                                                        isChecked = "checked";
                                                        hideButtonEdit = "style=visibility:hidden";
                                                    }
                                                    else if (childPurchasingDocumentItem.ConfirmedItem == false)
                                                    {
                                                        disabledInputCheckbox = "disabled";
                                                        selectedButtonCancel = "selected-negative";
                                                        isChecked = "checked";
                                                        hideButtonEdit = "style=visibility:hidden";

                                                        if (!childPurchasingDocumentItem.ConfirmedDate.HasValue || !childPurchasingDocumentItem.ConfirmedQuantity.HasValue)
                                                        {
                                                            hideButtonEdit = "style=visibility:hidden";
                                                        }
                                                    }
                                                }
                                                else
                                                {
                                                    if (childPurchasingDocumentItem.ConfirmedItem == false)
                                                    {
                                                        disabledInputCheckbox = "disabled";
                                                        selectedButtonCancel = "selected-negative";

                                                    }
                                                    else if (childPurchasingDocumentItem.ConfirmedQuantity.HasValue)
                                                    {
                                                        disabledInputCheckbox = "disabled";
                                                        isChecked = "checked";
                                                        selectedButtonConfirm = "selected";
                                                        hideButtonEdit = "style=visibility:hidden";
                                                    }

                                                    if (childPurchasingDocumentItem.ActiveStage != "1")
                                                    {
                                                        hideButtonEdit = "style=visibility:hidden";
                                                    }
                                                }

                                                <div class="po-item-data-content row-@rowStage1-@childRowStage1" row="@rowStage1" child="@childRowStage1">
                                                    <div class="po-item-data-header__column confirm-delivery-date" @hideCheckbox>
                                                        <div class="form-inline">
                                                            <div class="input-group">
                                                                <label class="checkbox-custom__label">
                                                                    <input class="checkbox-custom @st1CheckboxItem" @isChecked type="checkbox" @disabledInputCheckbox>
                                                                    <span class="checkmark"></span>
                                                                </label>
                                                                <div class="form-group" style="visibility:hidden">
                                                                    <input type="text" class="form-control form-date with-icon" required autofocus pattern="^([0-2][0-9]|(3)[0-1])(\/)(((0)[0-9])|((1)[0-2]))(\/)\d{4}$" maxlength="10" maxdate="@latestConfirmedDate" placeholder="dd/mm/yyyy" disabled>
                                                                    <i class="fas fa-calendar-alt form-type-icon"></i>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="po-item-data-header__column delivery-option" style="visibility:hidden">
                                                        <div class="form-inline">
                                                            <div class="form-group">
                                                                <select class="form-control" disabled>
                                                                    <option value="full">Full</option>
                                                                    <option value="partial">Partial</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="po-item-data-header__column quantity-form">
                                                        <div class="form-inline">
                                                            <input type="number" class="form-control @st1PartialConfirmQuantity" autofocus required pattern="[0-9]" min="1" placeholder="Qty available @purchasingDocumentItem.Quantity" value="@latestConfirmedQuantity" @disabledInputQuantity>
                                                        </div>
                                                    </div>
                                                    <div class="po-item-data-header__column">
                                                        <div class="form-inline">
                                                            <input type="hidden" class="@st1ItemIDInner" value="@childPurchasingDocumentItem.ID">
                                                            <div class="input-group mr-2">
                                                                <input type="text" class="form-control form-date with-icon @st1PartialDate" required autofocus pattern="^([0-2][0-9]|(3)[0-1])(\/)(((0)[0-9])|((1)[0-2]))(\/)\d{4}$" maxlength="10" maxdate="@latestConfirmedDate" placeholder="dd/mm/yyyy" value="@latestConfirmedDate" @disabledInputDate>
                                                                <i class="fas fa-calendar-alt form-type-icon icon-prepend" @hideChildButton></i>
                                                                <div class="input-group-prepend" @hideChildButton>
                                                                    <button type="submit" class="btn btn-positive @st1AcceptItem @selectedButtonConfirm" @disabledButtonConfirm>Yes</button>
                                                                </div>
                                                            </div>
                                                            <button type="button" class="btn btn-negative @st1CancelItem @selectedButtonCancel" @disabledButtonCancel @hideChildButton>No</button>
                                                        </div>
                                                    </div>
                                                    <div class="po-item-data-header__column">
                                                        <div class="form-inline">
                                                            <a href="#" class="btn-icon" style="visibility:hidden"><i class="fas fa-plus-circle"></i></a>
                                                            <a href="#" class="btn-icon" style="visibility:hidden"><i class="fas fa-minus-circle"></i></a>
                                                            <a href="#" class="btn-icon @st1EditRow" @hideButtonEdit><i class="far fa-edit"></i></a>
                                                        </div>
                                                    </div>
                                                </div>
                                                childRowStage1++;
                                            }
                                        }
                                    </div>
                                </div>
                            </form>
                            rowStage1++;
                        }
                    </div>
                </div>
                <div class="po-item-section stage-2">
                    @if (roleID == "procurement")
                    {
                        <div class="po-item-section-header stage-checkbox-header">
                            <div>
                                <label class="checkbox-custom__label mr-0">
                                    <input class="checkbox-custom st2-proc-checkbox-all" type="checkbox">
                                    <span class="checkmark"></span>
                                </label>
                            </div>
                            <div><p class="mb-0">Stage 2</p></div>
                            <div>
                                <input class="btn btn-positive st2-proc-accept-first-eta-all" type="submit" value="Save All" />
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="po-item-section-header stage-checkbox-header">
                            <div>
                                <label class="checkbox-custom__label mr-0">
                                    <input class="checkbox-custom st2-checkbox-all" type="checkbox">
                                    <span class="checkmark"></span>
                                </label>
                            </div>
                            <div><p class="mb-0">Stage 2</p></div>
                            <div>
                                <input class="btn btn-positive st2-confirm-first-eta-all" type="submit" value="Save All" />
                            </div>
                        </div>
                    }
                    <div class="po-item-section-body">
                        <div class="po-item-data-header">
                            <span class="po-item-data-header__text stage2-confirm-eta">Confirm ETA</span>
                        </div>
                        @{
                            var rowStage2 = 1;
                        }
                        @foreach (var purchasingDocumentItem in purchasingDocumentItems)
                        {

                            var childPurchasingDocumentItems = pO.PurchasingDocumentItems.Where(x => x.ParentID == purchasingDocumentItem.ID && x.ID != purchasingDocumentItem.ID);
                            var childRowStage2 = 1;

                            var st2CheckboxItem = "st2-checkbox-item";
                            var st2ItemId = "st2-pd-item-id";
                            var st2FirstEtaDate = "st2-first-eta-date";
                            var st2ConfirmFirstEta = "st2-confirm-first-eta";
                            var st2EditRow = "edit-row-st2";
                            var st2ProcAcceptFirstEta = "";
                            var st2ProcDeclineFirstEta = "";

                            if (roleID == "procurement")
                            {
                                st2CheckboxItem = "st2-proc-checkbox-item";
                                st2ItemId = "st2-proc-pd-item-id";
                                st2FirstEtaDate = "st2-proc-first-eta-date";
                                st2ConfirmFirstEta = "st2-proc-confirm-first-eta";
                                st2ProcAcceptFirstEta = "st2-proc-accept-first-eta";
                                st2ProcDeclineFirstEta = "st2-proc-decline-first-eta";
                                st2EditRow = "edit-row-st2-proc";
                            }

                            var selectedButtonAccept = "";
                            var selectedButtonDecline = "";
                            var disabledInputCheckbox = "disabled";
                            var disabledInputFirstEtaDate = "disabled";
                            var disabledButtonConfirmEtaDate = "disabled";
                            var disabledButtonAccept = "disabled";
                            var disabledButtonDecline = "disabled";
                            var selectedButtonConfirm = "";
                            var visibilityCheckbox = "";
                            var hideButtonEdit = "style=visibility:hidden";
                            var hiddenButtonConfirmEtaDate = "";
                            var hiddenButtonAcceptDecline = "hidden";
                            var isChecked = "";

                            var valueInputFirstEtaDate = "";

                            if (purchasingDocumentItem.HasETAHistory)
                            {
                                valueInputFirstEtaDate = purchasingDocumentItem.FirstETAHistory.ETADateView;
                            }
                            else if (purchasingDocumentItem.ConfirmedItem == true)
                            {
                                valueInputFirstEtaDate = purchasingDocumentItem.ConfirmedDateView;
                            }

                            if (roleID == "procurement")
                            {
                                hiddenButtonConfirmEtaDate = "hidden";
                                hiddenButtonAcceptDecline = "";

                                if (purchasingDocumentItem.ActiveStage == "2" && purchasingDocumentItem.HasETAHistory && purchasingDocumentItem.FirstETAHistory.AcceptedByProcurement == null)
                                {
                                    disabledInputCheckbox = "";
                                }
                                else if (purchasingDocumentItem.FirstETAHistory.AcceptedByProcurement == true)
                                {
                                    isChecked = "checked";
                                    selectedButtonAccept = "selected";

                                    if (purchasingDocumentItem.ActiveStage == "2a")
                                    {
                                        hideButtonEdit = "style=visibility:display";
                                    }
                                }
                                else if (purchasingDocumentItem.FirstETAHistory.AcceptedByProcurement == false)
                                {
                                    isChecked = "checked";
                                    selectedButtonDecline = "selected-negative";

                                    if (purchasingDocumentItem.ActiveStage == "2a")
                                    {
                                        hideButtonEdit = "style=visibility:display";
                                    }
                                }

                            }
                            else
                            {
                                hiddenButtonConfirmEtaDate = "";
                                hiddenButtonAcceptDecline = "hidden";

                                if (purchasingDocumentItem.ActiveStage == "2" && !purchasingDocumentItem.HasETAHistory)
                                {
                                    disabledInputCheckbox = "";
                                }
                                else if (purchasingDocumentItem.HasETAHistory)
                                {
                                    isChecked = "checked";
                                    selectedButtonConfirm = "selected";

                                    if (purchasingDocumentItem.ActiveStage == "2" && purchasingDocumentItem.FirstETAHistory.AcceptedByProcurement == null)
                                    {
                                        hideButtonEdit = "style=visibility:display";
                                    }
                                }
                            }

                            <div class="po-item-data-content row-@rowStage2" row="@rowStage2" style="display:block;">
                                <div class="po-item-data-content__outer">
                                    <form class="d-flex po-form-item-st2">
                                        <div class="po-item-data-header__column stage2-confirm-eta">
                                            <div class="form-inline">
                                                <label class="checkbox-custom__label" @visibilityCheckbox>
                                                    <input class="checkbox-custom @st2CheckboxItem" type="checkbox" @isChecked @disabledInputCheckbox>
                                                    <span class="checkmark"></span>
                                                </label>
                                                <div class="form-group mr-2">
                                                    <input type="hidden" class="@st2ItemId" value="@purchasingDocumentItem.ID">
                                                    <input type="text" class="form-control form-date with-icon @st2FirstEtaDate" value="@valueInputFirstEtaDate" required autofocus pattern="^([0-2][0-9]|(3)[0-1])(\/)(((0)[0-9])|((1)[0-2]))(\/)\d{4}$" maxlength="10" mindate="@purchasingDocumentItem.ConfirmedDateView" placeholder="dd/mm/yyyy" autocomplete="off" @disabledInputFirstEtaDate>
                                                    <i class="far fa-calendar-alt form-type-icon"></i>
                                                </div>
                                                <button class="btn btn-positive @st2ConfirmFirstEta @selectedButtonConfirm" @disabledButtonConfirmEtaDate @hiddenButtonConfirmEtaDate>Save</button>
                                                <button class="btn btn-positive @st2ProcAcceptFirstEta @selectedButtonAccept mr-2" @disabledButtonAccept @hiddenButtonAcceptDecline>Yes</button>
                                                <button class="btn btn-negative @st2ProcDeclineFirstEta @selectedButtonDecline" @disabledButtonDecline @hiddenButtonAcceptDecline>No</button>
                                            </div>
                                        </div>
                                        <a href="#" class="btn-icon @st2EditRow ml-1" @hideButtonEdit><i class="far fa-edit"></i></a>
                                    </form>
                                </div>
                                <div class="po-item-data-content__child">
                                    @if (childPurchasingDocumentItems.Count() > 0)
                                    {
                                        foreach (var childPurchasingDocumentItem in childPurchasingDocumentItems)
                                        {

                                            selectedButtonAccept = "";
                                            selectedButtonDecline = "";
                                            disabledInputCheckbox = "disabled";
                                            disabledInputFirstEtaDate = "disabled";
                                            disabledButtonConfirmEtaDate = "disabled";
                                            disabledButtonAccept = "disabled";
                                            disabledButtonDecline = "disabled";
                                            selectedButtonConfirm = "";
                                            visibilityCheckbox = "";
                                            hideButtonEdit = "style=visibility:hidden";
                                            hiddenButtonConfirmEtaDate = "";
                                            hiddenButtonAcceptDecline = "hidden";
                                            isChecked = "";

                                            valueInputFirstEtaDate = "";

                                            if (childPurchasingDocumentItem.HasETAHistory)
                                            {
                                                valueInputFirstEtaDate = childPurchasingDocumentItem.FirstETAHistory.ETADateView;
                                            }
                                            else if (childPurchasingDocumentItem.ConfirmedItem == true)
                                            {
                                                valueInputFirstEtaDate = childPurchasingDocumentItem.ConfirmedDateView;
                                            }

                                            if (roleID == "procurement")
                                            {
                                                hiddenButtonConfirmEtaDate = "hidden";
                                                hiddenButtonAcceptDecline = "";

                                                if (childPurchasingDocumentItem.ActiveStage == "2" && childPurchasingDocumentItem.HasETAHistory && childPurchasingDocumentItem.FirstETAHistory.AcceptedByProcurement == null)
                                                {
                                                    disabledInputCheckbox = "";
                                                }
                                                else if (childPurchasingDocumentItem.FirstETAHistory.AcceptedByProcurement == true)
                                                {
                                                    isChecked = "checked";
                                                    selectedButtonAccept = "selected";

                                                    if (childPurchasingDocumentItem.ActiveStage == "2a")
                                                    {
                                                        hideButtonEdit = "style=visibility:display";
                                                    }
                                                }
                                                else if (childPurchasingDocumentItem.FirstETAHistory.AcceptedByProcurement == false)
                                                {
                                                    isChecked = "checked";
                                                    selectedButtonDecline = "selected-negative";

                                                    if (childPurchasingDocumentItem.ActiveStage == "2a")
                                                    {
                                                        hideButtonEdit = "style=visibility:display";
                                                    }
                                                }

                                            }
                                            else
                                            {
                                                hiddenButtonConfirmEtaDate = "";
                                                hiddenButtonAcceptDecline = "hidden";

                                                if (childPurchasingDocumentItem.ActiveStage == "2" && !childPurchasingDocumentItem.HasETAHistory)
                                                {
                                                    disabledInputCheckbox = "";
                                                }
                                                else if (childPurchasingDocumentItem.HasETAHistory)
                                                {
                                                    isChecked = "checked";
                                                    selectedButtonConfirm = "selected";

                                                    if (childPurchasingDocumentItem.ActiveStage == "2" && childPurchasingDocumentItem.FirstETAHistory.AcceptedByProcurement == null)
                                                    {
                                                        hideButtonEdit = "style=visibility:display";
                                                    }
                                                }
                                            }

                                            <div class="po-item-data-content row-@rowStage2-@childRowStage2" row="@rowStage2" child="@childRowStage2">
                                                <form class="d-flex po-form-item-st2">
                                                    <div class="po-item-data-header__column stage2-confirm-eta">
                                                        <div class="form-inline">
                                                            <label class="checkbox-custom__label" @visibilityCheckbox>
                                                                <input class="checkbox-custom @st2CheckboxItem" type="checkbox" @isChecked @disabledInputCheckbox>
                                                                <span class="checkmark"></span>
                                                            </label>
                                                            <div class="form-group mr-2">
                                                                <input type="hidden" class="@st2ItemId" value="@childPurchasingDocumentItem.ID">
                                                                <input type="text" class="form-control form-date with-icon @st2FirstEtaDate" value="@valueInputFirstEtaDate" required autofocus pattern="^([0-2][0-9]|(3)[0-1])(\/)(((0)[0-9])|((1)[0-2]))(\/)\d{4}$" maxlength="10" mindate="@childPurchasingDocumentItem.ConfirmedDateView" placeholder="dd/mm/yyyy" autocomplete="off" @disabledInputFirstEtaDate>
                                                                <i class="far fa-calendar-alt form-type-icon"></i>
                                                            </div>
                                                            <button class="btn btn-positive @st2ConfirmFirstEta @selectedButtonConfirm" @disabledButtonConfirmEtaDate @hiddenButtonConfirmEtaDate>Save</button>
                                                            <button class="btn btn-positive @st2ProcAcceptFirstEta @selectedButtonAccept mr-2" @disabledButtonAccept @hiddenButtonAcceptDecline>Yes</button>
                                                            <button class="btn btn-negative @st2ProcDeclineFirstEta @selectedButtonDecline" @disabledButtonDecline @hiddenButtonAcceptDecline>No</button>
                                                        </div>
                                                    </div>
                                                    <a href="#" class="btn-icon @st2EditRow ml-1" @hideButtonEdit><i class="far fa-edit"></i></a>
                                                </form>
                                            </div>
                                            childRowStage2++;
                                        }
                                    }
                                </div>
                            </div>
                            rowStage2++;
                        }
                    </div>
                </div>
                <div class="po-item-section stage-3">
                    <div class="po-item-section-header justify-content-center">
                        <p class="mb-0">Stage 2a</p>
                    </div>
                    <div class="po-item-section-body">
                        <div class="po-item-data-header">
                            <span class="po-item-data-header__text">Upload Proforma Invoice</span>
                        </div>
                        @{
                            var rowStage2a = 1;
                        }
                        @foreach (var purchasingDocumentItem in purchasingDocumentItems)
                        {
                            var childPurchasingDocumentItems = pO.PurchasingDocumentItems.Where(x => x.ParentID == purchasingDocumentItem.ID && x.ID != purchasingDocumentItem.ID);
                            var childRowStage2a = 1;

                            var st2aItemId = "st2a-item-id";
                            var st2aFileProformaInvoice = "st2a-file-proforma-invoice";
                            var st2aUploadProformaInvoice = "st2a-upload-proforma-invoice";
                            //var st2aApproveProforma = "";
                            //var st2aDisApproveProforma = "";
                            var st2aDownloadProforma = "st2a-download-proforma";
                            var st2aSkipProforma = "st2a-skip-proforma";

                            if (roleID == "procurement")
                            {
                                //st2aApproveProforma = "st2a-approve-proforma-proc";
                                //st2aDisApproveProforma = "st2a-disapprove-proforma-proc";
                            }

                            var disabledFileProformaInvoice = "";
                            var disabledUploadProformaInvoice = "";
                            //var disabledApproveProforma = "disabled";
                            //var disabledDisApproveProforma = "disabled";
                            var disabledSkipProforma = "";
                            //var selectedApproveProforma = "";
                            //var selectedDisApproveProforma = "";
                            var selectedSkipProforma = "";
                            //var hiddenApproveProforma = "hidden";
                            //var hiddenDisApproveProforma = "hidden";
                            var hiddenInputDiv = "";
                            var hiddenUploadedDiv = "hidden";
                            var hiddenSkipProforma = "disabled";
                            var downloadPath = "";

                            if (purchasingDocumentItem.ProformaInvoiceDocument == null)
                            {
                                if (purchasingDocumentItem.ActiveStage == "2a")
                                {
                                    if (roleID == "procurement")
                                    {
                                        disabledSkipProforma = "disabled";
                                        disabledFileProformaInvoice = "disabled";
                                        disabledUploadProformaInvoice = "disabled";
                                    }
                                    else
                                    {
                                        disabledSkipProforma = "";
                                        hiddenSkipProforma = "";
                                        disabledFileProformaInvoice = "";
                                        disabledUploadProformaInvoice = "";
                                    }
                                }
                                else if (Convert.ToInt32(purchasingDocumentItem.ActiveStageView) > 2)
                                {
                                    disabledSkipProforma = "disabled";
                                    disabledFileProformaInvoice = "disabled";
                                    disabledUploadProformaInvoice = "disabled";
                                    selectedSkipProforma = "selected-negative";
                                }
                                else
                                {
                                    disabledSkipProforma = "disabled";
                                    disabledFileProformaInvoice = "disabled";
                                    disabledUploadProformaInvoice = "disabled";
                                }
                            }

                            if (purchasingDocumentItem.ProformaInvoiceDocument != null)
                            {
                                disabledSkipProforma = "disabled";
                                hiddenSkipProforma = "";
                                hiddenInputDiv = "hidden";
                                hiddenUploadedDiv = "";
                                downloadPath = Path.Combine("Files\\Import\\ProformaInvoice", purchasingDocumentItem.ProformaInvoiceDocument);

                                if (roleID == "procurement")
                                {
                                    disabledSkipProforma = "disabled";
                                    //disabledApproveProforma = "";
                                    //disabledDisApproveProforma = "";
                                    //hiddenApproveProforma = "";
                                    //hiddenDisApproveProforma = "";

                                    if (purchasingDocumentItem.ApproveProformaInvoiceDocument == true)
                                    {
                                        //disabledApproveProforma = "disabled";
                                        //disabledDisApproveProforma = "disabled";
                                        //selectedApproveProforma = "selected";
                                    }
                                    else if (purchasingDocumentItem.ApproveProformaInvoiceDocument == false)
                                    {
                                        //disabledApproveProforma = "disabled";
                                        //disabledDisApproveProforma = "disabled";
                                        //selectedDisApproveProforma = "selected-negative";
                                    }
                                }
                                else
                                {
                                    if (purchasingDocumentItem.ApproveProformaInvoiceDocument == true)
                                    {
                                        //disabledApproveProforma = "disabled";
                                        //disabledDisApproveProforma = "disabled";
                                        //selectedApproveProforma = "selected";
                                    }
                                    else if (purchasingDocumentItem.ApproveProformaInvoiceDocument == false)
                                    {
                                        hiddenInputDiv = "";
                                        hiddenUploadedDiv = "hidden";
                                    }
                                }
                            }

                            <div class="po-item-data-content row-@rowStage2a">
                                <div class="po-item-data-content__outer">
                                    <form class="po-form-item-st2a">
                                        <div class="po-item-data-header__column">
                                            <div class="form-inline" @hiddenInputDiv>
                                                <div class="form-group mr-2">
                                                    <input type="hidden" class="@st2aItemId" value="@purchasingDocumentItem.ID">
                                                    <input type="file" class="form-control with-icon @st2aFileProformaInvoice" @disabledFileProformaInvoice>
                                                    <i class="fas fa-paperclip form-type-icon"></i>
                                                </div>
                                                <button class="btn btn-positive @st2aUploadProformaInvoice mr-2" @disabledUploadProformaInvoice>Save</button>
                                                <button class="btn btn-negative @st2aSkipProforma @selectedSkipProforma" @hiddenSkipProforma @disabledSkipProforma>Skip</button>
                                            </div>

                                            <div class="form-inline" @hiddenUploadedDiv>
                                                <div class="form-group mr-2">
                                                    <p class="mt-2 mb-0">
                                                        <a class="@st2aDownloadProforma" href="@downloadPath">Proforma Invoice</a> uploaded<i class="fas fa-check-circle primary ml-2"></i>
                                                    </p>
                                                </div>
                                                @*<div class="form-group mr-2">
                                                        <input type="hidden" class="@st2aItemId" value="@purchasingDocumentItem.ID">
                                                        <button class="btn btn-positive @st2aApproveProforma @selectedApproveProforma" @hiddenApproveProforma @disabledApproveProforma>Yes</button>
                                                        <button class="btn btn-negative @st2aDisApproveProforma @selectedDisApproveProforma" @hiddenDisApproveProforma @disabledDisApproveProforma>No</button>
                                                    </div>*@
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="po-item-data-content__child">
                                    @if (childPurchasingDocumentItems.Count() > 0)
                                    {
                                        foreach (var childPurchasingDocumentItem in childPurchasingDocumentItems)
                                        {

                                            disabledFileProformaInvoice = "";
                                            disabledUploadProformaInvoice = "";
                                            //disabledApproveProforma = "disabled";
                                            //disabledDisApproveProforma = "disabled";
                                            disabledSkipProforma = "";
                                            //selectedApproveProforma = "";
                                            //selectedDisApproveProforma = "";
                                            selectedSkipProforma = "";
                                            //hiddenApproveProforma = "hidden";
                                            //hiddenDisApproveProforma = "hidden";
                                            hiddenInputDiv = "";
                                            hiddenUploadedDiv = "hidden";
                                            hiddenSkipProforma = "disabled";
                                            downloadPath = "";

                                            if (childPurchasingDocumentItem.ProformaInvoiceDocument == null)
                                            {
                                                if (childPurchasingDocumentItem.ActiveStage == "2a")
                                                {
                                                    if (roleID == "procurement")
                                                    {
                                                        disabledSkipProforma = "disabled";
                                                        disabledFileProformaInvoice = "disabled";
                                                        disabledUploadProformaInvoice = "disabled";
                                                    }
                                                    else
                                                    {
                                                        disabledSkipProforma = "";
                                                        hiddenSkipProforma = "";
                                                        disabledFileProformaInvoice = "";
                                                        disabledUploadProformaInvoice = "";
                                                    }
                                                }
                                                else if (Convert.ToInt32(childPurchasingDocumentItem.ActiveStageView) > 2)
                                                {
                                                    disabledSkipProforma = "disabled";
                                                    disabledFileProformaInvoice = "disabled";
                                                    disabledUploadProformaInvoice = "disabled";
                                                    selectedSkipProforma = "selected-negative";
                                                }
                                                else
                                                {
                                                    disabledSkipProforma = "disabled";
                                                    disabledFileProformaInvoice = "disabled";
                                                    disabledUploadProformaInvoice = "disabled";
                                                }
                                            }

                                            if (childPurchasingDocumentItem.ProformaInvoiceDocument != null)
                                            {
                                                disabledSkipProforma = "disabled";
                                                hiddenSkipProforma = "";
                                                hiddenInputDiv = "hidden";
                                                hiddenUploadedDiv = "";
                                                downloadPath = Path.Combine("Files\\Import\\ProformaInvoice", childPurchasingDocumentItem.ProformaInvoiceDocument);

                                                if (roleID == "procurement")
                                                {
                                                    disabledSkipProforma = "disabled";
                                                    //disabledApproveProforma = "";
                                                    //disabledDisApproveProforma = "";
                                                    //hiddenApproveProforma = "";
                                                    //hiddenDisApproveProforma = "";

                                                    if (childPurchasingDocumentItem.ApproveProformaInvoiceDocument == true)
                                                    {
                                                        //disabledApproveProforma = "disabled";
                                                        //disabledDisApproveProforma = "disabled";
                                                        //selectedApproveProforma = "selected";
                                                    }
                                                    else if (childPurchasingDocumentItem.ApproveProformaInvoiceDocument == false)
                                                    {
                                                        //disabledApproveProforma = "disabled";
                                                        //disabledDisApproveProforma = "disabled";
                                                        //selectedDisApproveProforma = "selected-negative";
                                                    }
                                                }
                                                else
                                                {
                                                    if (childPurchasingDocumentItem.ApproveProformaInvoiceDocument == true)
                                                    {
                                                        //disabledApproveProforma = "disabled";
                                                        //disabledDisApproveProforma = "disabled";
                                                        //selectedApproveProforma = "selected";
                                                    }
                                                    else if (childPurchasingDocumentItem.ApproveProformaInvoiceDocument == false)
                                                    {
                                                        hiddenInputDiv = "";
                                                        hiddenUploadedDiv = "hidden";
                                                    }
                                                }
                                            }

                                            <div class="po-item-data-content row-@rowStage2a-@childRowStage2a" row="@rowStage2a" child="@childRowStage2a">
                                                <form class="po-form-item-st2a">
                                                    <div class="po-item-data-header__column">
                                                        <div class="form-inline" @hiddenInputDiv>
                                                            <div class="form-group mr-2">
                                                                <input type="hidden" class="@st2aItemId" value="@childPurchasingDocumentItem.ID">
                                                                <input type="file" class="form-control with-icon @st2aFileProformaInvoice" @disabledFileProformaInvoice>
                                                                <i class="fas fa-paperclip form-type-icon"></i>
                                                            </div>
                                                            <button class="btn btn-positive @st2aUploadProformaInvoice mr-2" @disabledUploadProformaInvoice>Save</button>
                                                            <button class="btn btn-negative @st2aSkipProforma @selectedSkipProforma" @hiddenSkipProforma @disabledSkipProforma>Skip</button>
                                                        </div>

                                                        <div class="form-inline" @hiddenUploadedDiv>
                                                            <div class="form-group mr-2">
                                                                <p class="mt-2 mb-0">
                                                                    <a class="@st2aDownloadProforma" href="@downloadPath">Proforma Invoice</a> uploaded<i class="fas fa-check-circle primary ml-2"></i>
                                                                </p>
                                                            </div>
                                                            @*<div class="form-group mr-2">
                                                                    <input type="hidden" class="@st2aItemId" value="@childPurchasingDocumentItem.ID">
                                                                    <button class="btn btn-positive @st2aApproveProforma @selectedApproveProforma" @hiddenApproveProforma @disabledApproveProforma>Yes</button>
                                                                    <button class="btn btn-negative @st2aDisApproveProforma @selectedDisApproveProforma" @hiddenDisApproveProforma @disabledDisApproveProforma>No</button>
                                                                </div>*@
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                            childRowStage2a++;
                                        }
                                    }
                                </div>
                            </div>
                            rowStage2a++;
                        }
                    </div>
                </div>
                <div class="po-item-section stage-4">
                    @if (roleID == "procurement")
                    {
                        <div class="po-item-section-header justify-content-center">
                            <p class="mb-0">Stage 3</p>
                        </div>
                    }
                    else
                    {
                        <div class="po-item-section-header stage-checkbox-header">
                            <div>
                                <label class="checkbox-custom__label mr-0">
                                    <input class="checkbox-custom st3-checkbox-all" type="checkbox">
                                    <span class="checkmark"></span>
                                </label>
                            </div>
                            <div><p class="mb-0">Stage 3</p></div>
                            <div>
                                <input class="btn btn-positive st3-confirm-payment-all" type="submit" value="Save All" />
                            </div>
                        </div>
                    }
                    <div class="po-item-section-body">
                        <div class="po-item-data-header">
                            <span class="po-item-data-header__text">Confirm Payment Received</span>
                        </div>
                        @{
                            var rowStage3 = 1;
                        }
                        @foreach (var purchasingDocumentItem in purchasingDocumentItems)
                        {
                            var childPurchasingDocumentItems = pO.PurchasingDocumentItems.Where(x => x.ParentID == purchasingDocumentItem.ID && x.ID != purchasingDocumentItem.ID);
                            var childRowStage3 = 1;

                            var st3CheckboxItem = "st3-checkbox-item";
                            var st3ItemID = "st3-item-id";
                            var st3ItemConfirmPaymentDate = "st3-item-confirm-payment-date";
                            var st3ConfirmPaymentSubmit = "st3-confirm-payment-submit";
                            var st3ConfirmPaymentSkip = "st3-confirm-payment-skip";
                            var st3EditRow = "edit-row-st3";

                            var disabledCheckboxItem = "disabled";
                            var disabledConfirmPaymentDate = "disabled";
                            var disabledConfirmPaymentSubmit = "disabled";
                            var disabledConfirmPaymentSkip = "disabled";
                            var selectedConfirmPaymentSubmit = "";
                            var selectedConfirmPaymentSkip = "";
                            var hiddenEditButton = "style=visibility:hidden";
                            var hiddenConfirmPaymentSkip = "";
                            var hiddenCheckbox = "";
                            var isChecked = "";

                            if (purchasingDocumentItem.ActiveStage == "3")
                            {
                                disabledCheckboxItem = "";
                            }
                            else if (purchasingDocumentItem.ConfirmReceivedPaymentDate.HasValue)
                            {
                                isChecked = "checked";
                                selectedConfirmPaymentSubmit = "selected";

                                if (purchasingDocumentItem.ActiveStage == "4")
                                {
                                    hiddenEditButton = "";
                                }
                            }
                            else if (!purchasingDocumentItem.ConfirmReceivedPaymentDate.HasValue)
                            {
                                if (purchasingDocumentItem.ActiveStageView != "2a")
                                {
                                    if (Convert.ToInt32(purchasingDocumentItem.ActiveStageView) > 3)
                                    {
                                        isChecked = "checked";
                                        selectedConfirmPaymentSkip = "selected-negative";
                                    }

                                    if (purchasingDocumentItem.ActiveStage == "4")
                                    {
                                        hiddenEditButton = "";
                                    }
                                }
                            }

                            if (roleID == "procurement")
                            {
                                hiddenCheckbox = "style=visibility:hidden";
                                hiddenEditButton = "hidden";
                            }

                            <div class="po-item-data-content row-@rowStage3">
                                <div class="po-item-data-content__outer">
                                    <form class="po-form-item-st3">
                                        <div class="po-item-data-header__column">
                                            <div class="form-inline">
                                                <label class="checkbox-custom__label" @hiddenCheckbox>
                                                    <input class="checkbox-custom @st3CheckboxItem" @isChecked type="checkbox" @disabledCheckboxItem>
                                                    <span class="checkmark"></span>
                                                </label>
                                                <div class="form-group mr-2">
                                                    <input type="hidden" class="@st3ItemID" value="@purchasingDocumentItem.ID" />
                                                    <input type="text" class="form-control form-date with-icon @st3ItemConfirmPaymentDate" required="" autofocus="" pattern="^([0-2][0-9]|(3)[0-1])(\/)(((0)[0-9])|((1)[0-2]))(\/)\d{4}$" maxlength="10" placeholder="dd/mm/yyyy" autocomplete="off" value="@purchasingDocumentItem.ConfirmReceivedPaymentDateView" @disabledConfirmPaymentDate>
                                                    <i class="far fa-calendar-alt form-type-icon"></i>
                                                </div>
                                                <button type="submit" class="btn btn-positive @st3ConfirmPaymentSubmit @selectedConfirmPaymentSubmit mr-2" @disabledConfirmPaymentSubmit>Received</button>
                                                <button class="btn btn-negative @st3ConfirmPaymentSkip @selectedConfirmPaymentSkip" @disabledConfirmPaymentSkip @hiddenConfirmPaymentSkip>Skip</button>
                                                <a href="#" class="btn-icon @st3EditRow ml-1" @hiddenEditButton><i class="far fa-edit"></i></a>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="po-item-data-content__child">
                                    @if (childPurchasingDocumentItems.Count() > 0)
                                    {
                                        foreach (var childPurchasingDocumentItem in childPurchasingDocumentItems)
                                        {
                                            disabledCheckboxItem = "disabled";
                                            disabledConfirmPaymentDate = "disabled";
                                            disabledConfirmPaymentSubmit = "disabled";
                                            disabledConfirmPaymentSkip = "disabled";
                                            selectedConfirmPaymentSubmit = "";
                                            selectedConfirmPaymentSkip = "";
                                            hiddenEditButton = "style=visibility:hidden";
                                            hiddenConfirmPaymentSkip = "";
                                            hiddenCheckbox = "";
                                            isChecked = "";

                                            if (childPurchasingDocumentItem.ActiveStage == "3")
                                            {
                                                disabledCheckboxItem = "";
                                            }
                                            else if (childPurchasingDocumentItem.ConfirmReceivedPaymentDate.HasValue)
                                            {
                                                isChecked = "checked";
                                                selectedConfirmPaymentSubmit = "selected";

                                                if (childPurchasingDocumentItem.ActiveStage == "4")
                                                {
                                                    hiddenEditButton = "";
                                                }
                                            }
                                            else if (!childPurchasingDocumentItem.ConfirmReceivedPaymentDate.HasValue)
                                            {
                                                if (childPurchasingDocumentItem.ActiveStageView != "2a")
                                                {
                                                    if (Convert.ToInt32(childPurchasingDocumentItem.ActiveStageView) > 3)
                                                    {
                                                        isChecked = "checked";
                                                        selectedConfirmPaymentSkip = "selected-negative";
                                                    }

                                                    if (childPurchasingDocumentItem.ActiveStage == "4")
                                                    {
                                                        hiddenEditButton = "";
                                                    }
                                                }
                                            }

                                            if (roleID == "procurement")
                                            {
                                                hiddenCheckbox = "style=visibility:hidden";
                                                hiddenEditButton = "hidden";
                                            }

                                            <div class="po-item-data-content row-@rowStage3-@childRowStage3" row="@rowStage3" child="@childRowStage3">
                                                <form class="po-form-item-st3">
                                                    <div class="po-item-data-header__column">
                                                        <div class="form-inline">
                                                            <label class="checkbox-custom__label" @hiddenCheckbox>
                                                                <input class="checkbox-custom @st3CheckboxItem" @isChecked type="checkbox" @disabledCheckboxItem>
                                                                <span class="checkmark"></span>
                                                            </label>
                                                            <div class="form-group mr-2">
                                                                <input type="hidden" class="@st3ItemID" value="@childPurchasingDocumentItem.ID" />
                                                                <input type="text" class="form-control form-date with-icon @st3ItemConfirmPaymentDate" required="" autofocus="" pattern="^([0-2][0-9]|(3)[0-1])(\/)(((0)[0-9])|((1)[0-2]))(\/)\d{4}$" maxlength="10" placeholder="dd/mm/yyyy" autocomplete="off" value="@childPurchasingDocumentItem.ConfirmReceivedPaymentDateView" @disabledConfirmPaymentDate>
                                                                <i class="far fa-calendar-alt form-type-icon"></i>
                                                            </div>
                                                            <button type="submit" class="btn btn-positive @st3ConfirmPaymentSubmit @selectedConfirmPaymentSubmit mr-2" @disabledConfirmPaymentSubmit>Received</button>
                                                            <button class="btn btn-negative @st3ConfirmPaymentSkip @selectedConfirmPaymentSkip" @disabledConfirmPaymentSkip @hiddenConfirmPaymentSkip>Skip</button>
                                                            <a href="#" class="btn-icon @st3EditRow ml-1" @hiddenEditButton><i class="far fa-edit"></i></a>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                            childRowStage3++;
                                        }
                                    }
                                </div>
                            </div>
                            rowStage3++;
                        }
                    </div>
                </div>
                <div class="po-item-section stage-5 info-stage">
                    <div class="po-item-section-header justify-content-center">
                        <p class="mb-0">Stage 4</p>
                    </div>
                    <div class="po-item-section-body">
                        <div class="po-item-data-header">
                            <span class="po-item-data-header__text col-md-8 mr-5 pl-0">ETA Confirmation</span>
                            @if (roleID == "vendor")
                            {
                                <span class="po-item-data-header__text col-md-3 pl-0 mr-0">Upload Photo</span>
                            }
                            else
                            {
                                <span class="po-item-data-header__text col-md-2 pl-0 mr-10"></span>
                            }
                            <span class="po-item-data-header__text">info</span>
                        </div>
                        @{
                            var rowStage4 = 1;
                        }
                        @foreach (var purchasingDocumentItem in purchasingDocumentItems)
                        {
                            var childPurchasingDocumentItems = pO.PurchasingDocumentItems.Where(x => x.ParentID == purchasingDocumentItem.ID && x.ID != purchasingDocumentItem.ID);
                            var childRowStage4 = 1;

                            var st4ItemId = "st4-item-id";
                            var st4ItemIdInner = "st4-item-id-inner";
                            var st4UpdateEtaDateOnTime = "st4-update-eta-date-on-time";
                            var st4UpdateEtaDateOnTimeConfirm = "st4-update-eta-date-on-time-confirm";
                            var st4UpdateEtaDateDelay = "st4-update-eta-date-delay";
                            var st4UpdateEtaDateDelayConfirm = "st4-update-eta-date-delay-confirm";
                            var st4UploadProgressPhotoes = "st4-upload-progress-photoes";
                            var st4UploadProgressPhotoesConfirm = "st4-upload-progress-photoes-confirm";
                            var st4DelayReason = "st4-delay-reason";
                            var st4UploadingForm = "st4-uploading-form";
                            var st4UploadedForm = "st4-uploaded-form";

                            var disabledInputUpdateEtaDateOnTime = "disabled";
                            var disabledInputUpdateEtaDateOnTimeConfirm = "disabled";
                            var disabledInputUpdateEtaDateDelay = "disabled";
                            var disabledInputUpdateEtaDateDelayConfirm = "disabled";
                            var disabledInputUploadProgressPhotoes = "disabled";
                            var disabledInputUploadProgressPhotoesConfirm = "disabled";
                            var disabledDelayReason = "disabled";

                            var selectedInputUpdateEtaDateOnTime = "";
                            var selectedInputUpdateEtaDateDelay = "";
                            var hiddenUploadingForm = "";

                            var valueInputUpdateEtaDateOnTime = "";
                            var valueInputUpdateEtaDateDelay = "";
                            var valueDelayReason = 0;

                            if (purchasingDocumentItem.HasETAHistory)
                            {
                                valueInputUpdateEtaDateOnTime = purchasingDocumentItem.FirstETAHistory.ETADateView;
                            }

                            if (purchasingDocumentItem.LastETAHistory.DelayReasonID != null)
                            {
                                valueDelayReason = purchasingDocumentItem.LastETAHistory.DelayReasonID.GetValueOrDefault();
                            }

                            if (purchasingDocumentItem.ActiveStage == "4")
                            {
                                if (roleID == "vendor")
                                {
                                    if (purchasingDocumentItem.ETAHistories.Count < 2)
                                    {
                                        disabledInputUpdateEtaDateOnTime = "disabled";
                                        disabledInputUpdateEtaDateOnTimeConfirm = "";
                                        disabledInputUpdateEtaDateDelay = "";
                                        disabledInputUpdateEtaDateDelayConfirm = "";
                                        disabledDelayReason = "";

                                        valueInputUpdateEtaDateOnTime = purchasingDocumentItem.FirstETAHistory.ETADateView;

                                        if (purchasingDocumentItem.ProgressPhotoes.Count < 1)
                                        {
                                            disabledInputUploadProgressPhotoes = "";
                                            disabledInputUploadProgressPhotoesConfirm = "";
                                        }
                                        else
                                        {
                                            disabledInputUploadProgressPhotoes = "disabled";
                                            disabledInputUploadProgressPhotoesConfirm = "disabled";
                                        }
                                    }
                                    else
                                    {
                                        disabledInputUpdateEtaDateOnTime = "disabled";
                                        disabledInputUpdateEtaDateOnTimeConfirm = "disabled";
                                        disabledInputUpdateEtaDateDelay = "disabled";
                                        disabledInputUpdateEtaDateDelayConfirm = "disabled";

                                        if (purchasingDocumentItem.IsDelayed)
                                        {
                                            valueInputUpdateEtaDateOnTime = "";
                                            valueInputUpdateEtaDateDelay = purchasingDocumentItem.LastETAHistory.ETADateView;

                                            selectedInputUpdateEtaDateDelay = "selected-negative";
                                        }
                                        else
                                        {
                                            valueInputUpdateEtaDateOnTime = purchasingDocumentItem.LastETAHistory.ETADateView;
                                            valueInputUpdateEtaDateDelay = "";

                                            selectedInputUpdateEtaDateOnTime = "selected";
                                        }

                                        if (purchasingDocumentItem.ProgressPhotoes.Count < 1)
                                        {
                                            disabledInputUploadProgressPhotoes = "";
                                            disabledInputUploadProgressPhotoesConfirm = "";
                                        }
                                        else
                                        {
                                            disabledInputUploadProgressPhotoes = "disabled";
                                            disabledInputUploadProgressPhotoesConfirm = "disabled";
                                        }
                                    }
                                }
                                else
                                {
                                    hiddenUploadingForm = "hidden";

                                    disabledInputUpdateEtaDateOnTime = "disabled";
                                    disabledInputUpdateEtaDateOnTimeConfirm = "disabled";
                                    disabledInputUpdateEtaDateDelay = "disabled";
                                    disabledInputUpdateEtaDateDelayConfirm = "disabled";
                                    disabledInputUploadProgressPhotoes = "disabled";
                                    disabledInputUploadProgressPhotoesConfirm = "disabled";

                                    if (purchasingDocumentItem.ETAHistories.Count > 1)
                                    {
                                        if (purchasingDocumentItem.IsDelayed)
                                        {
                                            valueInputUpdateEtaDateOnTime = "";
                                            valueInputUpdateEtaDateDelay = purchasingDocumentItem.LastETAHistory.ETADateView;

                                            selectedInputUpdateEtaDateDelay = "selected-negative";
                                        }
                                        else
                                        {
                                            valueInputUpdateEtaDateOnTime = purchasingDocumentItem.LastETAHistory.ETADateView;
                                            valueInputUpdateEtaDateDelay = "";

                                            selectedInputUpdateEtaDateOnTime = "selected";
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (purchasingDocumentItem.ETAHistories.Count < 2)
                                {
                                    disabledInputUpdateEtaDateOnTime = "disabled";
                                    disabledInputUpdateEtaDateOnTimeConfirm = "disabled";
                                    disabledInputUpdateEtaDateDelay = "disabled";
                                    disabledInputUpdateEtaDateDelayConfirm = "disabled";
                                    disabledInputUploadProgressPhotoes = "disabled";
                                    disabledInputUploadProgressPhotoesConfirm = "disabled";

                                    valueInputUpdateEtaDateOnTime = purchasingDocumentItem.FirstETAHistory.ETADateView;

                                    if (roleID == "procurement")
                                    {
                                        disabledInputUploadProgressPhotoes = "disabled";
                                        disabledInputUploadProgressPhotoesConfirm = "disabled";
                                        hiddenUploadingForm = "hidden";
                                    }
                                }
                                else
                                {
                                    disabledInputUpdateEtaDateOnTime = "disabled";
                                    disabledInputUpdateEtaDateOnTimeConfirm = "disabled";
                                    disabledInputUpdateEtaDateDelay = "disabled";
                                    disabledInputUpdateEtaDateDelayConfirm = "disabled";
                                    disabledInputUploadProgressPhotoes = "disabled";
                                    disabledInputUploadProgressPhotoesConfirm = "disabled";

                                    if (roleID == "vendor")
                                    {
                                        if (purchasingDocumentItem.ProgressPhotoes.Count < 1)
                                        {
                                            disabledInputUploadProgressPhotoes = "";
                                            disabledInputUploadProgressPhotoesConfirm = "";
                                        }
                                        else
                                        {
                                            disabledInputUploadProgressPhotoes = "disabled";
                                            disabledInputUploadProgressPhotoesConfirm = "disabled";
                                        }
                                    }
                                    else
                                    {
                                        disabledInputUploadProgressPhotoes = "disabled";
                                        disabledInputUploadProgressPhotoesConfirm = "disabled";
                                        hiddenUploadingForm = "hidden";
                                    }

                                    if (purchasingDocumentItem.IsDelayed)
                                    {
                                        valueInputUpdateEtaDateOnTime = "";
                                        valueInputUpdateEtaDateDelay = purchasingDocumentItem.LastETAHistory.ETADateView;

                                        selectedInputUpdateEtaDateDelay = "selected-negative";
                                    }
                                    else
                                    {
                                        valueInputUpdateEtaDateOnTime = purchasingDocumentItem.LastETAHistory.ETADateView;
                                        valueInputUpdateEtaDateDelay = "";

                                        selectedInputUpdateEtaDateOnTime = "selected";
                                    }
                                }
                            }

                            <div class="po-item-data-content row-@rowStage4">
                                <div class="po-item-data-content__outer">
                                    <div class="po-item-data-header__column">
                                        <div class="form-inline">
                                            <input type="hidden" class="@st4ItemId" value="@purchasingDocumentItem.ID" />
                                            <div class="form-group mr-2">
                                                <input type="text" class="form-control form-date with-icon @st4UpdateEtaDateOnTime" value="@valueInputUpdateEtaDateOnTime" required="" autofocus="" pattern="^([0-2][0-9]|(3)[0-1])(\/)(((0)[0-9])|((1)[0-2]))(\/)\d{4}$" maxlength="10" mindate="@purchasingDocumentItem.FirstETAHistory.ETADateView" placeholder="dd/mm/yyyy" autocomplete="off" @disabledInputUpdateEtaDateOnTime>
                                                <i class="far fa-calendar-alt form-type-icon"></i>
                                            </div>
                                            <button class="btn btn-positive mr-3 @st4UpdateEtaDateOnTimeConfirm @selectedInputUpdateEtaDateOnTime" @disabledInputUpdateEtaDateOnTimeConfirm>On Time</button>
                                            <div class="form-group mr-2">
                                                <input type="text" class="form-control form-date with-icon @st4UpdateEtaDateDelay" value="@valueInputUpdateEtaDateDelay" required="" autofocus="" pattern="^([0-2][0-9]|(3)[0-1])(\/)(((0)[0-9])|((1)[0-2]))(\/)\d{4}$" maxlength="10" mindate="@purchasingDocumentItem.FirstETAHistory.ETADateView" placeholder="dd/mm/yyyy" autocomplete="off" @disabledInputUpdateEtaDateDelay>
                                                <i class="far fa-calendar-alt form-type-icon"></i>
                                            </div>
                                            <div class="form-group mr-2">
                                                <select id="delayReason" name="delayReason" class="form-control @st4DelayReason" value="@valueDelayReason" @disabledDelayReason>
                                                    <option value="0">select reason</option>
                                                    @foreach (var delayReason in ViewBag.DelayReasons)
                                                    {
                                                        <option value="@delayReason.ID">@delayReason.Name</option>
                                                    }
                                                </select>
                                            </div>
                                            <button class="btn btn-negative mr-3 @st4UpdateEtaDateDelayConfirm @selectedInputUpdateEtaDateDelay" @disabledInputUpdateEtaDateDelayConfirm>Delay</button>
                                        </div>
                                    </div>
                                    <div class="po-item-data-header__column">
                                        <div class="form-inline @st4UploadingForm" @hiddenUploadingForm>
                                            <div class="form-group mr-2">
                                                <input type="hidden" class="@st4ItemIdInner" value="@purchasingDocumentItem.ID" />
                                                <input type="file" class="form-control with-icon @st4UploadProgressPhotoes" @disabledInputUploadProgressPhotoes multiple>
                                                <i class="fas fa-paperclip form-type-icon"></i>
                                            </div>
                                            <button class="btn btn-positive @st4UploadProgressPhotoesConfirm" @disabledInputUploadProgressPhotoesConfirm>Save</button>
                                        </div>
                                    </div>
                                    <div class="po-item-data-header__column info">
                                        <div class="form-inline @st4UploadedForm">
                                            <i class="fas fa-info-circle po-item-section-header__icon info mt-2"></i>
                                            <div class="pop-up-notification">
                                                @if (purchasingDocumentItem.ProgressPhotoes.Count > 0)
                                                {
                                                    foreach (var progressPhoto in purchasingDocumentItem.ProgressPhotoes)
                                                    {
                                                        <span class="mr-2">
                                                            <img src="@Path.Combine("Files\\Import\\ProgressPhotos", progressPhoto.FileName)" width="125px" height="125px" data-id="@progressPhoto.ID">
                                                        </span>
                                                    }
                                                }
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="po-item-data-content__child">
                                    @if (childPurchasingDocumentItems.Count() > 0)
                                    {
                                        foreach (var childPurchasingDocumentItem in childPurchasingDocumentItems)
                                        {
                                            disabledInputUpdateEtaDateOnTime = "disabled";
                                            disabledInputUpdateEtaDateOnTimeConfirm = "disabled";
                                            disabledInputUpdateEtaDateDelay = "disabled";
                                            disabledInputUpdateEtaDateDelayConfirm = "disabled";
                                            disabledInputUploadProgressPhotoes = "disabled";
                                            disabledInputUploadProgressPhotoesConfirm = "disabled";
                                            disabledDelayReason = "disabled";

                                            selectedInputUpdateEtaDateOnTime = "";
                                            selectedInputUpdateEtaDateDelay = "";
                                            hiddenUploadingForm = "";

                                            valueInputUpdateEtaDateOnTime = "";
                                            valueInputUpdateEtaDateDelay = "";
                                            valueDelayReason = 0;

                                            if (childPurchasingDocumentItem.HasETAHistory)
                                            {
                                                valueInputUpdateEtaDateOnTime = childPurchasingDocumentItem.FirstETAHistory.ETADateView;
                                            }

                                            if (childPurchasingDocumentItem.LastETAHistory.DelayReasonID != null)
                                            {
                                                valueDelayReason = childPurchasingDocumentItem.LastETAHistory.DelayReasonID.GetValueOrDefault();
                                            }

                                            if (childPurchasingDocumentItem.ActiveStage == "4")
                                            {
                                                if (roleID == "vendor")
                                                {
                                                    if (childPurchasingDocumentItem.ETAHistories.Count < 2)
                                                    {
                                                        disabledInputUpdateEtaDateOnTime = "disabled";
                                                        disabledInputUpdateEtaDateOnTimeConfirm = "";
                                                        disabledInputUpdateEtaDateDelay = "";
                                                        disabledInputUpdateEtaDateDelayConfirm = "";
                                                        disabledDelayReason = "";

                                                        valueInputUpdateEtaDateOnTime = childPurchasingDocumentItem.FirstETAHistory.ETADateView;

                                                        if (childPurchasingDocumentItem.ProgressPhotoes.Count < 1)
                                                        {
                                                            disabledInputUploadProgressPhotoes = "";
                                                            disabledInputUploadProgressPhotoesConfirm = "";
                                                        }
                                                        else
                                                        {
                                                            disabledInputUploadProgressPhotoes = "disabled";
                                                            disabledInputUploadProgressPhotoesConfirm = "disabled";
                                                        }
                                                    }
                                                    else
                                                    {
                                                        disabledInputUpdateEtaDateOnTime = "disabled";
                                                        disabledInputUpdateEtaDateOnTimeConfirm = "disabled";
                                                        disabledInputUpdateEtaDateDelay = "disabled";
                                                        disabledInputUpdateEtaDateDelayConfirm = "disabled";

                                                        if (childPurchasingDocumentItem.IsDelayed)
                                                        {
                                                            valueInputUpdateEtaDateOnTime = "";
                                                            valueInputUpdateEtaDateDelay = childPurchasingDocumentItem.LastETAHistory.ETADateView;

                                                            selectedInputUpdateEtaDateDelay = "selected-negative";
                                                        }
                                                        else
                                                        {
                                                            valueInputUpdateEtaDateOnTime = childPurchasingDocumentItem.LastETAHistory.ETADateView;
                                                            valueInputUpdateEtaDateDelay = "";

                                                            selectedInputUpdateEtaDateOnTime = "selected";
                                                        }

                                                        if (childPurchasingDocumentItem.ProgressPhotoes.Count < 1)
                                                        {
                                                            disabledInputUploadProgressPhotoes = "";
                                                            disabledInputUploadProgressPhotoesConfirm = "";
                                                        }
                                                        else
                                                        {
                                                            disabledInputUploadProgressPhotoes = "disabled";
                                                            disabledInputUploadProgressPhotoesConfirm = "disabled";
                                                        }
                                                    }
                                                }
                                                else
                                                {
                                                    hiddenUploadingForm = "hidden";

                                                    disabledInputUpdateEtaDateOnTime = "disabled";
                                                    disabledInputUpdateEtaDateOnTimeConfirm = "disabled";
                                                    disabledInputUpdateEtaDateDelay = "disabled";
                                                    disabledInputUpdateEtaDateDelayConfirm = "disabled";
                                                    disabledInputUploadProgressPhotoes = "disabled";
                                                    disabledInputUploadProgressPhotoesConfirm = "disabled";

                                                    if (purchasingDocumentItem.ETAHistories.Count > 1)
                                                    {
                                                        if (childPurchasingDocumentItem.IsDelayed)
                                                        {
                                                            valueInputUpdateEtaDateOnTime = "";
                                                            valueInputUpdateEtaDateDelay = childPurchasingDocumentItem.LastETAHistory.ETADateView;

                                                            selectedInputUpdateEtaDateDelay = "selected-negative";
                                                        }
                                                        else
                                                        {
                                                            valueInputUpdateEtaDateOnTime = childPurchasingDocumentItem.LastETAHistory.ETADateView;
                                                            valueInputUpdateEtaDateDelay = "";

                                                            selectedInputUpdateEtaDateOnTime = "selected";
                                                        }
                                                    }
                                                }
                                            }
                                            else
                                            {
                                                if (childPurchasingDocumentItem.ETAHistories.Count < 2)
                                                {
                                                    disabledInputUpdateEtaDateOnTime = "disabled";
                                                    disabledInputUpdateEtaDateOnTimeConfirm = "disabled";
                                                    disabledInputUpdateEtaDateDelay = "disabled";
                                                    disabledInputUpdateEtaDateDelayConfirm = "disabled";
                                                    disabledInputUploadProgressPhotoes = "disabled";
                                                    disabledInputUploadProgressPhotoesConfirm = "disabled";

                                                    valueInputUpdateEtaDateOnTime = childPurchasingDocumentItem.FirstETAHistory.ETADateView;

                                                    if (roleID == "procurement")
                                                    {
                                                        disabledInputUploadProgressPhotoes = "disabled";
                                                        disabledInputUploadProgressPhotoesConfirm = "disabled";
                                                        hiddenUploadingForm = "hidden";
                                                    }
                                                }
                                                else
                                                {
                                                    disabledInputUpdateEtaDateOnTime = "disabled";
                                                    disabledInputUpdateEtaDateOnTimeConfirm = "disabled";
                                                    disabledInputUpdateEtaDateDelay = "disabled";
                                                    disabledInputUpdateEtaDateDelayConfirm = "disabled";
                                                    disabledInputUploadProgressPhotoes = "disabled";
                                                    disabledInputUploadProgressPhotoesConfirm = "disabled";

                                                    if (roleID == "vendor")
                                                    {
                                                        if (childPurchasingDocumentItem.ProgressPhotoes.Count < 1)
                                                        {
                                                            disabledInputUploadProgressPhotoes = "";
                                                            disabledInputUploadProgressPhotoesConfirm = "";
                                                        }
                                                        else
                                                        {
                                                            disabledInputUploadProgressPhotoes = "disabled";
                                                            disabledInputUploadProgressPhotoesConfirm = "disabled";
                                                        }
                                                    }
                                                    else
                                                    {
                                                        disabledInputUploadProgressPhotoes = "disabled";
                                                        disabledInputUploadProgressPhotoesConfirm = "disabled";
                                                        hiddenUploadingForm = "hidden";
                                                    }

                                                    if (childPurchasingDocumentItem.IsDelayed)
                                                    {
                                                        valueInputUpdateEtaDateOnTime = "";
                                                        valueInputUpdateEtaDateDelay = childPurchasingDocumentItem.LastETAHistory.ETADateView;

                                                        selectedInputUpdateEtaDateDelay = "selected-negative";
                                                    }
                                                    else
                                                    {
                                                        valueInputUpdateEtaDateOnTime = childPurchasingDocumentItem.LastETAHistory.ETADateView;
                                                        valueInputUpdateEtaDateDelay = "";

                                                        selectedInputUpdateEtaDateOnTime = "selected";
                                                    }
                                                }
                                            }

                                            <div class="po-item-data-content row-@rowStage4-@childRowStage4" row="@rowStage4" child="@childRowStage4">
                                                <div class="po-item-data-header__column">
                                                    <div class="form-inline">
                                                        <input type="hidden" class="@st4ItemId" value="@childPurchasingDocumentItem.ID" />
                                                        <div class="form-group mr-2">
                                                            <input type="text" class="form-control form-date with-icon @st4UpdateEtaDateOnTime" value="@valueInputUpdateEtaDateOnTime" required="" autofocus="" pattern="^([0-2][0-9]|(3)[0-1])(\/)(((0)[0-9])|((1)[0-2]))(\/)\d{4}$" maxlength="10" placeholder="dd/mm/yyyy" mindate="@childPurchasingDocumentItem.FirstETAHistory.ETADateView" autocomplete="off" @disabledInputUpdateEtaDateOnTime>
                                                            <i class="far fa-calendar-alt form-type-icon"></i>
                                                        </div>
                                                        <button class="btn btn-positive mr-3 @st4UpdateEtaDateOnTimeConfirm @selectedInputUpdateEtaDateOnTime" @disabledInputUpdateEtaDateOnTimeConfirm>On Time</button>
                                                        <div class="form-group mr-2">
                                                            <input type="text" class="form-control form-date with-icon @st4UpdateEtaDateDelay" value="@valueInputUpdateEtaDateDelay" required="" autofocus="" pattern="^([0-2][0-9]|(3)[0-1])(\/)(((0)[0-9])|((1)[0-2]))(\/)\d{4}$" maxlength="10" placeholder="dd/mm/yyyy" mindate="@childPurchasingDocumentItem.FirstETAHistory.ETADateView" autocomplete="off" @disabledInputUpdateEtaDateDelay>
                                                            <i class="far fa-calendar-alt form-type-icon"></i>
                                                        </div>
                                                        <div class="form-group mr-2">
                                                            <select id="delayReason" name="delayReason" class="form-control @st4DelayReason" value="@valueDelayReason" @disabledDelayReason>
                                                                <option value="0">select reason</option>
                                                                @foreach (var delayReason in ViewBag.DelayReasons)
                                                                {
                                                                    <option value="@delayReason.ID">@delayReason.Name</option>
                                                                }
                                                            </select>
                                                        </div>
                                                        <button class="btn btn-negative mr-3 @st4UpdateEtaDateDelayConfirm @selectedInputUpdateEtaDateDelay" @disabledInputUpdateEtaDateDelayConfirm>Delay</button>
                                                    </div>
                                                </div>
                                                <div class="po-item-data-header__column">
                                                    <div class="form-inline @st4UploadingForm" @hiddenUploadingForm>
                                                        <div class="form-group mr-2">
                                                            <input type="hidden" class="@st4ItemIdInner" value="@childPurchasingDocumentItem.ID" />
                                                            <input type="file" class="form-control with-icon @st4UploadProgressPhotoes" @disabledInputUploadProgressPhotoes multiple>
                                                            <i class="fas fa-paperclip form-type-icon"></i>
                                                        </div>
                                                        <button class="btn btn-positive @st4UploadProgressPhotoesConfirm" @disabledInputUploadProgressPhotoesConfirm>Save</button>
                                                    </div>
                                                </div>
                                                <div class="po-item-data-header__column info">
                                                    <div class="form-inline @st4UploadedForm">
                                                        <i class="fas fa-info-circle po-item-section-header__icon info mt-2"></i>
                                                        <div class="pop-up-notification">
                                                            @if (childPurchasingDocumentItem.ProgressPhotoes.Count > 0)
                                                            {
                                                                foreach (var progressPhoto in childPurchasingDocumentItem.ProgressPhotoes)
                                                                {
                                                                    <span class="mr-2">
                                                                        <img src="@Path.Combine("Files\\Import\\ProgressPhotos", progressPhoto.FileName)" width="50px" height="50px" data-id="@progressPhoto.ID">
                                                                    </span>
                                                                }
                                                            }
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            childRowStage4++;
                                        }
                                    }
                                </div>
                            </div>
                            rowStage4++;
                        }
                    </div>
                </div>
                <div class="po-item-section stage-6">
                    <div class="po-item-section-header stage-checkbox-header">
                        <div>
                            <label class="checkbox-custom__label mr-0">
                                <input class="checkbox-custom st5-checkbox-all" type="checkbox">
                                <span class="checkmark"></span>
                            </label>
                        </div>
                        <div><p class="mb-0">Stage 5</p></div>
                        <div>
                            <input class="btn btn-positive st5-confirm-all" type="submit" value="Save All" />
                        </div>
                    </div>
                    <div class="po-item-section-body">
                        <div class="po-item-data-header">
                            <span class="po-item-data-header__text confirm-eta">Ship Booking Date</span>
                            <span class="po-item-data-header__text confirm-eta">ATD</span>
                        </div>
                        @{
                            var rowStage5 = 1;
                        }
                        @foreach (var purchasingDocumentItem in purchasingDocumentItems)
                        {
                            var childPurchasingDocumentItems = pO.PurchasingDocumentItems.Where(x => x.ParentID == purchasingDocumentItem.ID && x.ID != purchasingDocumentItem.ID);
                            var childRowStage5 = 1;

                            var st5ItemId = "st5-item-id";
                            var st5CheckboxItem = "st5-checkbox-item";
                            var st5ShipBookingDate = "st5-ship-booking-date";
                            var st5ShipBookingDateConfirm = "st5-ship-booking-date-confirm";
                            var st5ATD = "st5-ATD";
                            var st5ATDConfirm = "st5-ATD-confirm";
                            var st5IsShipBooked = "st5-is-ship-booked";

                            var selectedShipBookingDateConfirm = "";
                            var selectedATDConfirm = "";

                            var disabledCheckboxItem = "disabled";
                            var disabledInputShipBookingDate = "disabled";
                            var disabledInputATD = "disabled";
                            var disabledShipBookingDateConfirm = "disabled";
                            var disabledATDConfirm = "disabled";

                            var valueInputShipBookingDate = "";
                            var valueInputATD = "";

                            var isShipBooked = "false";
                            var isChecked = "";

                            if (!string.IsNullOrEmpty(purchasingDocumentItem.LastETAHistory.ETADateView))
                            {
                                valueInputShipBookingDate = purchasingDocumentItem.LastETAHistory.ETADateView;
                            }

                            if (!string.IsNullOrEmpty(purchasingDocumentItem.FirstShipment.BookingDateView))
                            {
                                valueInputShipBookingDate = purchasingDocumentItem.FirstShipment.BookingDateView;
                                valueInputATD = purchasingDocumentItem.FirstShipment.BookingDateView;
                                selectedShipBookingDateConfirm = "selected";
                                isShipBooked = "true";
                            }

                            if (!string.IsNullOrEmpty(purchasingDocumentItem.FirstShipment.ATDDateView))
                            {
                                valueInputATD = purchasingDocumentItem.FirstShipment.ATDDateView;
                                selectedATDConfirm = "selected";
                                isChecked = "checked";
                            }

                            if (purchasingDocumentItem.ActiveStage == "5")
                            {
                                if (roleID == "vendor")
                                {
                                    disabledCheckboxItem = "";
                                }
                            }

                            <div class="po-item-data-content row-@rowStage5">
                                <div class="po-item-data-content__outer">
                                    <form class="d-flex po-form-item-st5">
                                        <div class="po-item-data-header__column confirm-eta">
                                            <div class="form-inline">
                                                <input hidden class="@st5ItemId" value="@purchasingDocumentItem.ID" />
                                                <input hidden class="@st5IsShipBooked" value="@isShipBooked" />
                                                <label class="checkbox-custom__label">
                                                    <input class="checkbox-custom @st5CheckboxItem" @isChecked type="checkbox" @disabledCheckboxItem>
                                                    <span class="checkmark"></span>
                                                </label>
                                                <div class="form-group mr-2">
                                                    <input type="text" class="form-control form-date with-icon @st5ShipBookingDate" value="@valueInputShipBookingDate" required="" autofocus="" pattern="^([0-2][0-9]|(3)[0-1])(\/)(((0)[0-9])|((1)[0-2]))(\/)\d{4}$" maxlength="10" placeholder="dd/mm/yyyy" maxdate="@purchasingDocumentItem.LastETAHistory.ETADateView" autocomplete="off" @disabledInputShipBookingDate>
                                                    <i class="far fa-calendar-alt form-type-icon"></i>
                                                </div>
                                                <button type="submit" class="btn btn-positive @st5ShipBookingDateConfirm @selectedShipBookingDateConfirm" @disabledShipBookingDateConfirm>Save</button>
                                            </div>
                                        </div>
                                        <div class="po-item-data-header__column confirm-eta">
                                            <div class="form-inline">
                                                <div class="form-group mr-2">
                                                    <input type="text" class="form-control form-date with-icon @st5ATD" value="@valueInputATD" required="" autofocus="" pattern="^([0-2][0-9]|(3)[0-1])(\/)(((0)[0-9])|((1)[0-2]))(\/)\d{4}$" maxlength="10" placeholder="dd/mm/yyyy" autocomplete="off" @disabledInputATD>
                                                    <i class="far fa-calendar-alt form-type-icon"></i>
                                                </div>
                                                <button type="submit" class="btn btn-positive @st5ATDConfirm @selectedATDConfirm" @disabledATDConfirm>Save</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="po-item-data-content__child">
                                    @if (childPurchasingDocumentItems.Count() > 0)
                                    {
                                        foreach (var childPurchasingDocumentItem in childPurchasingDocumentItems)
                                        {
                                            selectedShipBookingDateConfirm = "";
                                            selectedATDConfirm = "";

                                            disabledCheckboxItem = "disabled";
                                            disabledInputShipBookingDate = "disabled";
                                            disabledInputATD = "disabled";
                                            disabledShipBookingDateConfirm = "disabled";
                                            disabledATDConfirm = "disabled";

                                            valueInputShipBookingDate = "";
                                            valueInputATD = "";

                                            isShipBooked = "false";
                                            isChecked = "";

                                            if (!string.IsNullOrEmpty(childPurchasingDocumentItem.LastETAHistory.ETADateView))
                                            {
                                                valueInputShipBookingDate = childPurchasingDocumentItem.LastETAHistory.ETADateView;
                                            }

                                            if (!string.IsNullOrEmpty(childPurchasingDocumentItem.FirstShipment.BookingDateView))
                                            {
                                                valueInputShipBookingDate = childPurchasingDocumentItem.FirstShipment.BookingDateView;
                                                valueInputATD = childPurchasingDocumentItem.FirstShipment.BookingDateView;
                                                selectedShipBookingDateConfirm = "selected";
                                                isShipBooked = "true";
                                            }

                                            if (!string.IsNullOrEmpty(childPurchasingDocumentItem.FirstShipment.ATDDateView))
                                            {
                                                valueInputATD = childPurchasingDocumentItem.FirstShipment.ATDDateView;
                                                selectedATDConfirm = "selected";
                                                isChecked = "checked";
                                            }

                                            if (childPurchasingDocumentItem.ActiveStage == "5")
                                            {
                                                if (roleID == "vendor")
                                                {
                                                    disabledCheckboxItem = "";
                                                }
                                            }

                                            <div class="po-item-data-content row-@rowStage5-@childRowStage5" row="@rowStage5" child="@childRowStage5">
                                                <form class="d-flex po-form-item-st5">
                                                    <div class="po-item-data-header__column confirm-eta">
                                                        <div class="form-inline">
                                                            <input hidden class="@st5ItemId" value="@childPurchasingDocumentItem.ID" />
                                                            <input hidden class="@st5IsShipBooked" value="@isShipBooked" />
                                                            <label class="checkbox-custom__label">
                                                                <input class="checkbox-custom @st5CheckboxItem" @isChecked type="checkbox" @disabledCheckboxItem>
                                                                <span class="checkmark"></span>
                                                            </label>
                                                            <div class="form-group mr-2">
                                                                <input type="text" class="form-control form-date with-icon @st5ShipBookingDate" value="@valueInputShipBookingDate" required="" autofocus="" pattern="^([0-2][0-9]|(3)[0-1])(\/)(((0)[0-9])|((1)[0-2]))(\/)\d{4}$" maxlength="10" placeholder="dd/mm/yyyy" maxdate="@childPurchasingDocumentItem.LastETAHistory.ETADateView" autocomplete="off" @disabledInputShipBookingDate>
                                                                <i class="far fa-calendar-alt form-type-icon"></i>
                                                            </div>
                                                            <button type="submit" class="btn btn-positive @st5ShipBookingDateConfirm @selectedShipBookingDateConfirm" @disabledShipBookingDateConfirm>Save</button>
                                                        </div>
                                                    </div>
                                                    <div class="po-item-data-header__column confirm-eta">
                                                        <div class="form-inline">
                                                            <div class="form-group mr-2">
                                                                <input type="text" class="form-control form-date with-icon @st5ATD" value="@valueInputATD" required="" autofocus="" pattern="^([0-2][0-9]|(3)[0-1])(\/)(((0)[0-9])|((1)[0-2]))(\/)\d{4}$" maxlength="10" placeholder="dd/mm/yyyy" autocomplete="off" @disabledInputATD>
                                                                <i class="far fa-calendar-alt form-type-icon"></i>
                                                            </div>
                                                            <button type="submit" class="btn btn-positive @st5ATDConfirm @selectedATDConfirm" @disabledATDConfirm>Save</button>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                            childRowStage5++;
                                        }
                                    }
                                </div>
                            </div>

                            rowStage5++;
                        }
                    </div>
                </div>
                <div class="po-item-section stage-7">
                    <div class="po-item-section-header justify-content-center">
                        <p class="mb-0">Stage 6</p>
                    </div>
                    <div class="po-item-section-body">
                        <div class="po-item-data-header">
                            <span class="po-item-data-header__text">Preparing Document Shipment</span>
                        </div>
                        @{
                            var rowStage6 = 1;
                        }
                        @foreach (var purchasingDocumentItem in purchasingDocumentItems)
                        {
                            var childPurchasingDocumentItems = pO.PurchasingDocumentItems.Where(x => x.ParentID == purchasingDocumentItem.ID && x.ID != purchasingDocumentItem.ID);
                            var childRowStage6 = 1;

                            var st6FillInTheForm = "st6-fill-in-the-form";

                            var disabledFillInTheForm = "disabled";
                            var selectedFillInTheForm = "";
                            var textFillInTheForm = "Fill in The Form";

                            if (purchasingDocumentItem.ActiveStage == "6")
                            {
                                if (roleID == "vendor")
                                {
                                    disabledFillInTheForm = "";
                                }
                            }
                            else if (purchasingDocumentItem.ActiveStage != "2a")
                            {
                                if (purchasingDocumentItem.ActiveStageToNumber > 6)
                                {
                                    disabledFillInTheForm = "";
                                    selectedFillInTheForm = "selected";
                                    textFillInTheForm = "See the Form";
                                }
                            }

                            <div class="po-item-data-content row-@rowStage6">
                                <div class="po-item-data-content__outer">
                                    <div class="po-item-data-header__column">
                                        <button class="btn btn-positive @st6FillInTheForm @selectedFillInTheForm" data-toggle="modal" data-target="#fillForm" data-id="@purchasingDocumentItem.ID" @disabledFillInTheForm>@textFillInTheForm</button>
                                    </div>
                                </div>
                                <div class="po-item-data-content__child">
                                    @if (childPurchasingDocumentItems.Count() > 0)
                                    {
                                        foreach (var childPurchasingDocumentItem in childPurchasingDocumentItems)
                                        {
                                            disabledFillInTheForm = "disabled";
                                            selectedFillInTheForm = "";
                                            textFillInTheForm = "Fill in The Form";

                                            if (childPurchasingDocumentItem.ActiveStage == "6")
                                            {
                                                if (roleID == "vendor")
                                                {
                                                    disabledFillInTheForm = "";
                                                }
                                            }
                                            else if (childPurchasingDocumentItem.ActiveStage != "2a")
                                            {
                                                if (childPurchasingDocumentItem.ActiveStageToNumber > 6)
                                                {
                                                    disabledFillInTheForm = "";
                                                    selectedFillInTheForm = "selected";
                                                    textFillInTheForm = "See the Form";
                                                }
                                            }

                                            <div class="po-item-data-content row-@rowStage6-@childRowStage6" row="@rowStage6" child="@childRowStage6">
                                                <div class="po-item-data-header__column">
                                                    <button class="btn btn-positive @st6FillInTheForm @selectedFillInTheForm" data-toggle="modal" data-target="#fillForm" data-id="@childPurchasingDocumentItem.ID" @disabledFillInTheForm>@textFillInTheForm</button>
                                                </div>
                                            </div>
                                            childRowStage6++;
                                        }
                                    }
                                </div>
                            </div>
                            rowStage6++;
                        }
                    </div>
                </div>
                <div class="po-item-section stage-8">
                    @if (roleID == "procurement")
                    {
                        <div class="po-item-section-header stage-checkbox-header">
                            <div>
                                <label class="checkbox-custom__label mr-0">
                                    <input class="checkbox-custom st7-checkbox-all" type="checkbox">
                                    <span class="checkmark"></span>
                                </label>
                            </div>
                            <div><p class="mb-0">Stage 7</p></div>
                            <div>
                                <input class="btn btn-positive st7-confirm-all-on-airport" type="submit" value="Save All" />
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="po-item-section-header justify-content-center">
                            <div><p class="mb-0">Stage 7</p></div>
                        </div>
                    }
                    <div class="po-item-section-body">
                        <div class="po-item-data-header">
                            <span class="po-item-data-header__text confirm-eta">Target ETA on Airport/Seaport</span>
                            <span class="po-item-data-header__text confirm-eta">Target ATA on Airport/Seaport</span>
                        </div>
                        @{
                            var rowStage7 = 1;
                        }
                        @foreach (var purchasingDocumentItem in purchasingDocumentItems)
                        {
                            var childPurchasingDocumentItems = pO.PurchasingDocumentItems.Where(x => x.ParentID == purchasingDocumentItem.ID && x.ID != purchasingDocumentItem.ID);
                            var childRowStage7 = 1;

                            var st7CheckBoxItem = "st7-checkbox-item";
                            var st7TargetETAOnAirport = "st7-target-eta-on-airport";
                            var st7TargetATAOnAirport = "st7-target-ata-on-airport";
                            var st7OnAirportConfirm = "st7-on-airport-confirm";
                            var st7ItemID = "st7-item-id";

                            var disabledCheckboxItem = "disabled";
                            var disabledTargetETAOnAirport = "disabled";
                            var disabledTargetATAOnAirport = "disabled";
                            var disabledOnAirportConfirm = "disabled";
                            var selectedOnAirportConfirm = "";
                            var hiddenCheckboxItem = "";
                            var isChecked = "";

                            var valueTargetETAOnAirport = "";
                            var valueTargetATAOnAirport = "";

                            if (purchasingDocumentItem.HasETAHistory)
                            {
                                if (purchasingDocumentItem.LastETAHistory.ETADateView != "")
                                {
                                    valueTargetETAOnAirport = purchasingDocumentItem.LastETAHistory.ETADateView;
                                }
                            }

                            if (roleID == "vendor")
                            {
                                hiddenCheckboxItem = "hidden";
                            }

                            if (purchasingDocumentItem.ActiveStageView == "7")
                            {
                                if (roleID == "procurement")
                                {
                                    disabledCheckboxItem = "";
                                }
                            }
                            else if (purchasingDocumentItem.ActiveStageView != "2a")
                            {
                                if (Convert.ToInt32(purchasingDocumentItem.ActiveStageView) > 7)
                                {
                                    if (purchasingDocumentItem.FirstShipment.ATADateView != "")
                                    {
                                        isChecked = "checked";
                                        valueTargetATAOnAirport = purchasingDocumentItem.FirstShipment.ATADateView;
                                    }
                                }
                            }

                            <div class="po-item-data-content row-@rowStage7">
                                <div class="po-item-data-content__outer">
                                    <form class="d-flex po-form-item-st7">
                                        <div class="po-item-data-header__column confirm-eta">
                                            <div class="form-inline">
                                                <input hidden class="@st7ItemID" value="@purchasingDocumentItem.ID" />
                                                <label class="checkbox-custom__label" @hiddenCheckboxItem>
                                                    <input class="checkbox-custom @st7CheckBoxItem" @disabledCheckboxItem type="checkbox" @isChecked>
                                                    <span class="checkmark"></span>
                                                </label>
                                                <div class="form-group mr-2">
                                                    <input type="text" class="form-control form-date with-icon confirm-payment-date @st7TargetETAOnAirport" required="" autofocus="" pattern="^([0-2][0-9]|(3)[0-1])(\/)(((0)[0-9])|((1)[0-2]))(\/)\d{4}$" maxlength="10" value="@valueTargetETAOnAirport" @disabledTargetETAOnAirport placeholder="dd/mm/yyyy" autocomplete="off">
                                                    <i class="far fa-calendar-alt form-type-icon"></i>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="po-item-data-header__column confirm-eta">
                                            <div class="form-inline">
                                                <div class="form-group mr-2">
                                                    <input type="text" class="form-control form-date with-icon confirm-payment-date @st7TargetATAOnAirport" required="" autofocus="" pattern="^([0-2][0-9]|(3)[0-1])(\/)(((0)[0-9])|((1)[0-2]))(\/)\d{4}$" maxlength="10" value="@valueTargetATAOnAirport" @disabledTargetATAOnAirport placeholder="dd/mm/yyyy" autocomplete="off">
                                                    <i class="far fa-calendar-alt form-type-icon"></i>
                                                </div>
                                                <button type="submit" class="btn btn-positive @st7OnAirportConfirm @selectedOnAirportConfirm" @disabledOnAirportConfirm>save</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="po-item-data-content__child">
                                    @if (childPurchasingDocumentItems.Count() > 0)
                                    {
                                        foreach (var childPurchasingDocumentItem in childPurchasingDocumentItems)
                                        {

                                            disabledCheckboxItem = "disabled";
                                            disabledTargetETAOnAirport = "disabled";
                                            disabledTargetATAOnAirport = "disabled";
                                            disabledOnAirportConfirm = "disabled";
                                            selectedOnAirportConfirm = "";
                                            hiddenCheckboxItem = "";
                                            isChecked = "";

                                            valueTargetETAOnAirport = "";
                                            valueTargetATAOnAirport = "";

                                            if (childPurchasingDocumentItem.HasETAHistory)
                                            {
                                                if (childPurchasingDocumentItem.LastETAHistory.ETADateView != "")
                                                {
                                                    valueTargetETAOnAirport = childPurchasingDocumentItem.LastETAHistory.ETADateView;
                                                }
                                            }

                                            if (roleID == "vendor")
                                            {
                                                hiddenCheckboxItem = "hidden";
                                            }

                                            if (childPurchasingDocumentItem.ActiveStageView == "7")
                                            {
                                                if (roleID == "procurement")
                                                {
                                                    disabledCheckboxItem = "";
                                                }
                                            }
                                            else if (childPurchasingDocumentItem.ActiveStageView != "2a")
                                            {
                                                if (childPurchasingDocumentItem.ActiveStageToNumber > 7)
                                                {
                                                    if (childPurchasingDocumentItem.FirstShipment.ATADateView != "")
                                                    {
                                                        isChecked = "checked";
                                                        valueTargetATAOnAirport = childPurchasingDocumentItem.FirstShipment.ATADateView;
                                                    }
                                                }
                                            }

                                            <div class="po-item-data-content row-@rowStage7-@childRowStage7" row="@rowStage7" child="@childRowStage7">
                                                <form class="d-flex po-form-item-st7">
                                                    <div class="po-item-data-header__column confirm-eta">
                                                        <div class="form-inline">
                                                            <input hidden class="@st7ItemID" value="@childPurchasingDocumentItem.ID" />
                                                            <label class="checkbox-custom__label" @hiddenCheckboxItem>
                                                                <input class="checkbox-custom @st7CheckBoxItem" @disabledCheckboxItem type="checkbox" @isChecked>
                                                                <span class="checkmark"></span>
                                                            </label>
                                                            <div class="form-group mr-2">
                                                                <input type="text" class="form-control form-date with-icon confirm-payment-date @st7TargetETAOnAirport" required="" autofocus="" pattern="^([0-2][0-9]|(3)[0-1])(\/)(((0)[0-9])|((1)[0-2]))(\/)\d{4}$" maxlength="10" value="@valueTargetETAOnAirport" @disabledTargetETAOnAirport placeholder="dd/mm/yyyy" autocomplete="off">
                                                                <i class="far fa-calendar-alt form-type-icon"></i>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="po-item-data-header__column confirm-eta">
                                                        <div class="form-inline">
                                                            <div class="form-group mr-2">
                                                                <input type="text" class="form-control form-date with-icon confirm-payment-date @st7TargetATAOnAirport" required="" autofocus="" pattern="^([0-2][0-9]|(3)[0-1])(\/)(((0)[0-9])|((1)[0-2]))(\/)\d{4}$" maxlength="10" value="@valueTargetATAOnAirport" @disabledTargetATAOnAirport placeholder="dd/mm/yyyy" autocomplete="off">
                                                                <i class="far fa-calendar-alt form-type-icon"></i>
                                                            </div>
                                                            <button type="submit" class="btn btn-positive @st7OnAirportConfirm @selectedOnAirportConfirm" @disabledOnAirportConfirm>save</button>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                            childRowStage7++;
                                        }
                                    }
                                </div>
                            </div>

                            rowStage7++;
                        }
                    </div>
                </div>
                @*<div class="po-item-section stage-9">
                        <div class="po-item-section-header justify-content-center">
                            <p class="mb-0">Stage 8</p>
                        </div>
                        <div class="po-item-section-body">
                            <div class="po-item-data-header">
                                <span class="po-item-data-header__text">Inbound Number</span>
                            </div>
                            @{
                                var rowStage8 = 1;
                            }
                            @foreach (var purchasingDocumentItem in purchasingDocumentItems)
                            {
                                var childPurchasingDocumentItems = pO.PurchasingDocumentItems.Where(x => x.ParentID == purchasingDocumentItem.ID && x.ID != purchasingDocumentItem.ID);
                                var childRowStage8 = 1;

                                List<string> shipmentInboundNumbers = purchasingDocumentItem.ShipmentInboundNumbers;
                                var maxCount = 0;

                                if (shipmentInboundNumbers != null)
                                {
                                    maxCount = shipmentInboundNumbers.Count;
                                }

                                var count = 0;

                                <div class="po-item-data-content row-@rowStage8">
                                    <div class="po-item-data-content__outer">
                                        @if (maxCount >= count + 1)
                                        {
                                            <span class="po-item-data-header__column">
                                                @shipmentInboundNumbers[count]
                                            </span>
                                        }
                                        else
                                        {
                                            <span class="po-item-data-header__column">
                                                -
                                            </span>
                                        }
                                    </div>
                                    <div class="po-item-data-content__child">
                                        @if (childPurchasingDocumentItems.Count() > 0)
                                        {
                                            count++;
                                            foreach (var childPurchasingDocumentItem in childPurchasingDocumentItems)
                                            {
                                                <div class="po-item-data-content row-@rowStage8-@childRowStage8 mt-customize" row="@rowStage8" child="@childRowStage8">
                                                    @if (maxCount >= count + 1)
                                                    {
                                                        <span class="po-item-data-header__column">
                                                            @shipmentInboundNumbers[count]
                                                        </span>
                                                    }
                                                    else
                                                    {
                                                        <span class="po-item-data-header__column">
                                                            -
                                                        </span>
                                                    }
                                                </div>
                                                childRowStage8++;
                                                count++;
                                            }
                                        }
                                    </div>
                                </div>
                                rowStage8++;
                            }
                        </div>
                    </div>*@
                <div class="po-item-section stage-9 info-stage">
                    <div class="po-item-section-header justify-content-center">
                        <p class="mb-0">Stage 8</p>
                    </div>
                    <div class="po-item-section-body">
                        <div class="po-item-data-header">
                            <span class="po-item-data-header__text gr-date">GR Date</span>
                            <span class="po-item-data-header__text gr-qty">Qty</span>
                            <span class="po-item-data-header__text gr-complete">GR Completed</span>
                            <span class="po-item-data-header__text">info</span>
                        </div>
                        @{
                            var rowStage9 = 1;
                        }
                        @foreach (var purchasingDocumentItem in purchasingDocumentItems)
                        {
                            var childPurchasingDocumentItems = pO.PurchasingDocumentItems.Where(x => x.ParentID == purchasingDocumentItem.ID && x.ID != purchasingDocumentItem.ID);
                            var childRowStage9 = 1;

                            var grDateNewDateFormat = purchasingDocumentItem.LatestPurchasingDocumentItemHistories.GoodsReceiptDate.HasValue ? purchasingDocumentItem.LatestPurchasingDocumentItemHistories.GoodsReceiptDate.Value.ToString("dd/MM/yyyy") : "";
                            var isComplete = "No";
                            if (purchasingDocumentItem.LatestPurchasingDocumentItemHistories.GoodsReceiptQuantity >= purchasingDocumentItem.ConfirmedQuantity)
                            {
                                isComplete = "Yes";
                            }

                            var goodsReceiptQuantity = purchasingDocumentItem.LatestPurchasingDocumentItemHistories.GoodsReceiptQuantity.ToString();
                            var confirmedQuantity = purchasingDocumentItem.ConfirmedQuantity.ToString();

                            if (purchasingDocumentItem.ActiveStageToNumber < 8)
                            {
                                grDateNewDateFormat = "-";
                                goodsReceiptQuantity = "-";
                                confirmedQuantity = "-";
                                isComplete = "-";
                            }

                            <div class="po-item-data-content row-@rowStage9">
                                <div class="po-item-data-content__outer">
                                    <div class="po-item-data-header__column gr-date">@grDateNewDateFormat</div>
                                    <div class="po-item-data-header__column gr-qty">
                                        <div>@goodsReceiptQuantity<span class="secondary-text">/@confirmedQuantity</span></div>
                                    </div>
                                    <span class="po-item-data-header__column gr-complete">@isComplete</span>
                                    <span class="po-item-data-header__text info">
                                        <i class="fas fa-info-circle po-item-section-header__icon info"></i>
                                        <div class="pop-up-notification">
                                            <table>
                                                <tbody>
                                                    <tr>
                                                        <td>GR / Inspection Date</td>
                                                        <td>&nbsp;</td>
                                                        <td>Qty</td>
                                                    </tr>
                                                    @foreach (var pdih in purchasingDocumentItem.PurchasingDocumentItemHistoriesDetail)
                                                    {
                                                        grDateNewDateFormat = pdih.GoodsReceiptDate.HasValue ? pdih.GoodsReceiptDate.Value.ToString("dd/MM/yyyy") : "";
                                                        var pdihGoodsReceiptQuantity = pdih.GoodsReceiptQuantity.ToString();

                                                        if (purchasingDocumentItem.ActiveStageToNumber < 8)
                                                        {
                                                            pdihGoodsReceiptQuantity = "-";
                                                            grDateNewDateFormat = "-";
                                                        }

                                                        <tr>
                                                            <td class="secondary-text">@grDateNewDateFormat</td>
                                                            <td>&nbsp;</td>
                                                            <td class="secondary-text">@pdihGoodsReceiptQuantity</td>
                                                        </tr>
                                                    }
                                                </tbody>
                                            </table>
                                        </div>
                                    </span>
                                </div>
                                <div class="po-item-data-content__child">
                                    @if (childPurchasingDocumentItems.Count() > 0)
                                    {
                                        foreach (var childPurchasingDocumentItem in childPurchasingDocumentItems)
                                        {
                                            grDateNewDateFormat = childPurchasingDocumentItem.LatestPurchasingDocumentItemHistories.GoodsReceiptDate.HasValue ? childPurchasingDocumentItem.LatestPurchasingDocumentItemHistories.GoodsReceiptDate.Value.ToString("dd/MM/yyyy") : "";
                                            isComplete = "No";
                                            if (childPurchasingDocumentItem.LatestPurchasingDocumentItemHistories.GoodsReceiptQuantity >= childPurchasingDocumentItem.ConfirmedQuantity)
                                            {
                                                isComplete = "Yes";
                                            }

                                            goodsReceiptQuantity = childPurchasingDocumentItem.LatestPurchasingDocumentItemHistories.GoodsReceiptQuantity.ToString();
                                            confirmedQuantity = childPurchasingDocumentItem.ConfirmedQuantity.ToString();

                                            if (childPurchasingDocumentItem.ActiveStageToNumber < 8)
                                            {
                                                grDateNewDateFormat = "-";
                                                goodsReceiptQuantity = "-";
                                                confirmedQuantity = "-";
                                                isComplete = "-";
                                            }

                                            <div class="po-item-data-content row-@rowStage9-@childRowStage9 mt-customize" row="@rowStage9" child="@childRowStage9">
                                                <div class="po-item-data-header__column gr-date">@grDateNewDateFormat</div>
                                                <div class="po-item-data-header__column gr-qty">
                                                    <div>@goodsReceiptQuantity<span class="secondary-text">/@confirmedQuantity</span></div>
                                                </div>
                                                <span class="po-item-data-header__column gr-complete">@isComplete</span>
                                                <span class="po-item-data-header__text info">
                                                    <i class="fas fa-info-circle po-item-section-header__icon info"></i>
                                                    <div class="pop-up-notification">
                                                        <table>
                                                            <tbody>
                                                                <tr>
                                                                    <td>GR / Inspection Date</td>
                                                                    <td>&nbsp;</td>
                                                                    <td>Qty</td>
                                                                </tr>
                                                                @foreach (var pdih in childPurchasingDocumentItem.PurchasingDocumentItemHistoriesDetail)
                                                                {
                                                                    grDateNewDateFormat = pdih.GoodsReceiptDate.HasValue ? pdih.GoodsReceiptDate.Value.ToString("dd/MM/yyyy") : "";
                                                                    var pdihGoodsReceiptQuantity = pdih.GoodsReceiptQuantity.ToString();

                                                                    if (childPurchasingDocumentItem.ActiveStageToNumber < 8)
                                                                    {
                                                                        pdihGoodsReceiptQuantity = "-";
                                                                        grDateNewDateFormat = "-";
                                                                    }

                                                                    <tr>
                                                                        <td class="secondary-text">@grDateNewDateFormat</td>
                                                                        <td>&nbsp;</td>
                                                                        <td class="secondary-text">@pdihGoodsReceiptQuantity</td>
                                                                    </tr>
                                                                }
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </span>
                                            </div>
                                            childRowStage9++;
                                        }
                                    }
                                </div>
                            </div>

                            rowStage9++;
                        }
                    </div>
                </div>
                <div class="po-item-section stage-10">
                    <div class="po-item-section-header justify-content-center">
                        <p class="mb-0">Stage 9</p>
                    </div>
                    <div class="po-item-section-body">
                        <div class="po-item-data-header">
                            <span class="po-item-data-header__text">Upload Invoice</span>
                        </div>
                        @{
                            var rowStage10 = 1;
                        }
                        @foreach (var purchasingDocumentItem in purchasingDocumentItems)
                        {
                            var childPurchasingDocumentItems = pO.PurchasingDocumentItems.Where(x => x.ParentID == purchasingDocumentItem.ID && x.ID != purchasingDocumentItem.ID);
                            var childRowStage10 = 1;

                            var st10ItemID = "st10-item-id";
                            var st10FormUpload = "st10-form-upload";
                            var st10FormUploaded = "st10-form-uploaded";
                            var st10FileInvoice = "st10-file-invoice";
                            var st10FileInvoiceUpload = "st10-file-invoice-upload";
                            var st10FileInvoiceRemove = "st10-file-invoice-remove";
                            var st10FileInvoiceDownload = "st10-file-invoice-download";

                            var disabledFileInvoice = "disabled";
                            var disabledFileInvoiceUpload = "disabled";
                            var hiddenFormUploading = "";
                            var hiddenFormUploaded = "hidden";
                            var invoiceDownloadPath = "";

                            if (purchasingDocumentItem.InvoiceDocument != null)
                            {
                                invoiceDownloadPath = Path.Combine("Files\\Import\\Invoice", purchasingDocumentItem.InvoiceDocument);
                                hiddenFormUploading = "hidden";
                                hiddenFormUploaded = "";
                            }
                            else
                            {
                                if (roleID == "vendor")
                                {
                                    if (purchasingDocumentItem.ActiveStage != "2a")
                                    {
                                        if (purchasingDocumentItem.ActiveStageToNumber > 7)
                                        {
                                            disabledFileInvoice = "";
                                            disabledFileInvoiceUpload = "";
                                        }
                                    }
                                }
                            }

                            <div class="po-item-data-content row-@rowStage10">
                                <div class="po-item-data-content__outer">
                                    <div class="po-item-data-header__column">
                                        <input hidden class="@st10ItemID" value="@purchasingDocumentItem.ID" />
                                        <div class="form-inline @st10FormUpload" @hiddenFormUploading>
                                            <div class="form-group mr-2">
                                                <input type="file" class="form-control with-icon @st10FileInvoice" @disabledFileInvoice>
                                                <i class="fas fa-paperclip form-type-icon"></i>
                                            </div>
                                            <button class="btn btn-positive @st10FileInvoiceUpload" @disabledFileInvoiceUpload>Upload</button>
                                        </div>
                                        <div class="file-uploaded @st10FormUploaded" @hiddenFormUploaded>
                                            <p class="mb-0"> <a class="@st10FileInvoiceDownload" href="@invoiceDownloadPath">Invoice uploaded </a> <i class="fas fa-check-circle success-icon"></i></p>
                                            @if (roleID == "procurement")
                                            {
                                                <a href="#" class="danger-link @st10FileInvoiceRemove">Remove?</a>
                                            }
                                        </div>
                                    </div>
                                </div>
                                <div class="po-item-data-content__child">
                                    @if (childPurchasingDocumentItems.Count() > 0)
                                    {
                                        foreach (var childPurchasingDocumentItem in childPurchasingDocumentItems)
                                        {
                                            disabledFileInvoice = "disabled";
                                            disabledFileInvoiceUpload = "disabled";
                                            hiddenFormUploading = "";
                                            hiddenFormUploaded = "hidden";
                                            invoiceDownloadPath = "";

                                            if (childPurchasingDocumentItem.InvoiceDocument != null)
                                            {
                                                invoiceDownloadPath = Path.Combine("Files\\Import\\Invoice", childPurchasingDocumentItem.InvoiceDocument);
                                                hiddenFormUploading = "hidden";
                                                hiddenFormUploaded = "";
                                            }
                                            else
                                            {
                                                if (roleID == "vendor")
                                                {
                                                    if (childPurchasingDocumentItem.ActiveStage != "2a")
                                                    {
                                                        if (childPurchasingDocumentItem.ActiveStageToNumber > 7)
                                                        {
                                                            disabledFileInvoice = "";
                                                            disabledFileInvoiceUpload = "";
                                                        }
                                                    }
                                                }
                                            }

                                            <div class="po-item-data-content row-@rowStage10-@childRowStage10" row="@rowStage10" child="@childRowStage10">
                                                <div class="po-item-data-header__column">
                                                    <input hidden class="@st10ItemID" value="@childPurchasingDocumentItem.ID" />
                                                    <div class="form-inline @st10FormUpload" @hiddenFormUploading>
                                                        <div class="form-group mr-2">
                                                            <input type="file" class="form-control with-icon @st10FileInvoice" @disabledFileInvoice>
                                                            <i class="fas fa-paperclip form-type-icon"></i>
                                                        </div>
                                                        <button class="btn btn-positive @st10FileInvoiceUpload" @disabledFileInvoiceUpload>Upload</button>
                                                    </div>
                                                    <div class="file-uploaded @st10FormUploaded" @hiddenFormUploaded>
                                                        <p class="mb-0"> <a class="@st10FileInvoiceDownload" href="@invoiceDownloadPath">Invoice uploaded </a> <i class="fas fa-check-circle success-icon"></i></p>
                                                        @if (roleID == "procurement")
                                                        {
                                                            <a href="#" class="danger-link @st10FileInvoiceRemove">Remove?</a>
                                                        }
                                                    </div>
                                                </div>
                                            </div>
                                            childRowStage10++;
                                        }
                                    }
                                </div>
                            </div>
                            rowStage10++;
                        }
                    </div>
                </div>
                @if (roleID == "procurement")
                {
                    <div class="po-item-section stage-11">
                        <div class="po-item-section-header justify-content-center">
                            <p class="mb-0">Stage 10</p>
                        </div>
                        <div class="po-item-section-body">
                            <div class="po-item-data-header">
                                <span class="po-item-data-header__text document_number">Parking Date</span>
                                <span class="po-item-data-header__text delivery">Term Date</span>
                            </div>
                            @{
                                var rowStage11 = 1;
                            }
                            @foreach (var purchasingDocumentItem in purchasingDocumentItems)
                            {
                                var childPurchasingDocumentItems = pO.PurchasingDocumentItems.Where(x => x.ParentID == purchasingDocumentItem.ID && x.ID != purchasingDocumentItem.ID);
                                var childRowStage11 = 1;

                                List<string> parkingDateViews = purchasingDocumentItem.ImportParkingDateViews;
                                var termDateViews = purchasingDocumentItem.TermDateViews;
                                var maxCount = 0;

                                if (parkingDateViews != null)
                                {
                                    maxCount = parkingDateViews.Count;
                                }

                                var count = 0;

                                <div class="po-item-data-content row-@rowStage11">
                                    <div class="po-item-data-content__outer">
                                        @if (maxCount >= count + 1)
                                        {
                                            <span class="po-item-data-header__column document_number">@parkingDateViews[count]</span>
                                            <span class="po-item-data-header__column delivery">@termDateViews[count]</span>
                                        }
                                        else
                                        {
                                            <span class="po-item-data-header__column document_number">-</span>
                                            <span class="po-item-data-header__column delivery">-</span>
                                        }
                                    </div>
                                    <div class="po-item-data-content__child">
                                        @if (childPurchasingDocumentItems.Count() > 0)
                                        {
                                            count++;
                                            foreach (var childPurchasingDocumentItem in childPurchasingDocumentItems)
                                            {
                                                <div class="po-item-data-content row-@rowStage11-@childRowStage11 mt-customize" row="@rowStage11" child="@childRowStage11">
                                                    @if (maxCount >= count + 1)
                                                    {
                                                        <span class="po-item-data-header__column document_number">@parkingDateViews[count]</span>
                                                        <span class="po-item-data-header__column delivery">@termDateViews[count]</span>
                                                    }
                                                    else
                                                    {
                                                        <span class="po-item-data-header__column document_number">-</span>
                                                        <span class="po-item-data-header__column delivery">-</span>
                                                    }
                                                </div>
                                                childRowStage11++;
                                                count++;
                                            }
                                        }
                                    </div>
                                </div>
                                rowStage11++;
                            }
                        </div>
                    </div>
                }
            </div>
        </li>
    </ul>
    poSignRow++;
}

<div class="modal fade st6-modal" id="fillForm" tabindex="-1" role="dialog" aria-labelledby="fillFormModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="fillFormModalLabel">Shipment Documents</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <input type="hidden" class="st6-item-id" id="modalPurchasingDocumentItemId" value="" />
                <div class="form-row">
                    <div class="form-group col-3">
                        <label for="copyBLDate">BL Date</label>
                        <input type="text" class="form-control with-icon st6-copy-bl-date" required="" pattern="^([0-2][0-9]|(3)[0-1])(\/)(((0)[0-9])|((1)[0-2]))(\/)\d{4}$" maxlength="10" placeholder="dd/mm/yyyy" autocomplete="off" id="copyBLDate">
                        <i class="fas fa-calendar-alt form-type-icon"></i>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-4">
                        <label>BL Copy Document</label>
                        <div class="form-group st6-group-copy-bl-document">
                            <input type="file" class="form-control with-icon st6-copy-bl-document">
                            <i class="fas fa-paperclip form-type-icon"></i>
                        </div>
                        <div class="input-group st6-group-copy-bl-document-uploaded" hidden>
                            <a class="st6-copy-bl-document-download" href="">BL Copy </a> uploaded<i class="fas fa-check-circle primary ml-2"></i>
                        </div>
                    </div>
                    <div class="form-group col-md-4">
                        <label>Packing List Document</label>
                        <div class="input-group st6-group-packing-list-document">
                            <input type="file" class="form-control with-icon st6-packing-list-document">
                            <i class="fas fa-paperclip form-type-icon"></i>
                        </div>
                        <div class="input-group st6-group-packing-list-document-uploaded" hidden>
                            <a class="st6-packing-list-document-download" href="">Packing List   </a> uploaded<i class="fas fa-check-circle primary ml-2"></i>
                        </div>
                    </div>
                    <div class="form-group col-md-4">
                        <label>Invoice Document</label>
                        <div class="input-group st6-group-invoice-document">
                            <input type="file" class="form-control with-icon st6-invoice-document">
                            <i class="fas fa-paperclip form-type-icon"></i>
                        </div>
                        <div class="input-group st6-group-invoice-document-uploaded" hidden>
                            <a class="st6-invoice-document-download" href="">Invoice   </a> uploaded<i class="fas fa-check-circle primary ml-2"></i>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-4">
                        <label>AWB</label>
                        <input type="text" class="form-control st6-AWB" required placeholder="Enter AWB">
                    </div>
                    <div class="form-group col-md-4">
                        <label>Courier Name</label>
                        <input type="text" class="form-control with-icon st6-courier-name" placeholder="Enter Courier Name">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-positive st6-fill-the-form w-100">Save</button>
            </div>
        </div>
    </div>
</div>

<input type="text" id="stage1VendorConfirmItem" hidden value="@Url.Action("VendorConfirmItem", "Import")" />
<input type="text" id="stage1VendorEditItem" hidden value="@Url.Action("VendorEditItem", "Import")" />
<input type="text" id="stage1ProcurementConfirmItem" hidden value="@Url.Action("ProcurementConfirmItem", "Import")" />
<input type="text" id="stage1CancelItem" hidden value="@Url.Action("CancelItem", "Import")" />
<input type="text" id="stage2VendorConfirmFirstETA" hidden value="@Url.Action("VendorConfirmFirstETA", "Import")" />
<input type="text" id="stage2ProcurementAcceptFirstEta" hidden value="@Url.Action("ProcurementAcceptFirstEta", "Import")" />
<input type="text" id="stage2ProcurementDeclineFirstEta" hidden value="@Url.Action("ProcurementDeclineFirstEta", "Import")" />
<input type="text" id="stage2aVendorUploadProformaInvoice" hidden value="@Url.Action("VendorUploadProformaInvoice", "Import")" />
<input type="text" id="stage2aVendorSkipProformaInvoice" hidden value="@Url.Action("VendorSkipProformaInvoice", "Import")" />
<input type="text" id="stage3VendorConfirmPaymentReceived" hidden value="@Url.Action("VendorConfirmPaymentReceived", "Import")" />
<input type="text" id="stage3VendorSkipConfirmPayment" hidden value="@Url.Action("VendorSkipConfirmPayment", "Import")" />
<input type="text" id="stage4VendorUpdateETA" hidden value="@Url.Action("VendorUpdateETA", "Import")" />
<input type="text" id="stage4VendorUploadProgressPhotoes" hidden value="@Url.Action("VendorUploadProgressPhotoes", "Import")" />
<input type="text" id="stage5VendorConfirmShipmentBookingDate" hidden value="@Url.Action("VendorConfirmShipmentBookingDate", "Import")" />
<input type="text" id="stage5VendorConfirmATD" hidden value="@Url.Action("VendorConfirmATD", "Import")" />
<input type="text" id="stage6VendorFillInShipmentForm" hidden value="@Url.Action("VendorFillInShipmentForm", "Import")" />
<input type="text" id="stage6GetShippingInformation" hidden value="@Url.Action("GetShippingInformation", "Import")" />
<input type="text" id="stage7ProcurementConfirmOnAirport" hidden value="@Url.Action("ProcurementConfirmOnAirport", "Import")" />
<input type="text" id="stage10VendorUploadInvoice" hidden value="@Url.Action("VendorUploadInvoice", "Import")" />
<input type="text" id="stage10VendorRemoveUploadInvoice" hidden value="@Url.Action("VendorRemoveUploadInvoice", "Import")" />

<br />
    Page @(Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber) of @Model.PageCount
    @Html.PagedListPager(Model, page => Url.Action("Index",
        new { page, searchPONumber = ViewBag.CurrentSearchPONumber,searchVendorName = ViewBag.CurrentSearchVendorName,searchMaterial = ViewBag.CurrentSearchMaterial, filterBy = ViewBag.CurrentSearchFilterBy, searchStartPODate = ViewBag.CurrentStartPODate, searchEndPODate = ViewBag.CurrentEndPODate }))
    @section scripts {
        <script src="~/Scripts/datepicker.min.js"></script>
        <script src="~/Scripts/donutty-jquery.min.js"></script>
        <script src="~/Scripts/Import/stage1-vendor.js"></script>
        <script src="~/Scripts/Import/stage1-procurement.js"></script>
        <script src="~/Scripts/Import/stage2-vendor.js"></script>
        <script src="~/Scripts/Import/stage2-proc.js"></script>
        <script src="~/Scripts/Import/stage2a-vendor.js"></script>
        <script src="~/Scripts/Import/stage2a-proc.js"></script>
        <script src="~/Scripts/Import/stage3-vendor.js"></script>
        <script src="~/Scripts/Import/stage4-vendor.js"></script>
        <script src="~/Scripts/Import/stage5-vendor.js"></script>
        <script src="~/Scripts/Import/stage6-vendor.js"></script>
        <script src="~/Scripts/Import/stage7-procurement.js"></script>
        <script src="~/Scripts/Import/stage10-vendor.js"></script>
        <script type="text/javascript">
            var scrollLength = [];

            $(document).ready(function () {
                    $('#startPODate').datepicker({ autoHide: true, format: 'dd/mm/yyyy' });
                    $('#endPODate').datepicker({ autoHide: true, format: 'dd/mm/yyyy', filter: date => { return (new Date($('#startPODate').val()) >= date) ? false : true; } });
                    $('.form-date').datepicker({ autoHide: true, format: 'dd/mm/yyyy' });

                    $("#searchPONumber").on("keyup focus", function () {
                        $.ajax({
                            type: "GET",
                            url: "@Url.Action("GetDataForSearch", "Import")",
                            data: { 'searchFilterBy': 'poNumber', 'value': $("#searchPONumber").val() },
                            beforeSend: function () {
                                $("#searchPONumber").css("background", "url(" + siteUrl + "/Images/LoaderIcon.gif) no-repeat 165px");
                            },
                            success: function (response) {
                                if (response.responseCode == "200") {
                                    var jsonObjSuggestion = $.parseJSON(response.data);
                                    var element = "";
                                    for (var k in jsonObjSuggestion) {
                                        element += "<option value='" + jsonObjSuggestion[k]['Data']+"'></option>";
                                    }
                                    $("#data-list-ponumber").html(element);
                                    $("#searchPONumber").css("background", "");
                                } else {
                                    console.log(response.responseCode + response.responseText);
                                }
                            },
                            error: function (xhr, status, error) {
                                console.log(xhr.status + " : " + error);
                            }
                        });
                    });

                    $("#searchVendorName").on("keyup focus", function () {
                        $.ajax({
                            type: "GET",
                            url: "@Url.Action("GetDataForSearch", "Import")",
                            data: { 'searchFilterBy': 'vendor', 'value': $("#searchVendorName").val() },
                            beforeSend: function () {
                                $("#searchVendorName").css("background", "url(" + siteUrl + "/Images/LoaderIcon.gif) no-repeat 165px");
                            },
                            success: function (response) {
                                if (response.responseCode == "200") {
                                    var jsonObjSuggestion = $.parseJSON(response.data);
                                    var element = "";
                                    for (var k in jsonObjSuggestion) {
                                        element += "<option value='" + jsonObjSuggestion[k]['Data']+"'></option>";
                                    }
                                    $("#data-list-vendorname").html(element);
                                    $("#searchVendorName").css("background", "");
                                } else {
                                    console.log(response.responseCode + response.responseText);
                                }
                            },
                            error: function (xhr, status, error) {
                                console.log(xhr.status + " : " + error);
                            }
                        });
                    });

                    $("#searchMaterial").on("focus", function () {
                        $.ajax({
                            type: "GET",
                            url: "@Url.Action("GetDataForSearch", "Import")",
                            data: { 'searchFilterBy': 'material', 'value': $("#searchMaterial").val() },
                            beforeSend: function () {
                                $("#searchMaterial").css("background", "url(" + siteUrl + "/Images/LoaderIcon.gif) no-repeat 165px");
                            },
                            success: function (response) {
                                if (response.responseCode == "200") {
                                    var jsonObjSuggestion = $.parseJSON(response.data);
                                    var element = "";
                                    for (var k in jsonObjSuggestion) {
                                        element += "<option value='" + jsonObjSuggestion[k]['Data']+"'></option>";
                                    }
                                    $("#data-list-material").html(element);
                                    $("#searchMaterial").css("background", "");
                                } else {
                                    console.log(response.responseCode + response.responseText);
                                }
                            },
                            error: function (xhr, status, error) {
                                console.log(xhr.status + " : " + error);
                            }
                        });
                    });

                    //stage scrollbar fixed
                    var chooseStagePosition = $('.filter-row').offset();

                    $(".main-container").scroll(function () {
                        if ($(".main-container").scrollTop() > chooseStagePosition.top) {
                            //$('.stage-pagination-container').css('position', 'fixed').css('top', '10px');
                            $('.filter-row').addClass("freeze");
                        } else {
                            //$('.stage-pagination-container').css('position', 'static');
                            $('.filter-row').removeClass("freeze");
                        }
                    });

                    var tempArray = [];
                    var tempMaxHeight = 0;
                    var tempMaxWidth = 0;

                    $(".po-item-container").each(function (index) {
                        var rowExist = 1;

                        while (rowExist > 0) {
                            if ($(this).find(".row-" + rowExist).length > 0) {
                                tempArray = [];
                                tempMaxHeight = 0;
                                $(this).find(".row-" + rowExist).each(function () {
                                    tempArray.push($(this).height());
                                });
                                tempMaxHeight = Math.max(...tempArray);
                                $(this).find(".row-" + rowExist).height(tempMaxHeight);
                                rowExist++;
                            } else {
                                rowExist = -1;
                            }
                        }
                    });

                    tempArray = [];
                    $(".po-item-section.information").each(function () {
                        tempArray.push($(this).outerWidth(true));
                    });
                    tempMaxWidth = Math.max(...tempArray);
                    $(".po-item-section.information").width(tempMaxWidth);
                    scrollLength.push(tempMaxWidth + 1.5);

                    for (var i = 1; i <= 13; i++) {
                        tempArray = [];
                        $(".po-item-section.stage-" + i).each(function () {
                            tempArray.push($(this).outerWidth(true));
                        });
                        tempMaxWidth = Math.max(...tempArray);
                        $(".po-item-section.stage-" + i).width(tempMaxWidth);
                        scrollLength.push(tempMaxWidth + 1.5);
                    }

                    var totalDistance = 0;
                    for (var i = 0; i < scrollLength.length; i++) {
                        scrollLength[i] += totalDistance;
                        totalDistance = scrollLength[i];
                    }

                // Every PO to Active Stage
                var count = 1;
                $(".po-item-container").each(function (index) {
                    var activeStages = [];
                    $(this).find(".po-item-section.po-item-sticky .po-item-section-body .po-item-data-content").each(function (index) {
                        var findID = "#activeStagePo-" + count;
                        var textStage = $(this).find(findID).first().text();

                        if (textStage === "cancel") {
                            textStage = 0;
                        }
                        else if (textStage === "2a") {
                            textStage = 3;
                        }
                        else if (textStage >= 3) {
                            textStage = parseInt(textStage) + 1;
                        }
                        else{
                            textStage = parseInt(textStage);
                        }

                        activeStages.push(textStage);
                    });

                activeStages.sort();
                findID = ".po-sign-row-" + count;
                var biggestActiveStages = activeStages[activeStages.length - 1];
                $(this).find(findID).animate({ scrollLeft: scrollLength[biggestActiveStages - 1] }, 500);
                count++;
                });
            });


            function paginationShow(destination) {
                $(".po-item-scrollable").animate({ scrollLeft: scrollLength[destination - 1] }, 500);
            }

            function poItemCollapse(row) {
                row.closest("li").toggleClass("collapse-row");
            }

            function reverseDayMonth(monthDayYearDate) {
                var dateParts = monthDayYearDate.split("/");
                return new Date(+dateParts[2], dateParts[1] - 1, +dateParts[0]);
            }

            // Fill Delay Reason with selected value
            $(".st4-delay-reason").each(function (index) {
                var delayReasonID = $(this).attr("value");

                $(this).get(0).selectedIndex = delayReasonID;
            });
        </script>
    }