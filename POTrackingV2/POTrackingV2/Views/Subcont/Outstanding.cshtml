@*@model IEnumerable<POTracking.Controllers.SubcontController.POPurchasingDocumentItemViewModel>*@
@*@model PagedList.IPagedList<POTracking.Controllers.SubcontController.POPurchasingDocumentItemViewModel>*@
@*@model PagedList.IPagedList<POTracking.ViewModels.POPurchasingDocumentItemViewModel>*@
@*@model PagedList.IPagedList<POTracking.Models.PO>*@
@model PagedList.IPagedList<POTrackingV2.Models.PO>
@using PagedList.Mvc;
<link href="~/Content/PagedList.css" rel="stylesheet" type="text/css" />
@*@model IEnumerable<POTracking.Models.POSubcont>*@
@{
    ViewBag.Title = "PO Subcont";
    var roleID = ViewBag.CurrentRoleID;
    var poSignRow = 1;
    var iisAppName = ViewBag.IISAppName;
}
@section styles {
    <link href="~/Content/datepicker.min.css" rel="stylesheet" />
}
@*<h1 class="page-title"><a href="~/SubCont/index?role=vendor" class="page-subtitle">PO Subcontractor Index</a><span class="page-subtitle">History</span><span><a href="~/SubCont/index?role=procurement" class="page-subtitle">Procurement</a></span></h1>*@
<h1 class="page-title"><a href="#" class="page-subtitle">PO Subcontractor Outstanding</a><span class="page-subtitle">History</span></h1>
<div class="filter-row mb-2">
    @using (Html.BeginForm("Outstanding", "Subcont", FormMethod.Get, new { @class = "filter-form-container form-inline" }))
    {
        @*<div class="filter-form-container form-inline">*@
        @*<input id="role" name="role" type="hidden" class="form-control form-control-lg filter-search with-icon" placeholder="Search No. PO" value="@ViewBag.Role" />*@
        <div class="form-group mr-4 ml-0 frmSearch">
            @*<label><input class="form-control form-control-lg filter-search with-icon search-data" list="data-list" /></label>*@
            <input id="searchPONumber" name="searchPONumber" list="data-list-po" type="text" class="form-control form-control-lg filter-search with-icon pr-2" placeholder="Search No. PO" autocomplete="off" value="@ViewBag.CurrentDataPONumber" />
            <datalist id="data-list-po"></datalist>
            @*<i class="fas fa-search form-type-icon hint"></i>*@
        </div>
        <div class="form-group mr-4 ml-0 frmSearch">
            <input id="searchVendorName" name="searchVendorName" list="data-list-vendor" type="text" class="form-control form-control-lg filter-search with-icon pr-2" placeholder="Search Subcont Name" autocomplete="off" value="@ViewBag.CurrentDataVendorName" />
            <datalist id="data-list-vendor"></datalist>
        </div>
        <div class="form-group mr-4 ml-0 frmSearch">
            <input id="searchMaterial" name="searchMaterial" list="data-list-material" type="text" class="form-control form-control-lg filter-search with-icon pr-2" placeholder="Search Material" autocomplete="off" value="@ViewBag.CurrentDataMaterial" />
            <datalist id="data-list-material"></datalist>
        </div>
        @*<select id="filterBy" name="filterBy" class="form-control form-control-lg" value="@ViewBag.CurrentFilter">
                <option value="poNumber">PO Number</option>
                <option value="vendor">Vendor Name</option>
                <option value="material">Material</option>
            </select>*@
        <div class="form-group mr-0">
            <label for="startPODate">PO Date</label>
            <input name="searchStartPODate" type="text" class="form-control form-control-lg form-date with-icon" id="startPODate"
                   placeholder="dd/mm/yyyy" value="@ViewBag.CurrentStartPODate" autocomplete="off" />
            <i class="far fa-calendar-alt form-type-icon"></i>
        </div>

        <div class="form-group">
            <label for="endPODate">to</label>
            <input name="searchEndPODate" type="text" class="form-control form-control-lg form-date with-icon" id="endPODate"
                   placeholder="dd/mm/yyyy" value="@ViewBag.CurrentEndPODate" autocomplete="off" />
            <i class="far fa-calendar-alt form-type-icon"></i>
        </div>
        <button type="submit" class="btn btn-info mr-3">Find</button>
        @Html.ActionLink("Clear", "Outstanding", null, new { @class = "btn btn-info mr-3" })
        @*</div>*@
    }
</div>
<div class="filter-row tier-2 mt-0">
    <form action="/" class="filter-form-container form-inline" method="get" style="visibility:hidden;">
        <div class="form-group mr-4">
            <input id="searchData" name="searchData" list="data-list" type="text" class="form-control form-control-lg filter-search with-icon" placeholder="Search No. PO" autocomplete="off">
            <datalist id="data-list"></datalist>
        </div>
        <select id="filterBy" name="filterBy" class="form-control form-control-lg">
            <option value="poNumber">PO Number</option>
            <option value="vendor">Vendor Name</option>
            <option value="material">Material</option>
        </select>
        <div class="form-group mr-0">
            <label for="startPODate">PO Date</label>
            <input name="searchStartPODate" type="text" class="form-control form-control-lg form-date with-icon" id="startPODate" placeholder="dd/mm/yyyy" autocomplete="off">
            <i class="far fa-calendar-alt form-type-icon"></i>
        </div>
        <div class="form-group">
            <label for="endPODate">to</label>
            <input name="searchEndPODate" type="text" class="form-control form-control-lg form-date with-icon" id="endPODate" placeholder="dd/mm/yyyy" autocomplete="off">
            <i class="far fa-calendar-alt form-type-icon"></i>
        </div>
        <button type="submit" class="btn btn-info mr-3">Find</button>
        <a class="btn btn-info mr-3" href="/Import">Clear</a>
        <input name="roleID" type="hidden" value="vendor">

    </form>
    <div class="stage-pagination-container">
        <p class="stage-pagination-label mb-0 mr-3">Jump to Stage:</p>
        <ul class="list-unstyled pagination-list mb-0">
            <li class="pagination-list__item" onclick="paginationShow(1)">1</li>
            <li class="pagination-list__item" onclick="paginationShow(2)">2</li>
            <li class="pagination-list__item" onclick="paginationShow(3)">3</li>
            <li class="pagination-list__item" onclick="paginationShow(4)">4</li>
            <li class="pagination-list__item" onclick="paginationShow(5)">5</li>
            <li class="pagination-list__item" onclick="paginationShow(6)">6</li>
            <li class="pagination-list__item" onclick="paginationShow(7)">7</li>
            @*<li class="pagination-list__item" onclick="paginationShow(8)">8</li>*@
        </ul>
    </div>
</div>
@foreach (var pO in Model)
{
    <ul class="list-unstyled po-list">
        <li class="po-item-container">
            <div class="po-item-section po-item-sticky">
                <div class="po-item-section-header">
                    <i onclick="poItemCollapse($(this))" class="fas fa-angle-up po-item-section-header__icon arrow"></i>
                    <div class="po-item-section-header-text">
                        <span class="po-item-section-header-text__label">No. PO</span>
                        <span>@pO.Number</span>
                    </div>
                    <div class="po-item-section-header-text">
                        <span class="po-item-section-header-text__label">PO Date</span>
                        <span>@pO.Date.ToString("dd/MM/yyyy")</span>
                    </div>
                    <i class="fas fa-info-circle po-item-section-header__icon info"></i>
                    <div class="pop-up-notification">
                        <table>
                            <tr>
                                <td class="secondary-text">No. PO</td>
                                <td>&nbsp;</td>
                                <td>@pO.Number</td>
                            </tr>
                            <tr>
                                <td class="secondary-text">PO Date</td>
                                <td>&nbsp;</td>
                                <td>@pO.Date.ToString("dd/MM/yyyy")</td>
                            </tr>
                            <tr>
                                <td class="secondary-text">Vendor</td>
                                <td>&nbsp;</td>
                                @if (pO.Vendor != null)
                                {
                                    <td>@pO.Vendor.Name</td>
                                }
                                else
                                {
                                    <td>Vendor not in Database</td>
                                }
                            </tr>
                            <tr>
                                <td class="secondary-text">Vendor Code</td>
                                <td>&nbsp;</td>
                                @if (pO.Vendor != null)
                                {
                                    <td>@pO.Vendor.Code</td>
                                }
                                else
                                {
                                    <td>Vendor not in Database</td>
                                }
                            </tr>
                            <tr>
                                <td class="secondary-text">PO Creator</td>
                                <td>&nbsp;</td>
                                <td>@pO.PurchaseOrderCreator</td>
                            </tr>
                            <tr>
                                <td class="secondary-text">Release PO Date</td>
                                <td>&nbsp;</td>
                                @if (pO.ReleaseDate != null)
                                {
                                    <td>@pO.ReleaseDate.Value.ToString("dd/MM/yyyy")</td>
                                }
                                else
                                {
                                    <td></td>
                                }
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="po-item-section-body">
                    <div class="po-item-data-header">
                        <span class="po-item-data-header__text item-id">Item ID</span>
                        <span class="po-item-data-header__text material">Material</span>
                        <span class="po-item-data-header__text description">Item Description</span>
                        <span class="po-item-data-header__text po-progress">Progress</span>
                    </div>
                    @{
                        var row = 1;
                        var rowChild = 1;
                        var purchasingDocumentItems = pO.PurchasingDocumentItems;
                        var purchasingDocumentItemChilds = pO.PurchasingDocumentItems.Where(x => x.ParentID != null);

                        if (ViewBag.CurrentRoleID == ViewBag.RoleSubcont)
                        {
                            purchasingDocumentItems = purchasingDocumentItems.Where(x => (x.ConfirmedItem == null && x.ConfirmedQuantity == null && x.Material != "" && x.Material != null && x.ParentID == null)).ToList();
                        }
                        else
                        {
                            purchasingDocumentItems = purchasingDocumentItems.Where(x => x.ConfirmedItem == null && x.ConfirmedQuantity == null && x.Material != "" && x.Material != null && x.ParentID == null).ToList();
                        }
                        //if (!String.IsNullOrEmpty(ViewBag.CurrentData) && ViewBag.CurrentFilter == "material")
                        if (!String.IsNullOrEmpty(ViewBag.CurrentDataMaterial))
                        {
                            purchasingDocumentItems = purchasingDocumentItems.Where(pdi => pdi.Material.ToLower().Contains(ViewBag.CurrentDataMaterial.ToLower()) || pdi.Description.ToLower().Contains(ViewBag.CurrentDataMaterial.ToLower())).ToList();
                        }

                    }
                    @foreach (var purchasingDocumentItem in purchasingDocumentItems)
                    {
                        //double donutProgressValue = Convert.ToDouble(purchasingDocumentItem.ActiveStageToNumber) * ;
                        double donutProgressValue = Convert.ToDouble(purchasingDocumentItem.ActiveStageToNumber) / 7 * 100;

                        <div class="po-item-data-content row-@row">
                            <div class="po-item-data-content__outer">
                                <span class="po-item-data-header__column item-id">@purchasingDocumentItem.ItemNumber</span>
                                <span class="po-item-data-header__column material">@purchasingDocumentItem.Material</span>
                                <span class="po-item-data-header__column description">
                                    @purchasingDocumentItem.Description
                                </span>
                                @if (purchasingDocumentItem.ConfirmedItem != false)
                                {
                                    <div class="po-item-data-header__column po-progress">
                                        <div class="donut-chart" data-donutty data-radius="12" data-thickness="4" data-padding="0"
                                             data-value="@donutProgressValue" data-round="false" data-color="#567FEF" data-transition="all 2s cubic-bezier(0.17, 2.39, 0.36, 0.9)"></div>
                                        <div><span class="mark-donut" id="activeStagePo-@poSignRow">@purchasingDocumentItem.ActiveStageToNumber</span><span class="secondary-text">/7</span></div>
                                    </div>
                                }
                                else
                                {
                                    int donutProgress = 100;
                                    <div class="po-item-data-header__column po-progress">
                                        <div class="donut-chart" data-donutty data-radius="12" data-thickness="4" data-padding="0"
                                             data-value="@donutProgress" data-round="false" data-color="#8b0000" data-transition="all 2s cubic-bezier(0.17, 2.39, 0.36, 0.9)"></div>
                                        <div>Cancel</div>
                                    </div>
                                }
                            </div>
                            <div class="po-item-data-content__child">
                                @foreach (var purchasingDocumentItemChild in purchasingDocumentItemChilds.Where(x => purchasingDocumentItem.ID == x.ParentID))
                                {
                                    var isChild = "style=visibility:hidden";
                                    donutProgressValue = Convert.ToDouble(purchasingDocumentItemChild.ActiveStageToNumber) / 7 * 100;

                                    <div class="po-item-data-content row-@row-rowChild" row="@row" child="@rowChild">
                                        <span class="po-item-data-header__column item-id" @isChild>@purchasingDocumentItemChild.ItemNumber</span>
                                        <span class="po-item-data-header__column material" @isChild>@purchasingDocumentItemChild.Material</span>
                                        <span class="po-item-data-header__column description" @isChild>
                                            @purchasingDocumentItemChild.Description
                                        </span>
                                        @if (purchasingDocumentItemChild.ConfirmedItem != false)
                                        {
                                            <div class="po-item-data-header__column po-progress">
                                                <div class="donut-chart" data-donutty data-radius="12" data-thickness="4" data-padding="0"
                                                     data-value="@donutProgressValue" data-round="false" data-color="#567FEF" data-transition="all 2s cubic-bezier(0.17, 2.39, 0.36, 0.9)"></div>
                                                <div><span class="mark-donut" id="activeStagePo-@poSignRow">@purchasingDocumentItemChild.ActiveStageToNumber</span><span class="secondary-text">/7</span></div>
                                            </div>
                                        }
                                        else
                                        {
                                            int donutProgress = 100;
                                            <div class="po-item-data-header__column po-progress">
                                                <div class="donut-chart" data-donutty data-radius="12" data-thickness="4" data-padding="0"
                                                     data-value="@donutProgress" data-round="false" data-color="#8b0000" data-transition="all 2s cubic-bezier(0.17, 2.39, 0.36, 0.9)"></div>
                                                <div>Cancel</div>
                                            </div>
                                        }
                                    </div>
                                }
                            </div>
                        </div>
                        row++;
                    }
                </div>
            </div>
            <div class="custom-scrollbar po-item-scrollable po-sign-row-@poSignRow">
                <div class="po-item-section information">
                    <div class="po-item-section-header justify-content-center">
                        <p class="mb-0">Information</p>
                    </div>
                    <div class="po-item-section-body">
                        <div class="po-item-data-header">
                            <span class="po-item-data-header__text quantity">Qty</span>
                            <span class="po-item-data-header__text currency">Curr</span>
                            <span class="po-item-data-header__text price">Price</span>
                            <span class="po-item-data-header__text delivery">Delivery Date</span>
                        </div>
                        @{
                            var rowInformation = 1;
                        }
                        @foreach (var purchasingDocumentItem in purchasingDocumentItems)
                        {
                            var isChild = "";
                            if (purchasingDocumentItem.ParentID != null)
                            {
                                isChild = "style=visibility:hidden";
                            }

                            <div class="po-item-data-content row-@rowInformation information" @isChild>
                                <div class="po-item-data-content__outer">
                                    <span class="po-item-data-header__column quantity">@purchasingDocumentItem.Quantity</span>
                                    <span class="po-item-data-header__column currency">@purchasingDocumentItem.Currency</span>
                                    <span class="po-item-data-header__column price">@purchasingDocumentItem.NetPriceView</span>
                                    @*<span class="po-item-data-header__column delivery">@purchasingDocumentItem.LatestDeliveryDate.ToString("dd/MM/yyyy")</span>*@
                                    @if (purchasingDocumentItem.DeliveryDate != null)
                                    {
                                        <span class="po-item-data-header__column delivery">@purchasingDocumentItem.DeliveryDate.Value.ToString("dd/MM/yyyy")</span>
                                    }
                                    else
                                    {
                                        <span>-</span>
                                    }
                                </div>
                                <div class="po-item-data-content__child"></div>
                            </div>

                            rowInformation++;
                        }
                    </div>
                </div>
                <div class="po-item-section stage-1">
                    <div class="po-item-section-header stage-checkbox-header">
                        <div>
                            @*<input class="checkbox-all" type="checkbox" />*@
                            <label class="checkbox-custom__label mr-0">
                                <input class="checkbox-custom checkbox-all" type="checkbox" />
                                <span class="checkmark"></span>
                            </label>
                        </div>
                        <div>
                            <p class="mb-0">Stage 1</p>
                        </div>
                        <div>
                            @*@Html.ActionLink("Save", "SavePO", new { searchData = Request.QueryString["searchData"], searchStartPODate = Request.QueryString["searchStartPODate"], searchEndPODate = Request.QueryString["searchEndPODate"], page = Request.QueryString["page"] }, new { @style = "margin-right: 130px;" })*@
                            <input class="btn btn-positive confirm-all-po" type="submit" value="Save All" />
                        </div>
                    </div>
                    <div class="po-item-section-body">
                        <div class="po-item-data-header">
                            <span class="po-item-data-header__text confirm-delivery-date">Confirm Delivery Date</span>
                            <span class="po-item-data-header__text delivery-option">Delivery Method</span>
                            <span class="po-item-data-header__text quantity-form">Quantity</span>
                        </div>
                        @{
                            rowInformation = 1;
                            var rowInformationChild = 1;
                        }
                        @foreach (var purchasingDocumentItem in purchasingDocumentItems)
                        {
                            var confirmedDate = purchasingDocumentItem.ConfirmedDate.HasValue ? purchasingDocumentItem.ConfirmedDate.Value.ToString("dd/MM/yyyy") : purchasingDocumentItem.LatestDeliveryDate.ToString("dd/MM/yyyy");
                            var latestConfirmedDate = purchasingDocumentItem.ConfirmedDate.HasValue ? purchasingDocumentItem.ConfirmedDate.Value.ToString("dd/MM/yyyy") : purchasingDocumentItem.LatestDeliveryDate.ToString("dd/MM/yyyy");
                            var checkChild = purchasingDocumentItemChilds.Where(x => x.ParentID == purchasingDocumentItem.ID).OrderByDescending(x => x.ConfirmedDate).FirstOrDefault();
                            if (checkChild != null)
                            {
                                latestConfirmedDate = checkChild.ConfirmedDate.HasValue ? checkChild.ConfirmedDate.Value.ToString("dd/MM/yyyy") : "";
                            }

                            int currentStage = purchasingDocumentItem.ActiveStageToNumber;
                            var hideChildCheckedConfirmBtn = "";
                            var hideEditButton = "";
                            var disabledInputQty = "";
                            var disabledBtnConfirmCancel = "";
                            var disabledCheckbox = "disabled";
                            var selectedBtnConfirm = "";
                            var selectedBtnCancel = "";
                            var checkItem = "";
                            var isPartial = "";
                            var quantity = purchasingDocumentItem.ConfirmedQuantity > 0 ? purchasingDocumentItem.ConfirmedQuantity : purchasingDocumentItem.Quantity;

                            if (purchasingDocumentItemChilds.Where(x => x.ParentID == purchasingDocumentItem.ID).Count() > 0)
                            {
                                isPartial = "selected";
                            }

                            if (ViewBag.CurrentRoleID == "vendor")
                            {
                                hideChildCheckedConfirmBtn = "style=visibility:hidden";
                                disabledInputQty = "disabled";
                                if (purchasingDocumentItem.ConfirmedItem == false)
                                {
                                    disabledBtnConfirmCancel = "disabled";
                                    disabledCheckbox = "disabled";
                                    selectedBtnCancel = "selected-negative";
                                    checkItem = "checked";
                                }
                                else if (purchasingDocumentItem.ConfirmedQuantity.ToString() == "" || purchasingDocumentItem.ConfirmedQuantity == 0)
                                {
                                    disabledBtnConfirmCancel = "disabled";
                                }
                                else
                                {
                                    disabledBtnConfirmCancel = "disabled";
                                    disabledCheckbox = "disabled";
                                    selectedBtnConfirm = "selected";
                                    checkItem = "checked";
                                }
                            }
                            else if (ViewBag.CurrentRoleID == ViewBag.RoleSubcont)
                            {
                                disabledInputQty = "disabled";
                                if (purchasingDocumentItem.ConfirmedItem == true)
                                {
                                    disabledBtnConfirmCancel = "disabled";
                                    disabledCheckbox = "disabled";
                                    selectedBtnConfirm = "selected";
                                    checkItem = "checked";
                                }
                                else if (purchasingDocumentItem.ConfirmedItem == false)
                                {
                                    disabledBtnConfirmCancel = "disabled";
                                    disabledCheckbox = "disabled";
                                    selectedBtnCancel = "selected-negative";
                                    checkItem = "checked";
                                }
                                else
                                {
                                    disabledBtnConfirmCancel = "disabled";
                                }
                            }

                            if (purchasingDocumentItem.ConfirmedItem == null && purchasingDocumentItem.ActiveStageToNumber == 0)
                            {
                                hideEditButton = "style=visibility:hidden";
                            }
                            //if (ViewBag.CurrentRoleID == "vendor" && (purchasingDocumentItem.ConfirmedItem == true || (purchasingDocumentItem.ConfirmedQuantity != null && purchasingDocumentItem.ConfirmedItem != null) || purchasingDocumentItemChilds.Where(x => x.ParentID == purchasingDocumentItem.ID).Any(x => x.ConfirmedItem != null)))
                            if (ViewBag.CurrentRoleID == "vendor" && ((purchasingDocumentItem.DeliveryDate == purchasingDocumentItem.ConfirmedDate && purchasingDocumentItem.Quantity == purchasingDocumentItem.ConfirmedQuantity) || (purchasingDocumentItem.ConfirmedItem == true || (purchasingDocumentItem.ConfirmedQuantity != null && purchasingDocumentItem.ConfirmedItem != null) || purchasingDocumentItemChilds.Where(x => x.ParentID == purchasingDocumentItem.ID).Any(x => x.ConfirmedItem != null))))
                            //if (ViewBag.CurrentRoleID == "vendor" && (purchasingDocumentItem.Quantity == purchasingDocumentItem.ConfirmedQuantity))
                            //if (ViewBag.CurrentRoleID == 3 && (((purchasingDocumentItem.ConfirmedItem == null && purchasingDocumentItem.ConfirmedQuantity == null) || purchasingDocumentItem.ConfirmedItem == true) || ((purchasingDocumentItemChilds.Where(x => x.ParentID == purchasingDocumentItem.ID).Any( x => x.ConfirmedItem == null && x.ConfirmedQuantity == null) || purchasingDocumentItemChilds.Where(x => x.ParentID == purchasingDocumentItem.ID).Any(x => x.ConfirmedItem == true)))))
                            {
                                hideEditButton = "style=visibility:hidden";
                            }
                            else if (ViewBag.CurrentRoleID == ViewBag.RoleSubcont && purchasingDocumentItem.ActiveStageToNumber != 2)
                            {
                                hideEditButton = "style=visibility:hidden";
                            }

                            @*<form>*@
                            <div class="po-item-data-content row-@rowInformation" row="@rowInformation">
                                <div class="po-item-data-content__outer">
                                    <div class="po-item-data-header__column confirm-delivery-date">
                                        <div class="form-inline">
                                            <input type="hidden" class="pd-item-id" value="@purchasingDocumentItem.ID">
                                            <div class="input-group">
                                                <label class="checkbox-custom__label">
                                                    <input class="checkbox-custom checkbox-item" @checkItem type="checkbox" @disabledCheckbox>
                                                    <span class="checkmark"></span>
                                                </label>
                                                <div class="form-group">
                                                    <input type="text" class="form-control form-date confirmed-date with-icon" required autofocus pattern="\d{1,2}/\d{1,2}/\d{4}" placeholder="dd/mm/yyyy" @disabledInputQty value="@latestConfirmedDate">
                                                    <i class="fas fa-calendar-alt form-type-icon"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="po-item-data-header__column delivery-option">
                                        <div class="form-group">
                                            <select class="form-control delivery-method" @disabledInputQty>
                                                <option value="full">Full</option>
                                                <option value="partial" @isPartial>Partial</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="po-item-data-header__column quantity-form">
                                        <div class="form-group">
                                            <input type="number" class="form-control pd-item-confirm-qty" autofocus required pattern="[0-9]" min="1" placeholder="Qty available @purchasingDocumentItem.Quantity" value="@quantity" @disabledInputQty>
                                        </div>
                                    </div>
                                    <div class="po-item-data-header__column">
                                        <div class="form-inline">
                                            <div class="input-group mr-2">
                                                <input type="text" class="form-control form-date partial-date with-icon" autofocus required pattern="\d{1,2}/\d{1,2}/\d{4}" placeholder="dd/mm/yyyy" @disabledInputQty value="@confirmedDate">
                                                <i class="fas fa-calendar-alt form-type-icon icon-prepend"></i>
                                                <div class="input-group-prepend">
                                                    <button class="btn btn-positive @selectedBtnConfirm" @disabledBtnConfirmCancel>Yes</button>
                                                </div>
                                            </div>
                                            <button class="btn btn-negative st1-vendor-cancel-item @selectedBtnCancel" @disabledBtnConfirmCancel>No</button>
                                        </div>
                                    </div>
                                    <div class="po-item-data-header__column">
                                        <div class="form-inline icon-display">
                                            @*<a href="#" class="btn-icon add-row" style="visibility:hidden"><i class="fas fa-plus-circle"></i></a>
                                            <a href="#" class="btn-icon del-row" style="visibility:hidden"><i class="fas fa-minus-circle"></i></a>*@
                                            <a href="#" class="btn-icon edit-row" @hideEditButton><i class="far fa-edit"></i></a>
                                        </div>
                                    </div>
                                </div>
                                <div class="po-item-data-content__child">
                                    @*put the child here*@
                                    @foreach (var purchasingDocumentItemChild in purchasingDocumentItemChilds.Where(x => x.ParentID == purchasingDocumentItem.ID))
                                    {
                                        var comfirmPartialDateChild = purchasingDocumentItemChild.ConfirmedDate.HasValue ? purchasingDocumentItemChild.ConfirmedDate.Value.ToString("dd/MM/yyyy") : "";
                                        var selectedCheckboxChild = "";
                                        var disabledChild = "";
                                        var selectedBtnConfirmChild = "";
                                        var selectedBtnCancelChild = "";
                                        var disabledBtnConfirmCancelChild = "disabled";
                                        var hideEditBtnChild = "";

                                        if (purchasingDocumentItemChild.ConfirmedItem != null)
                                        {
                                            if (purchasingDocumentItemChild.ConfirmedItem == true)
                                            {
                                                selectedBtnConfirmChild = "selected";
                                            }
                                            else
                                            {
                                                selectedBtnCancelChild = "selected-negative";
                                            }

                                            selectedCheckboxChild = "checked";
                                            disabledChild = "disabled";
                                        }

                                        //if (purchasingDocumentItem.ConfirmedItem == true || ViewBag.Role != "vendor" || purchasingDocumentItem.ConfirmedQuantity != 0)
                                        ////if (ViewBag.Role == "vendor" && (((purchasingDocumentItem.ConfirmedItem == null && purchasingDocumentItem.ConfirmedQuantity == null) || purchasingDocumentItem.ConfirmedItem == true) || ((purchasingDocumentItemChilds.Where(x => x.ParentID == purchasingDocumentItem.ID).Any( x => x.ConfirmedItem == null && x.ConfirmedQuantity == null) || purchasingDocumentItemChilds.Where(x => x.ParentID == purchasingDocumentItem.ID).Any(x => x.ConfirmedItem == true)))))
                                        //{
                                        //    hideEditButton = "style=visibility:hidden";
                                        //}
                                        //else
                                        if (ViewBag.CurrentRoleID == "vendor" || purchasingDocumentItemChild.ActiveStageToNumber != 2)
                                        {
                                            hideEditBtnChild = "style=visibility:hidden";
                                        }


                                        <div class="po-item-data-content row-@rowInformation-@rowInformationChild" row="@rowInformation" child="@rowInformationChild">
                                            <div class="po-item-data-header__column confirm-delivery-date">
                                                <div class="form-inline">
                                                    <input type="hidden" class="pd-item-id" value="@purchasingDocumentItemChild.ID">
                                                    <input type="hidden" class="pd-item-parent-id" value="@purchasingDocumentItem.ID">
                                                    <div class="input-group">
                                                        <label class="checkbox-custom__label" @hideChildCheckedConfirmBtn>
                                                            <input class="checkbox-custom checkbox-item" @selectedCheckboxChild @disabledChild type="checkbox">
                                                            <span class="checkmark"></span>
                                                        </label>
                                                        <div class="form-group" style="visibility:hidden">
                                                            <input type="text" class="form-control form-date confirmed-date with-icon" placeholder="dd/mm/yyyy">
                                                            <i class="fas fa-calendar-alt form-type-icon"></i>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="po-item-data-header__column quantity-form">
                                                <div class="form-inline">
                                                    <div class="form-group">
                                                        <select class="form-control delivery-method-child" style="visibility:hidden">
                                                            <option value="full">Full</option>
                                                            <option value="partial" selected>Partial</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="po-item-data-header__column delivery-option">
                                                <div class="form-inline">
                                                    <input type="number" class="form-control pd-item-confirm-qty" min="1" autofocus="" required="" pattern="[0-9]" value="@purchasingDocumentItemChild.ConfirmedQuantity" disabled>
                                                </div>
                                            </div>
                                            <div class="po-item-data-header__column">
                                                <div class="form-inline">
                                                    <div class="input-group mr-2">
                                                        <input type="text" class="form-control form-date partial-date with-icon" autofocus="" required="" pattern="\d{1,2}/\d{1,2}/\d{4}" placeholder="dd/mm/yyyy" value="@comfirmPartialDateChild" disabled>
                                                        <i class="fas fa-calendar-alt form-type-icon icon-prepend"></i>
                                                        <div class="input-group-prepend">
                                                            <button class="btn btn-positive @selectedBtnConfirmChild" @disabledBtnConfirmCancelChild @hideChildCheckedConfirmBtn>Yes</button>
                                                        </div>
                                                    </div>
                                                    <button class="btn btn-negative st1-vendor-cancel-item @selectedBtnCancelChild" @disabledBtnConfirmCancelChild @hideChildCheckedConfirmBtn>No</button>
                                                </div>
                                            </div>
                                            <div class="po-item-data-header__column">
                                                <div class="form-inline icon-display">
                                                    @*<a href="#" class="btn-icon add-row" style="visibility:hidden"><i class="fas fa-plus-circle"></i></a>
                                                    <a href="#" class="btn-icon del-row" style="visibility:hidden"><i class="fas fa-minus-circle"></i></a>*@
                                                    <a href="#" class="btn-icon edit-row" @hideEditBtnChild><i class="far fa-edit"></i></a>
                                                </div>
                                            </div>
                                        </div>
                                        rowInformationChild++;
                                    }
                                </div>
                            </div>
                            @*</form>*@
                            rowInformation++;
                        }
                    </div>
                </div>
                <div class="po-item-section stage-2">
                    <div class="po-item-section-header justify-content-center">
                        <p class="mb-0">Stage 2</p>
                    </div>
                    <div class="po-item-section-body">
                        <div class="po-item-data-header">
                            <span class="po-item-data-header__text">Define Sequences</span>
                        </div>
                        @{
                            rowInformation = 1;
                            rowInformationChild = 1;
                        }
                        @foreach (var purchasingDocumentItem in purchasingDocumentItems)
                        {
                            var disableDefineSequences = "";
                            if (purchasingDocumentItem.ActiveStageToNumber < 2)
                            {
                                disableDefineSequences = "disabled";
                            }
                            <div class="po-item-data-content row-@rowInformation" row="@rowInformation">
                                <div class="po-item-data-content__outer">
                                    <div class="po-item-data-header__column">
                                        <input type="hidden" class="pd-item-id" value="@purchasingDocumentItem.ID">
                                        <button class="btn btn-positive sequences-modal" @disableDefineSequences data-toggle="modal" data-target="#sequencesModal">Define Sequences</button>
                                    </div>
                                </div>
                                <div class="po-item-data-content__child">
                                    @*put the child here*@
                                    @foreach (var purchasingDocumentItemChild in purchasingDocumentItemChilds.Where(x => x.ParentID == purchasingDocumentItem.ID))
                                    {
                                        disableDefineSequences = "";

                                        //if ((purchasingDocumentItemChild.ActiveStage != null && Convert.ToInt32(purchasingDocumentItemChild.ActiveStage) < 2) || purchasingDocumentItemChild.ActiveStage == null)
                                        if (purchasingDocumentItemChild.ActiveStageToNumber < 2)
                                        {
                                            disableDefineSequences = "disabled";
                                        }

                                        <div class="po-item-data-content row-@rowInformation-@rowInformationChild" row="@rowInformation" child="@rowInformationChild">
                                            <div class="po-item-data-header__column">
                                                <input type="hidden" class="pd-item-id" value="@purchasingDocumentItemChild.ID">
                                                <button class="btn btn-positive sequences-modal" @disableDefineSequences data-toggle="modal" data-target="#sequencesModal">Define Sequences</button>
                                            </div>
                                        </div>

                                        rowInformationChild++;
                                    }
                                </div>
                            </div>
                            rowInformation++;
                        }
                    </div>
                </div>
                <div class="po-item-section stage-3">
                    <div class="po-item-section-header justify-content-center">
                        <p class="mb-0">Stage 3</p>
                    </div>
                    <div class="po-item-section-body">
                        <div class="po-item-data-header">
                            <span class="po-item-data-header__text">Sequences Progress</span>
                        </div>
                        @{
                            rowInformation = 1;
                            rowInformationChild = 1;
                        }
                        @foreach (var purchasingDocumentItem in purchasingDocumentItems)
                        {
                            var disabledProgress = "";

                            if (purchasingDocumentItem.ActiveStageToNumber < 3)
                            {
                                disabledProgress = "disabled";
                            }

                            <div class="po-item-data-content row-@rowInformation" row="@rowInformation">
                                <div class="po-item-data-content__outer">
                                    <div class="po-item-data-header__column">
                                        <input type="hidden" class="pd-item-id" value="@purchasingDocumentItem.ID">
                                        <button class="btn btn-positive input-progress" data-toggle="modal" data-target="#inputProgressModal" @disabledProgress>Input Progress</button>
                                    </div>
                                </div>
                                <div class="po-item-data-content__child">
                                    @foreach (var purchasingDocumentItemChild in purchasingDocumentItemChilds.Where(x => x.ParentID == purchasingDocumentItem.ID))
                                    {
                                        disabledProgress = "";

                                        if (purchasingDocumentItemChild.ActiveStageToNumber < 3)
                                        {
                                            disabledProgress = "disabled";
                                        }

                                        <div class="po-item-data-content row-@rowInformation-@rowInformationChild" row="@rowInformation" child="@rowInformationChild">
                                            <div class="po-item-data-header__column">
                                                <input type="hidden" class="pd-item-id" value="@purchasingDocumentItemChild.ID">
                                                <button class="btn btn-positive input-progress" data-toggle="modal" data-target="#inputProgressModal" @disabledProgress>Input Progress</button>
                                            </div>
                                        </div>
                                        rowInformationChild++;
                                    }
                                </div>
                            </div>
                            rowInformation++;
                        }
                    </div>
                </div>
                <div class="po-item-section stage-4 info-stage">
                    <div class="po-item-section-header justify-content-center">
                        <p class="mb-0">Stage 4</p>
                    </div>
                    <div class="po-item-section-body">
                        <div class="po-item-data-header">
                            <span class="po-item-data-header__text gr-date">GR Date</span>
                            <span class="po-item-data-header__text gr-qty">Qty</span>
                            <span class="po-item-data-header__text gr-complete">GR Completed</span>
                            @*<span class="po-item-data-header__text">Inspection Date</span>
                                <span class="po-item-data-header__text">Qty</span>*@
                            <span class="po-item-data-header__text">info</span>

                        </div>
                        @{
                            row = 1;
                            rowChild = 1;
                        }


                        @foreach (var purchasingDocumentItem in purchasingDocumentItems)
                        {
                            var hideGR = "";
                            if (ViewBag.CurrentRoleID != ViewBag.RoleSubcont && purchasingDocumentItem.ActiveStageToNumber < 4)
                            {
                                hideGR = "style=visibility:hidden";
                            }
                            var grDateNewDateFormat = purchasingDocumentItem.LatestPurchasingDocumentItemHistories.GoodsReceiptDate.HasValue ? purchasingDocumentItem.LatestPurchasingDocumentItemHistories.GoodsReceiptDate.Value.ToString("dd/MM/yyyy") : "";
                            var isComplete = "No";
                            if (purchasingDocumentItem.LatestPurchasingDocumentItemHistories.GoodsReceiptQuantity >= purchasingDocumentItem.ConfirmedQuantity)
                            {
                                isComplete = "Yes";
                            }
                            <div class="po-item-data-content row-@row" row="@row">
                                <div class="po-item-data-content__outer" @hideGR>
                                    <span class="po-item-data-header__column gr-date">@grDateNewDateFormat</span>
                                    <span class="po-item-data-header__column gr-qty">@purchasingDocumentItem.LatestPurchasingDocumentItemHistories.GoodsReceiptQuantity / @purchasingDocumentItem.ConfirmedQuantity</span>
                                    <span class="po-item-data-header__column gr-complete">@isComplete</span>
                                    @*<span class="po-item-data-header__column inspection-date"></span>
                                        <span class="po-item-data-header__column inspecton-qty"></span>*@
                                    <span class="po-item-data-header__text info">
                                        <i class="fas fa-info-circle po-item-section-header__icon info"></i>
                                        <div class="pop-up-notification">
                                            <table>
                                                <tbody>
                                                    <tr>
                                                        <td>GR / Inspection Date</td>
                                                        <td>&nbsp;</td>
                                                        <td>Qty</td>
                                                    </tr>
                                                    @foreach (var pdih in purchasingDocumentItem.PurchasingDocumentItemHistoriesDetail)
                                                    {
                                                        grDateNewDateFormat = pdih.GoodsReceiptDate.HasValue ? pdih.GoodsReceiptDate.Value.ToString("dd/MM/yyyy") : "";

                                                        <tr>
                                                            <td class="secondary-text">@grDateNewDateFormat</td>
                                                            <td>&nbsp;</td>
                                                            <td class="secondary-text">@pdih.GoodsReceiptQuantity</td>
                                                        </tr>
                                                    }
                                                </tbody>
                                            </table>
                                        </div>
                                    </span>

                                </div>
                                <div class="po-item-data-content__child">
                                    @foreach (var purchasingDocumentItemChild in purchasingDocumentItemChilds.Where(x => x.ParentID == purchasingDocumentItem.ID))
                                    {
                                        isComplete = "No";
                                        if (purchasingDocumentItemChild.LatestPurchasingDocumentItemHistories.GoodsReceiptQuantity >= purchasingDocumentItemChild.ConfirmedQuantity)
                                        {
                                            isComplete = "Yes";
                                        }
                                        grDateNewDateFormat = purchasingDocumentItemChild.LatestPurchasingDocumentItemHistories.GoodsReceiptDate.HasValue ? purchasingDocumentItemChild.LatestPurchasingDocumentItemHistories.GoodsReceiptDate.Value.ToString("dd/MM/yyyy") : "";
                                        hideGR = "";
                                        if (ViewBag.CurrentRoleID != ViewBag.RoleSubcont && purchasingDocumentItemChild.ActiveStageToNumber < 4)
                                        {
                                            hideGR = "style=visibility:hidden";
                                        }

                                        <div class="po-item-data-content row-@row-@rowChild mt-customize" row="@row" child="@rowChild" @hideGR>
                                            <span class="po-item-data-header__column gr-date">@grDateNewDateFormat</span>
                                            <span class="po-item-data-header__column gr-qty">@purchasingDocumentItemChild.LatestPurchasingDocumentItemHistories.GoodsReceiptQuantity / @purchasingDocumentItemChild.ConfirmedQuantity</span>
                                            <span class="po-item-data-header__column gr-complete">@isComplete</span>
                                            @*<span class="po-item-data-header__column inspection-date"></span>
                                                <span class="po-item-data-header__column qty"></span>*@
                                            <span class="po-item-data-header__text info">
                                                <i class="fas fa-info-circle po-item-section-header__icon info"></i>
                                                <div class="pop-up-notification">
                                                    <table>
                                                        <tbody>
                                                            <tr>
                                                                <td>GR / Inspection Date</td>
                                                                <td>&nbsp;</td>
                                                                <td>Qty</td>
                                                            </tr>
                                                            @foreach (var pdih in purchasingDocumentItemChild.PurchasingDocumentItemHistoriesDetail)
                                                            {
                                                                grDateNewDateFormat = pdih.GoodsReceiptDate.HasValue ? pdih.GoodsReceiptDate.Value.ToString("dd/MM/yyyy") : "";
                                                                <tr>
                                                                    <td class="secondary-text">@grDateNewDateFormat</td>
                                                                    <td>&nbsp;</td>
                                                                    <td class="secondary-text">@pdih.GoodsReceiptQuantity</td>
                                                                </tr>
                                                            }
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </span>
                                        </div>
                                        rowChild++;
                                    }
                                </div>
                            </div>
                            row++;
                        }
                    </div>
                </div>
                <div class="po-item-section stage-5">
                    <div class="po-item-section-header justify-content-center">
                        <p class="mb-0">Stage 5</p>
                    </div>
                    <div class="po-item-section-body">
                        <div class="po-item-data-header">
                            <span class="po-item-data-header__text invoice-method">Invoice Method</span>
                        </div>
                        @{
                            row = 1;
                            rowChild = 1;
                        }
                        @foreach (var purchasingDocumentItem in purchasingDocumentItems)
                        {
                            var isDisabled = "";
                            var isFull = "";
                            var isPartial = "";

                            var checkStageProgressItem = false;
                            if (purchasingDocumentItem.ActiveStageToNumber > 3 || purchasingDocumentItemChilds.Where(x => x.ParentID == purchasingDocumentItem.ID && x.ActiveStageToNumber > 3).Count() > 0)
                            {
                                checkStageProgressItem = true;
                            }

                            if (checkStageProgressItem == false || ViewBag.CurrentRoleID == ViewBag.RoleSubcont)
                            {
                                isDisabled = "disabled";
                            }

                            if (purchasingDocumentItem.InvoiceMethod == "full")
                            {
                                isFull = "selected";
                                isDisabled = "disabled";
                            }
                            else if (purchasingDocumentItem.InvoiceMethod == "partial")
                            {
                                isPartial = "selected";
                                isDisabled = "disabled";
                            }

                            <div class="po-item-data-content row-@row" row="@row">
                                <div class="po-item-data-content__outer">
                                    <div class="po-item-data-header__column invoice-method">
                                        <input type="hidden" class="pd-item-id" value="@purchasingDocumentItem.ID">
                                        <div class="form-inline">
                                            <div class="form-group mr-2">
                                                <select class="form-control invoice-method-parent" @isDisabled>
                                                    <option value="">Choose One</option>
                                                    <option value="full" @isFull>Full</option>
                                                    <option value="partial" @isPartial>Partial by GR</option>
                                                </select>
                                            </div>
                                            <button class="btn btn-positive save-invoice-method-parent" @isDisabled>Save</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="po-item-data-content__child">
                                    @*@foreach (var purchasingDocumentItemChild in purchasingDocumentItemChilds.Where(x => x.ParentID == purchasingDocumentItem.ID))
                                        {
                                            <div class="po-item-data-content row-@row-@rowChild" row="@row" child="@rowChild">
                                                <div class="po-item-data-header__column invoice-method">
                                                    <div class="form-inline">
                                                        <div class="form-group mr-2">
                                                            <select class="form-control">
                                                                <option>Choose One</option>
                                                                <option>Full</option>
                                                                <option>Partial by GR</option>
                                                            </select>
                                                        </div>
                                                        <button class="btn btn-positive">Save</button>
                                                    </div>
                                                </div>
                                            </div>
                                            rowChild++;
                                        }*@
                                </div>
                                @*<div class="po-item-data-header__column">
                                        <div>7<span class="secondary-text">/10</span></div>
                                    </div>
                                    <span class="po-item-data-header__column">No</span>*@
                            </div>
                            row++;
                        }
                    </div>
                </div>
                <div class="po-item-section stage-6">
                    <div class="po-item-section-header justify-content-center">
                        <p class="mb-0">Stage 6</p>
                    </div>
                    <div class="po-item-section-body">
                        <div class="po-item-data-header">
                            <span class="po-item-data-header__text invoice-method">Upload Invoice</span>
                        </div>
                        @{
                            row = 1;
                            rowChild = 1;

                        }
                        @foreach (var purchasingDocumentItem in purchasingDocumentItems)
                        {
                            var disabledFileInvoice = "";
                            var disabledFileInvoiceUpload = "";
                            var hiddenFormUploading = "";
                            var hiddenRemoveFile = "";
                            var hiddenFormUploaded = "hidden";
                            var invoiceDownloadPath = "";
                            var grFullFill = "";

                            if (ViewBag.CurrentRoleID == ViewBag.RoleSubcont)
                            {
                                hiddenRemoveFile = "hidden";
                            }

                            if (purchasingDocumentItem.ActiveStageToNumber > 3 && purchasingDocumentItem.LatestPurchasingDocumentItemHistories.GoodsReceiptQuantity >= purchasingDocumentItem.ConfirmedQuantity)
                            {
                                grFullFill = "gr-full-fill";
                            }

                            if (purchasingDocumentItem.InvoiceDocument != null)
                            {
                                //invoiceDownloadPath = Path.Combine("..\\Files\\Subcont\\Invoice", purchasingDocumentItem.InvoiceDocument);
                                invoiceDownloadPath = Path.Combine("/", iisAppName, "Files/Subcont/Invoice", purchasingDocumentItem.InvoiceDocument);
                                hiddenFormUploading = "hidden";
                                hiddenFormUploaded = "";
                            }
                            else
                            {
                                if (ViewBag.CurrentRoleID == ViewBag.RoleSubcont || purchasingDocumentItem.ActiveStageToNumber < 3 || (purchasingDocumentItem.ActiveStageToNumber > 3 && purchasingDocumentItem.InvoiceDocument != null) || purchasingDocumentItem.ActiveStageToNumber < 4 || purchasingDocumentItem.InvoiceMethod == null)
                                {
                                    disabledFileInvoice = "disabled";
                                    disabledFileInvoiceUpload = "disabled";
                                }
                            }

                            <div class="po-item-data-content row-@row" row="@row">
                                <div class="po-item-data-content__outer">
                                    <div class="po-item-data-header__column">
                                        <input type="hidden" class="pd-item-id" value="@purchasingDocumentItem.ID">
                                        <div class="form-inline form-upload" @hiddenFormUploading>
                                            <div class="form-group mr-2">
                                                <input type="file" class="form-control with-icon file-invoice @grFullFill" @disabledFileInvoice>
                                                <i class="fas fa-paperclip form-type-icon"></i>
                                            </div>
                                            <button class="btn btn-positive save-invoice @grFullFill" @disabledFileInvoiceUpload>Save</button>
                                        </div>
                                        <div class="file-uploaded form-uploaded" @hiddenFormUploaded>
                                            <p class="mb-0"> <a class="file-invoice-download" href="@invoiceDownloadPath">Invoice uploaded </a> <i class="fas fa-check-circle success-icon"></i></p>
                                            <a href="#" class="danger-link file-invoice-remove" @hiddenRemoveFile>Remove?</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="po-item-data-content__child">
                                    @foreach (var purchasingDocumentItemChild in purchasingDocumentItemChilds.Where(x => x.ParentID == purchasingDocumentItem.ID))
                                    {
                                        disabledFileInvoice = "";
                                        disabledFileInvoiceUpload = "";
                                        hiddenFormUploading = "";
                                        hiddenRemoveFile = "";
                                        hiddenFormUploaded = "hidden";
                                        invoiceDownloadPath = "";
                                        grFullFill = "";

                                        if (ViewBag.CurrentRoleID == ViewBag.RoleSubcont)
                                        {
                                            hiddenRemoveFile = "hidden";
                                        }

                                        if (purchasingDocumentItemChild.ActiveStageToNumber > 3 && purchasingDocumentItemChild.LatestPurchasingDocumentItemHistories.GoodsReceiptQuantity >= purchasingDocumentItemChild.ConfirmedQuantity)
                                        {
                                            grFullFill = "gr-full-fill";
                                        }

                                        if (purchasingDocumentItemChild.InvoiceDocument != null)
                                        {
                                            //invoiceDownloadPath = Path.Combine("..\\Files\\Subcont\\Invoice", purchasingDocumentItemChild.InvoiceDocument);
                                            invoiceDownloadPath = Path.Combine("/", iisAppName, "Files/Subcont/Invoice", purchasingDocumentItemChild.InvoiceDocument);
                                            hiddenFormUploading = "hidden";
                                            hiddenFormUploaded = "";
                                        }
                                        else
                                        {
                                            if (ViewBag.CurrentRoleID == ViewBag.RoleSubcont || purchasingDocumentItemChild.InvoiceMethod != "partial" || purchasingDocumentItemChild.ActiveStageToNumber < 3 || (purchasingDocumentItemChild.ActiveStageToNumber > 3 && purchasingDocumentItemChild.InvoiceDocument != null) || (purchasingDocumentItemChild.ActiveStageToNumber > 3 && purchasingDocumentItemChild.LatestPurchasingDocumentItemHistories.GoodsReceiptQuantity < purchasingDocumentItemChild.ConfirmedQuantity))
                                            {
                                                disabledFileInvoice = "disabled";
                                                disabledFileInvoiceUpload = "disabled";
                                            }
                                        }

                                        if (purchasingDocumentItemChild.InvoiceMethod == "full" || purchasingDocumentItemChild.InvoiceMethod == null)
                                        {
                                            hiddenFormUploading = "hidden";
                                            hiddenFormUploaded = "hidden";
                                        }

                                        @*<div class="po-item-data-content row-@row-@rowChild mt-customize" row="@row" child="@rowChild" >*@
                                        <div class="po-item-data-content row-@row-@rowChild" row="@row" child="@rowChild">
                                            <div class="po-item-data-header__column">
                                                <input type="hidden" class="pd-item-id" value="@purchasingDocumentItemChild.ID">
                                                <div class="form-inline form-upload" @hiddenFormUploading>
                                                    <div class="form-group mr-2">
                                                        <input type="file" class="form-control with-icon file-invoice @grFullFill" @disabledFileInvoice>
                                                        <i class="fas fa-paperclip form-type-icon"></i>
                                                    </div>
                                                    <button class="btn btn-positive save-invoice @grFullFill" @disabledFileInvoiceUpload>Save</button>
                                                </div>
                                                <div class="file-uploaded form-uploaded" @hiddenFormUploaded>
                                                    <p class="mb-0"> <a class="file-invoice-download" href="@invoiceDownloadPath">Invoice uploaded </a> <i class="fas fa-check-circle success-icon"></i></p>
                                                    <a href="#" class="danger-link file-invoice-remove" @hiddenRemoveFile>Remove?</a>
                                                </div>
                                            </div>
                                        </div>
                                        rowChild++;
                                    }
                                </div>
                            </div>
                            row++;
                        }
                    </div>
                </div>
                <div class="po-item-section stage-7">
                    <div class="po-item-section-header justify-content-center">
                        <p class="mb-0">Stage 7</p>
                    </div>
                    <div class="po-item-section-body">
                        <div class="po-item-data-header">
                            <span class="po-item-data-header__text parking-date">Parking Date</span>
                            <span class="po-item-data-header__text term-date">Term Date</span>
                        </div>
                        @{
                            row = 1;
                            rowChild = 1;
                        }
                        @foreach (var purchasingDocumentItem in purchasingDocumentItems)
                        {
                            var dateNewFormat = purchasingDocumentItem.LatestInvoiceDate.GoodsReceiptDate.HasValue ? purchasingDocumentItem.LatestInvoiceDate.GoodsReceiptDate.Value.ToString("dd/MM/yyyy") : "";

                            <div class="po-item-data-content row-@row" row="@row">
                                <div class="po-item-data-content__outer">
                                    <span class="po-item-data-header__column parking-date">@dateNewFormat</span>
                                    <span class="po-item-data-header__column term-date">@purchasingDocumentItem.LatestInvoiceDate.PayTerms</span>
                                </div>
                                <div class="po-item-data-content__child">
                                    @foreach (var purchasingDocumentItemChild in purchasingDocumentItemChilds.Where(x => x.ParentID == purchasingDocumentItem.ID))
                                    {
                                        dateNewFormat = purchasingDocumentItemChild.LatestInvoiceDate.GoodsReceiptDate.HasValue ? purchasingDocumentItemChild.LatestInvoiceDate.GoodsReceiptDate.Value.ToString("dd/MM/yyyy") : "";
                                        <div class="po-item-data-content row-@row-@rowChild mt-customize" row="@row" child="@rowChild">
                                            <span class="po-item-data-header__column document-number">@dateNewFormat</span>
                                            <span class="po-item-data-header__column gr-date">@purchasingDocumentItemChild.LatestInvoiceDate.PayTerms</span>
                                        </div>
                                        rowChild++;
                                    }
                                </div>
                            </div>
                            row++;
                        }

                    </div>
                </div>
            </div>
        </li>
    </ul>
    poSignRow++;
}
<div class="modal fade" id="sequencesModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Define Sequences</h5>
                <button id="close-sequence" type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Lead Time: <span id="LeadTime"></span> days</p>
                <p style="display:none">Total: <span id="Total"></span> days</p>
                <div class="po-item-data-content">
                    <div class="po-item-data-header__column">
                        <form method="post">
                            <div class="form-inline">
                                <p class="mb-0 mr-5">PB</p>
                                <input id="PB" type="number" min="0" autofocus required class="form-control define-sequences-days mr-1">
                                <span>days</span>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="po-item-data-content">
                    <div class="po-item-data-header__column">
                        <form method="post">
                            <div class="form-inline">
                                <p class="mb-0 mr-5">Setting</p>
                                <input id="Setting" type="number" min="0" autofocus required class="form-control define-sequences-days mr-1">
                                <span>days</span>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="po-item-data-content">
                    <div class="po-item-data-header__column">
                        <form method="post">
                            <div class="form-inline">
                                <p class="mb-0 mr-5">FullWeld / Assy</p>
                                <input id="Fullweld" type="number" min="0" autofocus required class="form-control define-sequences-days mr-1">
                                <span>days</span>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="po-item-data-content">
                    <div class="po-item-data-header__column">
                        <form method="post">
                            <div class="form-inline">
                                <p class="mb-0 mr-5">Primer / QC</p>
                                <input id="Primer" type="number" min="0" autofocus required class="form-control define-sequences-days mr-1">
                                <span>days</span>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            @if (ViewBag.CurrentRoleID == "vendor")
            {
                <div class="modal-footer">
                    <input type="hidden" id="item-id-sequences">
                    <button id="btnEditDefineSequences" type="button" class="btn btn-positive w-100">Edit</button>
                    <button id="btnSaveDefineSequences" type="button" class="btn btn-positive w-100">Save changes</button>
                </div>
            }
        </div>
    </div>
</div>
<div class="modal fade" id="inputProgressModal" tabindex="-1" role="dialog" aria-labelledby="inputProgressModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="inputProgressModalLabel">Sequences Progress</h5>
                <button id="close-input-progress" type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="po-item-data-content">
                    <div class="po-item-data-header__column">
                    </div>
                </div>
                <ul class="nav nav-tabs" id="myTab" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" id="pb-tab" data-toggle="tab" href="#pb" role="tab" aria-controls="pb" aria-selected="true">PB</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="setting-tab" data-toggle="tab" href="#setting" role="tab" aria-controls="setting" aria-selected="false">Setting</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="fullweld-tab" data-toggle="tab" href="#fullweld" role="tab" aria-controls="fullweld" aria-selected="false">FullWeld / Assy</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="primer-tab" data-toggle="tab" href="#primer" role="tab" aria-controls="primer" aria-selected="false">Primer / QC</a>
                    </li>
                </ul>
                <div class="tab-content" id="myTabContent">
                    <div class="tab-pane fade show active" id="pb" role="tabpanel" aria-labelledby="pb-tab">
                        @*<div class="form-row">
                                <div class="form-group col-md-3">
                                    <label>Nama Raw Material</label>
                                    <input type="text" class="form-control" placeholder="Nama Raw Material">
                                </div>
                                <div class="form-group col-md-2">
                                    <label>Qty</label>
                                    <input type="number" class="form-control" placeholder="Qty">
                                </div>
                                <div class="form-group col-md-1">
                                    <label></label>
                                    <button class="btn btn-positive">Add Item</button>
                                </div>
                            </div>*@
                        <div class="form-row">
                            <div class="form-group col-md-3">
                                <label>ETC</label>
                                <input type="text" id="ETAPB" class="form-control form-date with-icon" autocomplete="off" placeholder="dd/mm/yyyy" disabled>
                                <input type="hidden" id="PBDays">
                                <i class="fas fa-calendar-alt form-type-icon"></i>
                            </div>
                            <div class="form-group col-md-3">
                                <label>Finish Date</label>
                                <input type="text" id="ATAPB" class="form-control form-date with-icon" autocomplete="off" placeholder="dd/mm/yyyy">
                                <i class="fas fa-calendar-alt form-type-icon"></i>
                            </div>
                            <div class="form-group col-md-3">
                                <label>Reason</label>
                                @*<button class="btn btn-positive">Upload</button>*@
                                <select class="form-control sequences-progress-reasons" id="ATAPBReasonID" disabled>
                                    <option value="0" selected>Choose One</option>
                                    @*<option value="1">Problem Teknis</option>
                                    <option value="2">Perubahan DWG(Drawing)</option>
                                    <option value="3">Material Tidak Ada Dipasaran</option>
                                    <option value="4">Mesin Rusak</option>
                                    <option value="5">Switching Product</option>*@
                                </select>
                            </div>
                            <div class="form-group col-md-3">
                                <label for="inputFilePB">Upload Progress Photo</label>
                                <input type="file" class="form-control with-icon" id="inputFilePB" multiple>
                                <i class="fas fa-paperclip form-type-icon"></i>
                            </div>
                            <div class="form-group col-md-12">
                                <b>Live Preview</b>
                                <br />
                                <div id="filePB" class="dvPreview">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="setting" role="tabpanel" aria-labelledby="setting-tab">
                        <div class="form-row">
                            <div class="form-group col-md-3">
                                <label>ETC</label>
                                <input type="text" id="ETASetting" class="form-control form-date with-icon" autocomplete="off" placeholder="dd/mm/yyyy" disabled>
                                <input type="hidden" id="SettingDays">
                                <i class="fas fa-calendar-alt form-type-icon"></i>
                            </div>
                            <div class="form-group col-md-3">
                                <label>Finish Date</label>
                                <input type="text" id="ATASetting" class="form-control form-date with-icon" autocomplete="off" placeholder="dd/mm/yyyy">
                                <i class="fas fa-calendar-alt form-type-icon"></i>
                            </div>
                            <div class="form-group col-md-3">
                                <label>Reason</label>
                                @*<button class="btn btn-positive">Upload</button>*@
                                <select class="form-control sequences-progress-reasons" id="ATASettingReasonID" disabled>
                                    <option value="0" selected>Choose One</option>
                                    @*<option value="1">Problem Teknis</option>
                                    <option value="2">Perubahan DWG(Drawing)</option>
                                    <option value="3">Material Tidak Ada Dipasaran</option>
                                    <option value="4">Mesin Rusak</option>
                                    <option value="5">Switching Product</option>*@
                                </select>
                            </div>
                            <div class="form-group col-md-3">
                                <label for="inputFileSetting">Upload Progress Photo</label>
                                <input type="file" class="form-control with-icon" id="inputFileSetting" multiple>
                                <i class="fas fa-paperclip form-type-icon"></i>
                            </div>
                            <div class="form-group col-md-12">
                                <b>Live Preview</b>
                                <br />
                                <div id="fileSetting" class="dvPreview">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="fullweld" role="tabpanel" aria-labelledby="fullweld-tab">
                        <div class="form-row">
                            <div class="form-group col-md-3">
                                <label>ETC</label>
                                <input type="text" id="ETAFullweld" class="form-control form-date with-icon" autocomplete="off" placeholder="dd/mm/yyyy" disabled>
                                <input type="hidden" id="FullweldDays">
                                <i class="fas fa-calendar-alt form-type-icon"></i>
                            </div>
                            <div class="form-group col-md-3">
                                <label>Finish Date</label>
                                <input type="text" id="ATAFullweld" class="form-control form-date with-icon" autocomplete="off" placeholder="dd/mm/yyyy">
                                <i class="fas fa-calendar-alt form-type-icon"></i>
                            </div>
                            <div class="form-group col-md-3">
                                <label>Reason</label>
                                @*<button class="btn btn-positive">Upload</button>*@
                                <select class="form-control sequences-progress-reasons" id="ATAFullweldReasonID" disabled>
                                    <option value="0" selected>Choose One</option>
                                    @*<option value="1">Problem Teknis</option>
                                    <option value="2">Perubahan DWG(Drawing)</option>
                                    <option value="3">Material Tidak Ada Dipasaran</option>
                                    <option value="4">Mesin Rusak</option>
                                    <option value="5">Switching Product</option>*@
                                </select>
                            </div>
                            <div class="form-group col-md-3">
                                <label for="inputFileFullweld">Upload Progress Photo</label>
                                <input type="file" class="form-control with-icon" id="inputFileFullweld" multiple>
                                <i class="fas fa-paperclip form-type-icon"></i>
                            </div>
                            <div class="form-group col-md-12">
                                <b>Live Preview</b>
                                <br />
                                <div id="fileFullweld" class="dvPreview">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="primer" role="tabpanel" aria-labelledby="primer-tab">
                        <div class="form-row">
                            <div class="form-group col-md-3">
                                <label>ETC</label>
                                <input type="text" id="ETAPrimer" class="form-control form-date with-icon" autocomplete="off" placeholder="dd/mm/yyyy" disabled>
                                <input type="hidden" id="PrimerDays">
                                <i class="fas fa-calendar-alt form-type-icon"></i>
                            </div>
                            <div class="form-group col-md-3">
                                <label>Finish Date</label>
                                <input type="text" id="ATAPrimer" class="form-control form-date with-icon" autocomplete="off" placeholder="dd/mm/yyyy">
                                <i class="fas fa-calendar-alt form-type-icon"></i>
                            </div>
                            <div class="form-group col-md-3">
                                <label>Reason</label>
                                <select class="form-control sequences-progress-reasons" id="ATAPrimerReasonID" disabled>
                                    <option value="0" selected>Choose One</option>
                                </select>
                            </div>
                            <div class="form-group col-md-3">
                                <label for="inputFilePrimer">Upload Progress Photo</label>
                                <input type="file" class="form-control with-icon" id="inputFilePrimer" multiple>
                                <i class="fas fa-paperclip form-type-icon"></i>
                            </div>
                            <div class="form-group col-md-12">
                                <b>Live Preview</b>
                                <br />
                                <div id="filePrimer" class="dvPreview">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" id="SaveSequencesProgress" class="btn btn-positive w-100">Save changes</button>
            </div>
        </div>
    </div>
</div>
<br />
Page @(Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber) of @Model.PageCount
@Html.PagedListPager(Model, page => Url.Action("Outstanding",
    //new { page, role = ViewBag.CurrentRoleID, searchData = ViewBag.CurrentData, filterBy = @ViewBag.FilterBy, searchStartPODate = ViewBag.CurrentStartPODate, searchEndPODate = ViewBag.CurrentEndPODate }))
    new { page, searchPONumber = ViewBag.CurrentDataPONumber, searchVendorName = ViewBag.CurrentDataVendorName, searchMaterial = ViewBag.CurrentDataMaterial, filterBy = @ViewBag.FilterBy, searchStartPODate = ViewBag.CurrentStartPODate, searchEndPODate = ViewBag.CurrentEndPODate }))
@section scripts {
    <script src="~/Scripts/datepicker.min.js"></script>
    <script src="~/Scripts/donutty-jquery.min.js"></script>
    <script type="text/javascript">
        var scrollLength = [];
        $(document).ready(function () {
            //$("#filterBy").on("change", function () {
            //    $("#data-list").empty();
            //});
            //$("#filterBy option").each(function () {
            //    if ($(this).attr("value") == $(this).parent().attr("value")) {
            //        $(this).attr("selected", "selected");
            //        $("#searchData").attr("placeholder", "Search " + $(this).text())
            //    }
            //});

            $(".filter-search").on("keyup focus", function () {
                //poNumber vendor material
                var filterBy = "";
                var list = "";
                var searchData = "";
                if ($(this).attr("name") == "searchPONumber") {
                    filterBy = "poNumber";
                    searchData = $("#searchPONumber");
                    list = "po";
                } else if ($(this).attr("name") == "searchVendorName"){
                    filterBy = "vendor";
                    searchData = $("#searchVendorName");
                    list = "vendor";
                } else if ($(this).attr("name") == "searchMaterial") {
                    filterBy = "material";
                    searchData = $("#searchMaterial");
                    list = "material";
                }

                $.ajax({
                    type: "GET",
                    url: "@Url.Action("GetDataFromValue", "Subcont")",
                    data: { 'filterBy': filterBy, 'value': searchData.val() },
                    beforeSend: function () {
                        searchData.css("background", "url(" + siteUrl + "/Images/LoaderIcon.gif) no-repeat 165px");
                    },
                    success: function (response) {
                        if (response.responseCode == "200") {
                            var jsonObjSuggestion = $.parseJSON(response.data);
                            var element = "";
                            //console.log(response.data);
                            for (var k in jsonObjSuggestion) {
                                element += "<option value='" + jsonObjSuggestion[k]['Data']+"'></option>";
                            }
                            $("#data-list-" + list).html(element);
                            searchData.css("background", "");
                        } else {
                            conole.log(response.responseCode + response.responseText);
                        }
                    },
                    error: function (xhr, status, error) {
                        alert(xhr.status + " : " + error);
                    }
                });
            });
            //javasript date format mm/dd/yy
            String.prototype.replaceDayMonth = function () {
                return this.substr(3, 2) + this.substr(2, 1) + this.substr(0, 2) + this.substr(5)
            }

            Date.prototype.newDateFormat = function () {
                var dd = this.getDate();

                var mm = this.getMonth() + 1;
                var yyyy = this.getFullYear();
                if (dd < 10) {
                    dd = '0' + dd;
                }

                if (mm < 10) {
                    mm = '0' + mm;
                }
                return dd + "/" + mm + "/" + yyyy;
            }

            function sortDate() {

            }


            //stage scrollbar fixed
            var chooseStagePosition = $('.filter-row').offset();

            $(".main-container").scroll(function () {
                if ($(".main-container").scrollTop() > chooseStagePosition.top) {
                    //$('.stage-pagination-container').css('position', 'fixed').css('top', '10px');
                    $('.filter-row').addClass("freeze");
                } else {
                    //$('.stage-pagination-container').css('position', 'static');
                    $('.filter-row').removeClass("freeze");
                }
            });


            $('#startPODate').datepicker({ autoHide: true });
            $('#endPODate').datepicker({ autoHide: true, filter: date => { return (new Date($('#startPODate').val()) >= date) ? false : true; } });
            $('.form-date').datepicker({ format: 'dd/mm/YYYY', autoHide: true });

            var tempArray = [];
            var tempMaxHeight = 0;
            var tempMaxWidth = 0;
            var rowExist = 1;


            $(".po-item-container").each(function (idx) {
                rowExist = 1;
                poItemContainer = $(this);
                while (rowExist > 0) {
                    if ($(".row-" + rowExist).length > 0) {
                        tempArray = [];
                        tempMaxHeight = 0;
                        poItemContainer.find(".row-" + rowExist).each(function () {
                            tempArray.push($(this).height());
                            //console.log("row-" + rowExist);
                            //console.log(tempArray);
                        });
                        tempMaxHeight = Math.max(...tempArray);
                        poItemContainer.find(".row-" + rowExist).height(tempMaxHeight);
                        rowExist++;

                    } else {
                        rowExist = -1;
                    }
                }
            });

            tempArray = [];
            $(".po-item-section.information").each(function () {
                tempArray.push($(this).outerWidth(true));
            });
            tempMaxWidth = Math.max(...tempArray);
            $(".po-item-section.information").width(tempMaxWidth);
            scrollLength.push(tempMaxWidth + 1.5);

            for (var i = 1; i <= 7; i++) {
                tempArray = [];
                $(".po-item-section.stage-" + i).each(function () {
                    tempArray.push($(this).outerWidth(true));
                });
                tempMaxWidth = Math.max(...tempArray);
                $(".po-item-section.stage-" + i).width(tempMaxWidth);
                scrollLength.push(tempMaxWidth + 1.5);
            }

            var totalDistance = 0;
            for (var i = 0; i < scrollLength.length; i++) {
                scrollLength[i] += totalDistance;
                totalDistance = scrollLength[i];
            }

            var count = 1;
            // Every PO to Active Stage
            $(".po-item-container").each(function (index) {
                var activeStages = [];
                $(this).find(".po-item-section.po-item-sticky .po-item-section-body .po-item-data-content").each(function (index) {
                    var findID = "#activeStagePo-" + count;
                    var textStage = $(this).find(findID).first().text();
                    if (textStage != "") {
                        if (textStage === "2a") {
                            textStage = 3;
                        }
                        else if (textStage >= 3) {
                            textStage = parseInt(textStage) + 1;
                        }
                        else {
                            textStage = parseInt(textStage);
                        }

                        activeStages.push(textStage);
                    }
                });

                activeStages.sort();
                findID = ".po-sign-row-" + count;
                var biggestActiveStages = activeStages[activeStages.length - 1];
                //console.log("ini" + biggestActiveStages);
                $(this).find(findID).animate({ scrollLeft: scrollLength[biggestActiveStages - 1] }, 500);
                count++;
            });
        });

        var rowHeights = [];
        var totalRowHeight = 0;

        function resetRowHeight(rowPOItemDataContent) {
            var tempNewArray = [];
            var tempNewMaxHeight = 0;
            var newRowExist = 1;

            while (newRowExist > 0) {
                if (rowPOItemDataContent.find(".row-" + newRowExist).length > 0) {
                    tempNewArray = [];
                    tempNewMaxHeight = 0;
                    rowPOItemDataContent.find(".row-" + newRowExist).each(function () {
                        tempNewArray.push($(this).height());
                    });
                    tempNewMaxHeight = Math.max(...tempNewArray);
                    rowPOItemDataContent.find(".row-" + newRowExist).height(tempNewMaxHeight);
                    newRowExist++;
                } else {
                    newRowExist = -1;
                }
            }
            tempNewArray = [];
            totalRowHeight = 0;
        }

        function increaseRowHeight(rowPOItemDataContent) {
            var tempNewArray = [];
            var tempNewMaxHeight = 0;
            var newRowExist = 1;

            while (newRowExist > 0) {
                if (rowPOItemDataContent.find(".row-" + newRowExist).length > 0) {
                    tempNewArray = [];
                    tempNewMaxHeight = 0;
                    rowPOItemDataContent.find(".row-" + newRowExist).each(function () {
                        tempNewArray.push($(this).height());
                    });
                    tempNewMaxHeight = Math.max(...tempNewArray);
                    rowPOItemDataContent.find(".row-" + newRowExist).height(tempNewMaxHeight);
                    newRowExist++;
                } else {
                    newRowExist = -1;
                }
            }
            tempNewArray = [];
            totalRowHeight = 0;
        }

        function decreaseRowHeight(rowPOItemDataContent) {
            var tempNewArray = [];
            var tempNewMinHeight = 0;
            var newRowExist = 1;

            while (newRowExist > 0) {
                if (rowPOItemDataContent.find(".row-" + newRowExist).length > 0) {
                    tempNewArray = [];
                    rowPOItemDataContent.find(".row-" + newRowExist).each(function () {
                        tempNewArray.push($(this).height());
                    });
                    tempNewMinHeight = Math.min(...tempNewArray);
                    rowPOItemDataContent.find(".row-" + newRowExist).height(tempNewMinHeight);
                    newRowExist++;
                } else {
                    newRowExist = -1;
                }
            }
            tempNewArray = [];
            totalRowHeight = 0;
        }

        //if item unchecked or delivery method change to full
        function resetRowItem(itemDataContent) {
            var currentRowHeight = itemDataContent.height();
            var newChildHeight = itemDataContent.find(".po-item-data-content__child").height();
            totalRowHeight = currentRowHeight - newChildHeight;
            console.log(totalRowHeight);
            itemDataContent.find(".po-item-data-content__child").empty();
            itemDataContent.closest(".custom-scrollbar").find(".po-item-section.stage-2 [child]").remove();
            itemDataContent.find(".po-item-data-content__outer .add-row").attr("style", "visibility:hidden");
            itemDataContent.find(".po-item-data-content__outer .del-row").attr("style", "visibility:hidden");
            itemDataContent.find(".po-item-data-content__child").empty();
            itemDataContent.closest(".custom-scrollbar").find(".po-item-section.stage-2 [child]").empty();

            itemDataContent.closest(".po-item-container").find(".delivery-method").val("full");
            itemDataContent.height(totalRowHeight);
        }

        function resetRowHeightToFull(rowPOItemDataContent) {
            var tempNewArray = [];
            var tempNewMinHeight = 0;
            var newRowExist = 1;

            while (newRowExist > 0) {
                if (rowPOItemDataContent.find(".row-" + newRowExist).length > 0) {
                    tempNewArray = [];
                    rowPOItemDataContent.find(".row-" + newRowExist).each(function () {
                        tempNewArray.push($(this).height());
                    });
                    tempNewMinHeight = Math.min(...tempNewArray);
                    rowPOItemDataContent.find(".row-" + newRowExist).height(tempNewMinHeight);
                    newRowExist++;
                } else {
                    newRowExist = -1;
                }
            }
            tempNewArray = [];
            totalRowHeight = 0;
        }

        function paginationShow(destination) {
            $(".po-item-scrollable").animate({ scrollLeft: scrollLength[destination - 1] }, 500);
        }

        function poItemCollapse(row) {
            row.closest("li").toggleClass("collapse-row");
        }
    </script>
}